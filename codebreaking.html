<!doctype html>
<html>

<head>

<meta charset="UTF-8">

<link rel="stylesheet" href="/crypt/css/style.css" type="text/css" />

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js" integrity="sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js" integrity="sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>
<script src="https://sagecell.sagemath.org/static/embedded_sagecell.js"></script>
<script>sagecell.makeSagecell({"inputLocation": ".sage", "evalButtonText": "Run", "hide": ["permalink"]});</script>

<title>
Introduction to Cryptography — Codebreaking
</title>

</head>

<body>

<nav>
<header>
<h1><a href="/crypt/">Introduction to Cryptography</a></h1>
<span>
Shishir Agrawal
</span>
</header>

<div>
<h1>Contents</h1>
<ol>

<li><a href="/crypt/introduction">Introduction</a></li>

<li><a href="/crypt/classical-cryptosystems">Classical Cryptosystems</a></li>

<li><a href="/crypt/codebreaking">Codebreaking</a></li>

<li><a href="/crypt/modern-cryptography">Modern Cryptography</a></li>

</ol>
</div>

<div>
<h1>SageCells</h1>
<ul>




<li><a href="/crypt/classical-cryptosystems#sagecell-rectangular-transposition">Rectangular Transposition</a></li>

<li><a href="/crypt/classical-cryptosystems#sagecell-caesar-knob">Caesar Knob</a></li>

<li><a href="/crypt/classical-cryptosystems#sagecell-caesar-cipher">Caesar Cipher</a></li>

<li><a href="/crypt/classical-cryptosystems#sagecell-affine-cipher">Affine Cipher</a></li>

<li><a href="/crypt/classical-cryptosystems#sagecell-simple-substitution">Simple Substitution</a></li>

<li><a href="/crypt/classical-cryptosystems#sagecell-hill-cipher">Hill Cipher</a></li>

<li><a href="/crypt/classical-cryptosystems#sagecell-playfair-cipher">Playfair Cipher</a></li>

<li><a href="/crypt/classical-cryptosystems#sagecell-vignere-cipher">Vignère Cipher</a></li>



<li><a href="/crypt/codebreaking#sagecell-frequency-comparison">Frequency Comparison</a></li>

<li><a href="/crypt/codebreaking#sagecell-frequency-analysis">Frequency Analysis</a></li>

<li><a href="/crypt/codebreaking#sagecell-breaking-rectangular-transposition">Breaking Rectangular Transposition</a></li>

<li><a href="/crypt/codebreaking#sagecell-index-of-coincidence-comparison">Index of Coincidence Comparison</a></li>

<li><a href="/crypt/codebreaking#sagecell-breaking-vignere">Breaking Vignère</a></li>

<li><a href="/crypt/codebreaking#sagecell-known-plaintext-attack">Known Plaintext Attack</a></li>



<li><a href="/crypt/modern-cryptography#sagecell-integer-representations">Integer Representations</a></li>

<li><a href="/crypt/modern-cryptography#sagecell-rsa">RSA</a></li>

<li><a href="/crypt/modern-cryptography#sagecell-elliptic-curve-encoding">Elliptic Curve Encoding</a></li>

<li><a href="/crypt/modern-cryptography#sagecell-elliptic-curve-elgamal">Elliptic Curve Elgamal</a></li>


</ul>
</div>

<div>
Start: 2022-10-28 <br/>
Update: 2024-04-25 <br/>
<a href="https://github.com/sagrawalx/crypt">Source</a> <br/>
<a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a>
</div>

<br/><br/>
</nav>

<main>
<style>
div.element span.label::after {
    content: " 3." counter(section) "." counter(element) ". ";
}
</style>
<h1 id="codebreaking">3. Codebreaking</h1>
<ol class="section-navigation">
<li>
3.1. <a href="#overview-of-codebreaking">Overview of Codebreaking</a>
</li>
<li>
3.2. <a href="#frequency-analysis">Frequency Analysis</a>
</li>
<li>
3.3. <a href="#probability">Interlude: Probability</a>
</li>
<li>
3.4. <a href="#conditional-probability">Interlude: Conditional
Probability</a>
</li>
<li>
3.5. <a href="#index-of-coincidence">Index of Coincidence</a>
</li>
<li>
3.6. <a href="#breaking-the-vignere-cipher">Breaking the Vignère
Cipher</a>
</li>
<li>
3.7. <a href="#g-test">Interlude: <span
class="math inline">\(G\)</span>-Test</a>
</li>
<li>
3.8. <a href="#breaking-rectangular-transposition">Breaking Rectangular
Transposition</a>
</li>
<li>
3.9. <a href="#known-plaintext-attack">Known Plaintext Attack</a>
</li>
<li>
3.10. <a href="#perfect-secrecy">Perfect Secrecy</a>
</li>
</ol>
<h2 id="overview-of-codebreaking">3.1. Overview of Codebreaking</h2>
<p>In the last section, we mostly took the perspective of Alice and Bob:
we focused on how to encrypt and decrypt texts using a variety of
ciphers. In this section, we take the perspective of Eve: we’ll study
how to break some of the ciphers we encountered above. This will include
some interludes on probability theory, which will help us devise more
clever codebreaking techniques.</p>
<p>It’s worth remarking at the outset that codebreaking is not an “exact
science,” in the sense that there isn’t any codebreaking algorithm that
guarantees producing the correct plaintext from the ciphertext in one
shot without access to the key. Instead, the techniques help constrain
the search for the correct ciphertext: we’ll see how we can make
<em>educated</em> guesses about what the key might be, but they will be
<em>guesses</em> nonetheless, so there could be points where some guess
you made was incorrect and you have to go back and make an alternative
guess. Still, the guesswork is “educated enough” that the techniques
work pretty well (especially in an age we can get computers to do some
of the work for us), so most of the ciphers discussed above are no
longer considered secure!</p>
<p>The only exception is the one-time pad, which, as we mentioned above,
does have a very strong security property called “perfect secrecy.”
We’ll return to this again at the end of this section.</p>
<h2 id="frequency-analysis">3.2. Frequency Analysis</h2>
<p><em>Frequency analysis</em> is a powerful technique for breaking
simple (and sometimes also polygraphic) substutition ciphers. The idea
<a
href="https://en.wikipedia.org/wiki/Frequency_analysis#History_and_usage">dates
back</a> to the Arab polymath Al-Kindi (801–873 CE) and is relatively
simple:</p>
<div class="element">
<p><span class="label">Heuristic</span> The relative frequencies of
letters remains <em>roughly</em> stable across different samples of
English texts, and <code>ETAOINSHRDLU</code> is the <em>approximate</em>
order of the 12 most common letters.<a href="#fn1" class="footnote-ref"
id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
</div>
<p>For an interesting tangent about the letters
<code>ETAOINSHRDLU</code>, see <a
href="https://en.wikipedia.org/wiki/Etaoin_shrdlu">here</a>!</p>
<div id="sagecell-frequency-comparison" class="element">
<p><span class="label">SageCell</span> Here is a SageCell that lets you
look at frequencies in various English texts. Hit “Run.” You’ll see
several input boxes which default to passages from Emily Brönte’s
<em>Wuthering Heights</em>, the Declaration of Independence, F. Scott
Fitzgerald’s <em>The Great Gatsby</em>, and the Preamble to the
Universal Declaration of Human Rights. The code outputs a table
indicating the frequency of each letter (as a percentage) in each text,
as well as a ranked list of the most frequent through the least frequent
letter in each text.</p>
<p>Do you see the patterns described in the heuristic above? Namely, are
the frequency percentages <em>roughly</em> equal for all of the texts?
Is it true that <code>ETAOINSHRDLU</code> is the <em>approximate</em>
order of the 12 most common letters?</p>
<p>Then find some other passage(s) of English text on your own and plug
them in to see what happens!</p>
<div class="sage">
<script type="text/x-sage">
from re import sub
from collections import Counter

samples = ["""I saw nothing; but neither the sheep nor he would go on, so I bid him take the road lower down. He probably raised the phantoms from thinking, as he traversed the moors alone, on the nonsense he had heard his parents and companions repeat. Yet, still, I don’t like being out in the dark now; and I don’t like being left by myself in this grim house: I cannot help it; I shall be glad when they leave it, and shift to the Grange.

“They are going to the Grange, then?” I said.

“Yes,” answered Mrs. Dean, “as soon as they are married, and that will be on New Year’s Day.”

“And who will live here then?”

“Why, Joseph will take care of the house, and, perhaps, a lad to keep him company. They will live in the kitchen, and the rest will be shut up.”

“For the use of such ghosts as choose to inhabit it?” I observed.

“No, Mr. Lockwood,” said Nelly, shaking her head. “I believe the dead are at peace: but it is not right to speak of them with levity.”

At that moment the garden gate swung to; the ramblers were returning.

“They are afraid of nothing,” I grumbled, watching their approach through the window. “Together, they would brave Satan and all his legions.”

As they stepped on to the door-stones, and halted to take a last look at the moon—or, more correctly, at each other by her light—I felt irresistibly impelled to escape them again; and, pressing a remembrance into the hand of Mrs. Dean, and disregarding her expostulations at my rudeness, I vanished through the kitchen as they opened the house-door; and so should have confirmed Joseph in his opinion of his fellow-servant’s gay indiscretions, had he not fortunately recognised me for a respectable character by the sweet ring of a sovereign at his feet.

My walk home was lengthened by a diversion in the direction of the kirk. When beneath its walls, I perceived decay had made progress, even in seven months: many a window showed black gaps deprived of glass; and slates jutted off, here and there, beyond the right line of the roof, to be gradually worked off in coming autumn storms.

I sought, and soon discovered, the three headstones on the slope next the moor: the middle one grey, and half buried in heath; Edgar Linton’s only harmonized by the turf and moss creeping up its foot; Heathcliff’s still bare.

I lingered round them, under that benign sky: watched the moths fluttering among the heath and harebells, listened to the soft wind breathing through the grass, and wondered how any one could ever imagine unquiet slumbers for the sleepers in that quiet earth.""",
           """When in the Course of human events, it becomes necessary for one people to dissolve the political bands which have connected them with another, and to assume among the powers of the earth, the separate and equal station to which the Laws of Nature and of Nature's God entitle them, a decent respect to the opinions of mankind requires that they should declare the causes which impel them to the separation.

We hold these truths to be self-evident, that all men are created equal, that they are endowed by their Creator with certain unalienable Rights, that among these are Life, Liberty and the pursuit of Happiness.--That to secure these rights, Governments are instituted among Men, deriving their just powers from the consent of the governed, --That whenever any Form of Government becomes destructive of these ends, it is the Right of the People to alter or to abolish it, and to institute new Government, laying its foundation on such principles and organizing its powers in such form, as to them shall seem most likely to effect their Safety and Happiness. Prudence, indeed, will dictate that Governments long established should not be changed for light and transient causes; and accordingly all experience hath shewn, that mankind are more disposed to suffer, while evils are sufferable, than to right themselves by abolishing the forms to which they are accustomed. But when a long train of abuses and usurpations, pursuing invariably the same Object evinces a design to reduce them under absolute Despotism, it is their right, it is their duty, to throw off such Government, and to provide new Guards for their future security.--Such has been the patient sufferance of these Colonies; and such is now the necessity which constrains them to alter their former Systems of Government. The history of the present King of Great Britain is a history of repeated injuries and usurpations, all having in direct object the establishment of an absolute Tyranny over these States. To prove this, let Facts be submitted to a candid world.

He has refused his Assent to Laws, the most wholesome and necessary for the public good.

He has forbidden his Governors to pass Laws of immediate and pressing importance, unless suspended in their operation till his Assent should be obtained; and when so suspended, he has utterly neglected to attend to them.

He has refused to pass other Laws for the accommodation of large districts of people, unless those people would relinquish the right of Representation in the Legislature, a right inestimable to them and formidable to tyrants only.

He has called together legislative bodies at places unusual, uncomfortable, and distant from the depository of their public Records, for the sole purpose of fatiguing them into compliance with his measures.

He has dissolved Representative Houses repeatedly, for opposing with manly firmness his invasions on the rights of the people.

He has refused for a long time, after such dissolutions, to cause others to be elected; whereby the Legislative powers, incapable of Annihilation, have returned to the People at large for their exercise; the State remaining in the mean time exposed to all the dangers of invasion from without, and convulsions within.

He has endeavoured to prevent the population of these States; for that purpose obstructing the Laws for Naturalization of Foreigners; refusing to pass others to encourage their migrations hither, and raising the conditions of new Appropriations of Lands.

He has obstructed the Administration of Justice, by refusing his Assent to Laws for establishing Judiciary powers.

He has made Judges dependent on his Will alone, for the tenure of their offices, and the amount and payment of their salaries.

He has erected a multitude of New Offices, and sent hither swarms of Officers to harrass our people, and eat out their substance.

He has kept among us, in times of peace, Standing Armies without the Consent of our legislatures.

He has affected to render the Military independent of and superior to the Civil power.

He has combined with others to subject us to a jurisdiction foreign to our constitution, and unacknowledged by our laws; giving his Assent to their Acts of pretended Legislation:

For Quartering large bodies of armed troops among us:

For protecting them, by a mock Trial, from punishment for any Murders which they should commit on the Inhabitants of these States:

For cutting off our Trade with all parts of the world:

For imposing Taxes on us without our Consent:

For depriving us in many cases, of the benefits of Trial by Jury:

For transporting us beyond Seas to be tried for pretended offences

For abolishing the free System of English Laws in a neighbouring Province, establishing therein an Arbitrary government, and enlarging its Boundaries so as to render it at once an example and fit instrument for introducing the same absolute rule into these Colonies:

For taking away our Charters, abolishing our most valuable Laws, and altering fundamentally the Forms of our Governments:

For suspending our own Legislatures, and declaring themselves invested with power to legislate for us in all cases whatsoever.

He has abdicated Government here, by declaring us out of his Protection and waging War against us.

He has plundered our seas, ravaged our Coasts, burnt our towns, and destroyed the lives of our people.

He is at this time transporting large Armies of foreign Mercenaries to compleat the works of death, desolation and tyranny, already begun with circumstances of Cruelty & perfidy scarcely paralleled in the most barbarous ages, and totally unworthy the Head of a civilized nation.

He has constrained our fellow Citizens taken Captive on the high Seas to bear Arms against their Country, to become the executioners of their friends and Brethren, or to fall themselves by their Hands.

He has excited domestic insurrections amongst us, and has endeavoured to bring on the inhabitants of our frontiers, the merciless Indian Savages, whose known rule of warfare, is an undistinguished destruction of all ages, sexes and conditions.

In every stage of these Oppressions We have Petitioned for Redress in the most humble terms: Our repeated Petitions have been answered only by repeated injury. A Prince whose character is thus marked by every act which may define a Tyrant, is unfit to be the ruler of a free people.

Nor have We been wanting in attentions to our Brittish brethren. We have warned them from time to time of attempts by their legislature to extend an unwarrantable jurisdiction over us. We have reminded them of the circumstances of our emigration and settlement here. We have appealed to their native justice and magnanimity, and we have conjured them by the ties of our common kindred to disavow these usurpations, which, would inevitably interrupt our connections and correspondence. They too have been deaf to the voice of justice and of consanguinity. We must, therefore, acquiesce in the necessity, which denounces our Separation, and hold them, as we hold the rest of mankind, Enemies in War, in Peace Friends.

We, therefore, the Representatives of the united States of America, in General Congress, Assembled, appealing to the Supreme Judge of the world for the rectitude of our intentions, do, in the Name, and by Authority of the good People of these Colonies, solemnly publish and declare, That these United Colonies are, and of Right ought to be Free and Independent States; that they are Absolved from all Allegiance to the British Crown, and that all political connection between them and the State of Great Britain, is and ought to be totally dissolved; and that as Free and Independent States, they have full Power to levy War, conclude Peace, contract Alliances, establish Commerce, and to do all other Acts and Things which Independent States may of right do. And for the support of this Declaration, with a firm reliance on the protection of divine Providence, we mutually pledge to each other our Lives, our Fortunes and our sacred Honor.""", 
           """Gatsby’s house was still empty when I left—the grass on his lawn had grown as long as mine. One of the taxi drivers in the village never took a fare past the entrance gate without stopping for a minute and pointing inside; perhaps it was he who drove Daisy and Gatsby over to East Egg the night of the accident, and perhaps he had made a story about it all his own. I didn’t want to hear it and I avoided him when I got off the train.

I spent my Saturday nights in New York because those gleaming, dazzling parties of his were with me so vividly that I could still hear the music and the laughter, faint and incessant, from his garden, and the cars going up and down his drive. One night I did hear a material car there, and saw its lights stop at his front steps. But I didn’t investigate. Probably it was some final guest who had been away at the ends of the earth and didn’t know that the party was over.

On the last night, with my trunk packed and my car sold to the grocer, I went over and looked at that huge incoherent failure of a house once more. On the white steps an obscene word, scrawled by some boy with a piece of brick, stood out clearly in the moonlight, and I erased it, drawing my shoe raspingly along the stone. Then I wandered down to the beach and sprawled out on the sand.

Most of the big shore places were closed now and there were hardly any lights except the shadowy, moving glow of a ferryboat across the Sound. And as the moon rose higher the inessential houses began to melt away until gradually I became aware of the old island here that flowered once for Dutch sailors’ eyes—a fresh, green breast of the new world. Its vanished trees, the trees that had made way for Gatsby’s house, had once pandered in whispers to the last and greatest of all human dreams; for a transitory enchanted moment man must have held his breath in the presence of this continent, compelled into an aesthetic contemplation he neither understood nor desired, face to face for the last time in history with something commensurate to his capacity for wonder.

And as I sat there brooding on the old, unknown world, I thought of Gatsby’s wonder when he first picked out the green light at the end of Daisy’s dock. He had come a long way to this blue lawn, and his dream must have seemed so close that he could hardly fail to grasp it. He did not know that it was already behind him, somewhere back in that vast obscurity beyond the city, where the dark fields of the republic rolled on under the night.

Gatsby believed in the green light, the orgastic future that year by year recedes before us. It eluded us then, but that’s no matter—tomorrow we will run faster, stretch out our arms further… And one fine morning—

So we beat on, boats against the current, borne back ceaselessly into the past.""",
           """Whereas recognition of the inherent dignity and of the equal and inalienable rights of all members of the human family is the foundation of freedom, justice and peace in the world,

Whereas disregard and contempt for human rights have resulted in barbarous acts which have outraged the conscience of mankind, and the advent of a world in which human beings shall enjoy freedom of speech and belief and freedom from fear and want has been proclaimed as the highest aspiration of the common people,

Whereas it is essential, if man is not to be compelled to have recourse, as a last resort, to rebellion against tyranny and oppression, that human rights should be protected by the rule of law,

Whereas it is essential to promote the development of friendly relations between nations,

Whereas the peoples of the United Nations have in the Charter reaffirmed their faith in fundamental human rights, in the dignity and worth of the human person and in the equal rights of men and women and have determined to promote social progress and better standards of life in larger freedom,

Whereas Member States have pledged themselves to achieve, in co-operation with the United Nations, the promotion of universal respect for and observance of human rights and fundamental freedoms,

Whereas a common understanding of these rights and freedoms is of the greatest importance for the full realization of this pledge,

Now, therefore,

The General Assembly,

Proclaims this Universal Declaration of Human Rights as a common standard of achievement for all peoples and all nations, to the end that every individual and every organ of society, keeping this Declaration constantly in mind, shall strive by teaching and education to promote respect for these rights and freedoms and by progressive measures, national and international, to secure their universal and effective recognition and observance, both among the peoples of Member States themselves and among the peoples of territories under their jurisdiction."""]

# Remove all non alphabetic characters and capitalize
def encode(text: str):
    stripped = sub(r"[^a-zA-Z]", "", text)
    return stripped.upper()

# Prints an output div aligning with the interact controls   
def output_div(label: str, content: str):
    s = '<div class="sagecell_interactControlCell" style="width: 100%;">'
    s += f'<label class="sagecell_interactControlLabel">{label}</label>'
    s += f'<div class="sagecell_interactControl">{content}</div>'
    s += '</div>'
    pretty_print(html(s))
    
# Separates a string into groups of n letters for convenience
def separate(text: str, n=5):
    return " ".join(text[i:i+n] for i in range(0, len(text), n))
    
# Returns a frequency dictionary for the input string
def frequency_dict(text: str):
    text = encode(text)
    c = Counter(text)
    alphabet = list(build_alphabet(name="upper"))
    return {x: (1.0 * c.get(x, 0) / len(text)) for x in alphabet}

@interact
def _(text1=input_box(default=samples[0], label="Text 1", height=5, width=70),
      text2=input_box(default=samples[1], label="Text 2", height=5, width=70),
      text3=input_box(default=samples[2], label="Text 3", height=5, width=70),
      text4=input_box(default=samples[3], label="Text 4", height=5, width=70)):
    
    # Build table of frequencies
    alphabet = list(build_alphabet(name="upper"))
    
    o = '<table style="font-size: 0.85em; text-align: center;"><tr><td>Text</td>'
    for x in alphabet:
        o += f"<td>{x}</td>"
    o += "</tr>"
    
    texts = [text1, text2, text3, text4]
    texts = [encode(s) for s in texts]
    ranked = []
    
    for i, s in enumerate(texts):
        # Build frequency dictionary
        f = frequency_dict(s)
        
        # Build string for frequency table
        o += f"<tr><td>{i+1}</td>"
        for x in alphabet:
            o += f"<td>{100*f[x]:.1f}</td>"
        o += "</tr>"
        
        # Build ranked lists
        r = sorted(f.keys(), key = lambda x: f[x], reverse=True)
        ranked.append(r)
    
    o += "</table>"
    output_div("Percents", o)
    
    # Output ranked lists
    o = ""
    for i, r in enumerate(ranked):
        o += f"(Text {i+1}) "
        o += separate("".join(r))
        o += "<br/>"
    output_div("Ranked", o)
    
</script>
</div>
</div>
<p>This heuristic can be exploited to break simple substitution ciphers
— even though, as we observed earlier, the number of possible keys in a
general simple substitution cipher is roughly 403 septillion! The
technique works best with longer ciphertexts, and the idea is to guess
the decryption key one letter at a time, doing one of the following at
each step:</p>
<ol type="1">
<li><p>Assign the most frequent unassigned letter of ciphertext to be
the most frequent unassigned letter in some sample English text (or
perhaps some other letter with a similar frequency).</p></li>
<li><p>Look through the ciphertext and see if you can make any guesses
about words that seem to appear there. If you see something, fill in the
blanks in that word by making appropriate guesses for the key.</p></li>
</ol>
<p>If at any point it seems like your guesses are leading to nonsense or
implausible sequences of letters, backtrack and make an alternative
guess!</p>
<p>For example, it is usually fairly safe to start with two applications
of option 1, ie, guessing that the most common letter in the ciphertext
is <code>E</code> and that the second most common letter is
<code>T</code>. Luckily, the word <code>THE</code> occurs very
frequently in English (and the same sequence occurs in other common
words like <code>THEY</code> or <code>THEIR</code> or <code>THEN</code>
or <code>THERE</code>), so if after you make the <code>E</code> and
<code>T</code> substutitions you see the pattern <code>T*E</code>
frequently (with <code>*</code> representing some fixed ciphertext
letter), you can feel pretty confident replacing <code>*</code> with
<code>H</code>. This is an example of using option 2. At this point,
applying option 2 again might require some clever guesswork. For
example, if you see the pattern <code>TH*T</code> frequently, there’s a
good chance this might the word <code>THAT</code>. Or maybe you can find
frequent occurrences of sequences like <code>*T</code> for some fixed
letter <code>*</code>, which could be <code>IT</code> or <code>AT</code>
(these can be hard to tell apart based purely on letter frequencies
since <code>A</code> and <code>I</code> often have similar frequencies),
so you could try making one of those guesses. If you can’t spot any
possible words, just try using option 1 instead and match the most
frequent letters!</p>
<p>Usually the first few guesses after <code>E</code> and <code>T</code>
are the hardest. Once you’ve made just a few correct guesses, it starts
becoming very easy to see words!</p>
<div id="sagecell-frequency-analysis" class="element">
<p><span class="label">SageCell / Exercise</span> Here is a SageCell to
assist with the frequency analysis described above. Hit “Run” and you’ll
see the following:</p>
<ul>
<li><p>A text box labeled “Cipher” that contains text encrypted using a
simple substitution. Your job is to decrypt this text!</p></li>
<li><p>A text box labeled “Sample” containing sample English text. It
defaults to the Declaration of Independence. You are welcome to change
it if you like, but you shouldn’t need to.</p></li>
<li><p>A text box labeled “Key.” This represents the <em>decryption</em>
key: the top row corresponds to letters of ciphertext and the bottom row
to letters of plaintext. Don’t change anything in the first row. A
ciphertext letter in the top row corresponds to the plaintext letter in
the second row; use an asterisk indicating that you haven’t made a guess
yet.</p></li>
<li><p>A table labeled “Percent.” This indicates the frequency of each
letter in each text (input ciphertext or the sample plaintext).</p></li>
<li><p>Sequences of letters labeled “Ranked.” These are ranked lists of
the most letters in the input ciphertext and in the sample text, ordered
from most frequent to least frequent. For ease of use, <em>only
unassigned letters are displayed here</em>.</p></li>
<li><p>A (large) block of text labeled “Output” that shows what happens
when the input ciphertext is run through your guessed key. The letters
you’ve guessed in the key are substituted and appear in black; unguessed
ciphertext letters appear unchanged and in light gray.</p></li>
</ul>
<p>Use the strategy described above to decrypt this ciphertext!</p>
<div class="sage">
<script type="text/x-sage">
from re import sub
from collections import Counter

sampletext = """When in the Course of human events, it becomes necessary for one people to dissolve the political bands which have connected them with another, and to assume among the powers of the earth, the separate and equal station to which the Laws of Nature and of Nature's God entitle them, a decent respect to the opinions of mankind requires that they should declare the causes which impel them to the separation.

We hold these truths to be self-evident, that all men are created equal, that they are endowed by their Creator with certain unalienable Rights, that among these are Life, Liberty and the pursuit of Happiness.--That to secure these rights, Governments are instituted among Men, deriving their just powers from the consent of the governed, --That whenever any Form of Government becomes destructive of these ends, it is the Right of the People to alter or to abolish it, and to institute new Government, laying its foundation on such principles and organizing its powers in such form, as to them shall seem most likely to effect their Safety and Happiness. Prudence, indeed, will dictate that Governments long established should not be changed for light and transient causes; and accordingly all experience hath shewn, that mankind are more disposed to suffer, while evils are sufferable, than to right themselves by abolishing the forms to which they are accustomed. But when a long train of abuses and usurpations, pursuing invariably the same Object evinces a design to reduce them under absolute Despotism, it is their right, it is their duty, to throw off such Government, and to provide new Guards for their future security.--Such has been the patient sufferance of these Colonies; and such is now the necessity which constrains them to alter their former Systems of Government. The history of the present King of Great Britain is a history of repeated injuries and usurpations, all having in direct object the establishment of an absolute Tyranny over these States. To prove this, let Facts be submitted to a candid world.

He has refused his Assent to Laws, the most wholesome and necessary for the public good.

He has forbidden his Governors to pass Laws of immediate and pressing importance, unless suspended in their operation till his Assent should be obtained; and when so suspended, he has utterly neglected to attend to them.

He has refused to pass other Laws for the accommodation of large districts of people, unless those people would relinquish the right of Representation in the Legislature, a right inestimable to them and formidable to tyrants only.

He has called together legislative bodies at places unusual, uncomfortable, and distant from the depository of their public Records, for the sole purpose of fatiguing them into compliance with his measures.

He has dissolved Representative Houses repeatedly, for opposing with manly firmness his invasions on the rights of the people.

He has refused for a long time, after such dissolutions, to cause others to be elected; whereby the Legislative powers, incapable of Annihilation, have returned to the People at large for their exercise; the State remaining in the mean time exposed to all the dangers of invasion from without, and convulsions within.

He has endeavoured to prevent the population of these States; for that purpose obstructing the Laws for Naturalization of Foreigners; refusing to pass others to encourage their migrations hither, and raising the conditions of new Appropriations of Lands.

He has obstructed the Administration of Justice, by refusing his Assent to Laws for establishing Judiciary powers.

He has made Judges dependent on his Will alone, for the tenure of their offices, and the amount and payment of their salaries.

He has erected a multitude of New Offices, and sent hither swarms of Officers to harrass our people, and eat out their substance.

He has kept among us, in times of peace, Standing Armies without the Consent of our legislatures.

He has affected to render the Military independent of and superior to the Civil power.

He has combined with others to subject us to a jurisdiction foreign to our constitution, and unacknowledged by our laws; giving his Assent to their Acts of pretended Legislation:

For Quartering large bodies of armed troops among us:

For protecting them, by a mock Trial, from punishment for any Murders which they should commit on the Inhabitants of these States:

For cutting off our Trade with all parts of the world:

For imposing Taxes on us without our Consent:

For depriving us in many cases, of the benefits of Trial by Jury:

For transporting us beyond Seas to be tried for pretended offences

For abolishing the free System of English Laws in a neighbouring Province, establishing therein an Arbitrary government, and enlarging its Boundaries so as to render it at once an example and fit instrument for introducing the same absolute rule into these Colonies:

For taking away our Charters, abolishing our most valuable Laws, and altering fundamentally the Forms of our Governments:

For suspending our own Legislatures, and declaring themselves invested with power to legislate for us in all cases whatsoever.

He has abdicated Government here, by declaring us out of his Protection and waging War against us.

He has plundered our seas, ravaged our Coasts, burnt our towns, and destroyed the lives of our people.

He is at this time transporting large Armies of foreign Mercenaries to compleat the works of death, desolation and tyranny, already begun with circumstances of Cruelty & perfidy scarcely paralleled in the most barbarous ages, and totally unworthy the Head of a civilized nation.

He has constrained our fellow Citizens taken Captive on the high Seas to bear Arms against their Country, to become the executioners of their friends and Brethren, or to fall themselves by their Hands.

He has excited domestic insurrections amongst us, and has endeavoured to bring on the inhabitants of our frontiers, the merciless Indian Savages, whose known rule of warfare, is an undistinguished destruction of all ages, sexes and conditions.

In every stage of these Oppressions We have Petitioned for Redress in the most humble terms: Our repeated Petitions have been answered only by repeated injury. A Prince whose character is thus marked by every act which may define a Tyrant, is unfit to be the ruler of a free people.

Nor have We been wanting in attentions to our Brittish brethren. We have warned them from time to time of attempts by their legislature to extend an unwarrantable jurisdiction over us. We have reminded them of the circumstances of our emigration and settlement here. We have appealed to their native justice and magnanimity, and we have conjured them by the ties of our common kindred to disavow these usurpations, which, would inevitably interrupt our connections and correspondence. They too have been deaf to the voice of justice and of consanguinity. We must, therefore, acquiesce in the necessity, which denounces our Separation, and hold them, as we hold the rest of mankind, Enemies in War, in Peace Friends.

We, therefore, the Representatives of the united States of America, in General Congress, Assembled, appealing to the Supreme Judge of the world for the rectitude of our intentions, do, in the Name, and by Authority of the good People of these Colonies, solemnly publish and declare, That these United Colonies are, and of Right ought to be Free and Independent States; that they are Absolved from all Allegiance to the British Crown, and that all political connection between them and the State of Great Britain, is and ought to be totally dissolved; and that as Free and Independent States, they have full Power to levy War, conclude Peace, contract Alliances, establish Commerce, and to do all other Acts and Things which Independent States may of right do. And for the support of this Declaration, with a firm reliance on the protection of divine Providence, we mutually pledge to each other our Lives, our Fortunes and our sacred Honor."""
ciphertext = """CUXQAUDRERAUFJUCKRACUXQAUDRXFGAUFJUCKRACUXQAUDRQWRFJXCAOFKCUXQAUDRQWRFJJFFSCADZRAACUXQAUDRRNFYDFJERSCRJCUXQAUDRRNFYDFJCZYGROMSCUPCUXQAUDRARQAFZFJSCWDUCUXQAUDRARQAFZFJOQGTZRAACUXQAUDRANGCZWFJDFNRCUXQAUDRXCZURGFJORANQCGXRDQORLRGPUDCZWERJFGRMAXRDQOZFUDCZWERJFGRMAXRXRGRQSSWFCZWOCGRYUUFDRQLRZXRXRGRQSSWFCZWOCGRYUUDRFUDRGXQPCZADFGUUDRNRGCFOXQAAFJQGSCTRUDRNGRARZUNRGCFOUDQUAFKRFJCUAZFCACRAUQMUDFGCUCRACZACAUROFZCUAERCZWGRYRCLROJFGWFFOFGJFGRLCSCZUDRAMNRGSQUCLRORWGRRFJYFKNQGCAFZFZSPUDRGRXRGRQTCZWXCUDQSQGWRHQXQZOQIMRRZXCUDQNSQCZJQYRFZUDRUDGFZRFJRZWSQZOUDRGRXRGRQTCZWXCUDQSQGWRHQXQZOQIMRRZXCUDQJQCGJQYRFZUDRUDGFZRFJJGQZYRCZEFUDYFMZUGCRACUXQAYSRQGRGUDQZYGPAUQSUFUDRSFGOAFJUDRAUQURNGRARGLRAFJSFQLRAQZOJCADRAUDQUUDCZWACZWRZRGQSXRGRARUUSROJFGRLRGCUXQAUDRPRQGFJFMGSFGOFZRUDFMAQZOARLRZDMZOGROQZOARLRZUPJCLRANCGCUMQSGRLRSQUCFZAXRGRYFZYROROUFRZWSQZOQUUDQUJQLFMGRONRGCFOQAQUUDCAKGAAFMUDYFUUDQOGRYRZUSPQUUQCZRODRGJCLRQZOUXRZUCRUDESRAAROECGUDOQPFJXDFKQNGFNDRUCYNGCLQURCZUDRSCJRWMQGOADQODRGQSOROUDRAMESCKRQNNRQGQZYREPQZZFMZYCZWUDQUQGGQZWRKRZUAXRGRKQORJFGUDRAXQSSFXCZWMNFJSFZOFZQZOXRAUKCZAURGRLRZUDRYFYTSQZRWDFAUDQOERRZSQCOFZSPQGFMZOOFVRZFJPRQGAQJURGGQNNCZWFMUCUAKRAAQWRAQAUDRANCGCUAFJUDCALRGPPRQGSQAUNQAUAMNRGZQUMGQSSPORJCYCRZUCZFGCWCZQSCUPGQNNROFMUUDRCGAKRGRKRAAQWRACZUDRRQGUDSPFGORGFJRLRZUADQOSQURSPYFKRUFUDRRZWSCADYGFXZQZONRFNSRJGFKQYFZWGRAAFJEGCUCADAMEHRYUACZQKRGCYQXDCYDAUGQZWRUFGRSQURDQLRNGFLROKFGRCKNFGUQZUUFUDRDMKQZGQYRUDQZQZPYFKKMZCYQUCFZAPRUGRYRCLROUDGFMWDQZPFJUDRYDCYTRZAFJUDRYFYTSQZREGFFOJGQZYRSRAAJQLFMGROFZUDRXDFSRQAUFKQUURGAANCGCUMQSUDQZDRGACAURGFJUDRADCRSOQZOUGCORZUGFSSROXCUDRBYRROCZWAKFFUDZRAAOFXZDCSSKQTCZWNQNRGKFZRPQZOANRZOCZWCUMZORGUDRWMCOQZYRFJDRGYDGCAUCQZNQAUFGAADRRZURGUQCZRODRGARSJERACORAXCUDAMYDDMKQZRQYDCRLRKRZUAQAARZURZYCZWQPFMUDUFDQLRDCADQZOAYMUFJJDCAUFZWMRUFGZFMUXCUDNCZYRGAQZODCAEFOPEMGZROQSCLRERYQMARDRDQOZFUTZRRSROOFXZCZUDRGQCZUFOFDFZFMGUFQOCGUPNGFYRAACFZFJKFZTAXDCYDNQAAROXCUDCZDCALCRXQUQOCAUQZYRFJAFKRJCJUPFGACBUPPQGOACUCASCTRSPRZFMWDUDQUGFFUROCZUDRXFFOAFJJGQZYRQZOZFGXQPUDRGRXRGRWGFXCZWUGRRAXDRZUDQUAMJJRGRGXQANMUUFORQUDQSGRQOPKQGTROEPUDRXFFOKQZJQURUFYFKROFXZQZOERAQXZCZUFEFQGOAUFKQTRQYRGUQCZKFLQESRJGQKRXFGTXCUDQAQYTQZOQTZCJRCZCUURGGCESRCZDCAUFGPCUCASCTRSPRZFMWDUDQUCZUDRGFMWDFMUDFMARAFJAFKRUCSSRGAFJUDRDRQLPSQZOAQOHQYRZUUFNQGCAUDRGRXRGRADRSURGROJGFKUDRXRQUDRGUDQULRGPOQPGMORYQGUAERANQUURGROXCUDGMAUCYKCGRAZMJJROQEFMUEPNCWAQZOGFFAUROCZEPNFMSUGPXDCYDUDRJQGKRGORQUDDQOQSGRQOPARUQNQGUUFERDCAUMKEGCSAFJUDRGRLFSMUCFZEMUUDQUXFFOKQZQZOUDQUJQGKRGUDFMWDUDRPXFGTMZYRQACZWSPXFGTACSRZUSPQZOZFFZRDRQGOUDRKQAUDRPXRZUQEFMUXCUDKMJJSROUGRQOUDRGQUDRGJFGQAKMYDQAUFRZURGUQCZQZPAMANCYCFZUDQUUDRPXRGRQXQTRXQAUFERQUDRCAUCYQSQZOUGQCUFGFMACZRZWSQZOUDRGRXQAAYQGYRSPQZQKFMZUFJFGORGQZONGFURYUCFZUFHMAUCJPKMYDZQUCFZQSEFQAUCZWOQGCZWEMGWSQGCRAEPQGKROKRZQZODCWDXQPGFEERGCRAUFFTNSQYRCZUDRYQNCUQSCUARSJRLRGPZCWDUJQKCSCRAXRGRNMESCYSPYQMUCFZROZFUUFWFFMUFJUFXZXCUDFMUGRKFLCZWUDRCGJMGZCUMGRUFMNDFSAURGRGAXQGRDFMARAJFGARYMGCUPUDRDCWDXQPKQZCZUDROQGTXQAQYCUPUGQORAKQZCZUDRSCWDUQZOERCZWGRYFWZCAROQZOYDQSSRZWROEPDCAJRSSFXUGQORAKQZXDFKDRAUFNNROCZDCAYDQGQYURGFJUDRYQNUQCZWQSSQZUSPADFUDCKUDGFMWDUDRDRQOQZOGFORQXQPUDRKQCSXQAXQPSQCOEPARLRZGFEERGAQZOUDRWMQGOADFUUDGRRORQOQZOUDRZWFUADFUORQODCKARSJEPUDRFUDRGJFMGCZYFZARIMRZYRFJUDRJQCSMGRFJDCAQKKMZCUCFZQJURGXDCYDUDRKQCSXQAGFEEROCZNRQYRUDQUKQWZCJCYRZUNFURZUQURUDRSFGOKQPFGFJSFZOFZXQAKQORUFAUQZOQZOORSCLRGFZUMGZDQKWGRRZEPFZRDCWDXQPKQZXDFORANFCSROUDRCSSMAUGCFMAYGRQUMGRCZACWDUFJQSSDCAGRUCZMRNGCAFZRGACZSFZOFZWQFSAJFMWDUEQUUSRAXCUDUDRCGUMGZTRPAQZOUDRKQHRAUPFJUDRSQXJCGROESMZORGEMAARACZQKFZWUDRKSFQOROXCUDGFMZOAFJADFUQZOEQSSUDCRLRAAZCNNROFJJOCQKFZOYGFAARAJGFKUDRZRYTAFJZFESRSFGOAQUYFMGUOGQXCZWGFFKAKMATRURRGAXRZUCZUFAUWCSRAAUFARQGYDJFGYFZUGQEQZOWFFOAQZOUDRKFEJCGROFZUDRKMATRURRGAQZOUDRKMATRURRGAJCGROFZUDRKFEQZOZFEFOPUDFMWDUQZPFJUDRARFYYMGGRZYRAKMYDFMUFJUDRYFKKFZXQPCZUDRKCOAUFJUDRKUDRDQZWKQZRLRGEMAPQZORLRGXFGARUDQZMARSRAAXQACZYFZAUQZUGRIMCACUCFZZFXAUGCZWCZWMNSFZWGFXAFJKCAYRSSQZRFMAYGCKCZQSAZFXDQZWCZWQDFMAREGRQTRGFZAQUMGOQPXDFDQOERRZUQTRZFZUMRAOQPZFXEMGZCZWNRFNSRCZUDRDQZOQUZRXWQUREPUDROFVRZQZOZFXEMGZCZWNQKNDSRUAQUUDROFFGFJXRAUKCZAURGDQSSUFOQPUQTCZWUDRSCJRFJQZQUGFYCFMAKMGORGRGQZOUFKFGGFXFJQXGRUYDRONCSJRGRGXDFDQOGFEEROQJQGKRGAEFPFJACBNRZYRQSSUDRARUDCZWAQZOQUDFMAQZOSCTRUDRKYQKRUFNQAACZQZOYSFARMNFZUDRORQGFSOPRQGFZRUDFMAQZOARLRZDMZOGROQZOARLRZUPJCLRRZLCGFZROEPUDRKXDCSRUDRXFFOKQZQZOUDRJQGKRGXFGTROMZDRROROUDFARUXFFJUDRSQGWRHQXAQZOUDFARFUDRGUXFFJUDRNSQCZQZOUDRJQCGJQYRAUGFOXCUDAUCGRZFMWDQZOYQGGCROUDRCGOCLCZRGCWDUAXCUDQDCWDDQZOUDMAOCOUDRPRQGFZRUDFMAQZOARLRZDMZOGROQZOARLRZUPJCLRYFZOMYUUDRCGWGRQUZRAARAQZOKPGCQOAFJAKQSSYGRQUMGRAUDRYGRQUMGRAFJUDCAYDGFZCYSRQKFZWUDRGRAUQSFZWUDRGFQOAUDQUSQPERJFGRUDRK"""

alphabet = list(build_alphabet(name="upper"))
unassigned = "*"
key_start = "\n".join(["".join(alphabet), "".join([unassigned] * 26)])

# Remove all non alphabetic characters and capitalize
def encode(text: str):
    stripped = sub(r"[^a-zA-Z]", "", text)
    return stripped.upper()

# Decrypt a string using the given key    
def decrypt(text: str, key: dict):
    text = encode(text)
    o = ""
    for x in text:
        if key[x] == unassigned:
            o += f'<span style="color: #dddddd;">{x}</span>'
        else:
            o += key[x]
    return o

# Prints an output div aligning with the interact controls   
def output_div(label: str, content: str):
    s = '<div class="sagecell_interactControlCell" style="width: 100%;">'
    s += f'<label class="sagecell_interactControlLabel">{label}</label>'
    s += f'<div class="sagecell_interactControl">{content}</div>'
    s += '</div>'
    pretty_print(html(s))
    
# Separates a string into groups of n letters for convenience
def separate(text: str, n=5):
    return " ".join(text[i:i+n] for i in range(0, len(text), n))
    
# Returns a frequency dictionary corresponding to a count dictionary
def counts_to_freqs(counts):
    total = sum(counts.values())
    return {k: (1.0*n/total) for k, n in counts.items()}
    
# Validate the input key
def validate(input_key):
    if len(input_key) != len(key_start):
        raise Exception("Do not add or remove characters to the key")
    if input_key[:27] != key_start[:27]:
        raise Exception("Do not change the first row of the key")
    valid = alphabet + [unassigned]
    if len([x for x in input_key[27:] if x not in valid]):
        raise Exception(f"Every character in second row of key must be a capital letter or {unassigned}")
    counts = Counter([x for x in input_key[27:] if x != unassigned])
    for n in counts.values():
        if n > 1:
            raise Exception("Do not repeat letters in the second row")
    return {x: y for x, y in zip(alphabet, input_key[27:])}

@interact
def _(cipher=input_box(default=ciphertext, label="Cipher", height=5, width=70),
      sample=input_box(default=sampletext, label="Sample", height=5, width=70),
      input_key=input_box(default=key_start, label="Key", height=2, width=70)):  
    if not cipher.isalpha() or not cipher.isupper():
        raise Exception("Ciphertext must consist only of uppercase characters")
    
    # Key check  
    key = validate(input_key)
    
    # Calculate frequencies
    alphabet = list(build_alphabet(name="upper"))
    sample = encode(sample)
    sample_freq = counts_to_freqs(Counter(sample))
    cipher_freq = counts_to_freqs(Counter(cipher))
    
    o = '<table style="font-size: 0.7em; text-align: center;"><tr><td></td>'
    for x in alphabet:
        o += f"<td style='padding-right: 0.5em;'>{x}</td>"
    o += "</tr>"
    for i, f in enumerate([cipher_freq, sample_freq]):
        y = "Cipher" if i == 0 else "Sample"
        o += f"<tr><td style='padding-right: 0.5em;'>{y}</td>"
        for x in alphabet:
            o += f"<td style='padding-right: 0.5em;'>{100*f.get(x, 0):.1f}</td>"
        o += "</tr>"
    
    o += "</table>"
    output_div("Percent", o)
    
    # Calculate and filter ranked lists
    sample_sorted = sorted(alphabet, key=lambda x: sample_freq.get(x, 0), reverse=True)
    cipher_sorted = sorted(alphabet, key=lambda x: cipher_freq.get(x, 0), reverse=True)
    sample_ranked = "".join(x for x in sample_sorted if x not in key.values())
    cipher_ranked = "".join(x for x in cipher_sorted if key[x] == unassigned)
    
    s = "(Cipher) "
    s += separate(cipher_ranked)
    s +="<br/>"
    s += "(Sample) "
    s += separate(sample_ranked)
    output_div("Ranked", s)
    
    # Display decrypted text
    output = decrypt(cipher, key)
    output_div("Output", f'<div style="inline-size: 45em; overflow-wrap: break-word;">{ output }</div>')
</script>
</div>
</div>
<div class="element">
<p><span class="label">Exercise</span> The following ciphertext was
encrypted using a simple substitution. Find the corresponding
plaintext!</p>
<textarea readonly rows=10 style="width: 100%;">YJCRGYRUHAKEXLAGXOFHFOGZRYAHRMZAXOUHAIEAFOFOGFOIXAOUURPORDNKAUUROHAKHMZNFOGZDFYXEJHFGNAAOKAZXGAOUZUHAKADRKCAOAKFUXROZFOGNRKAXOGAAGUHAOFYARDUHAXKNXKUHTEFIANKAUURORDNKAUUROPHAUHAKNJIRXOIXGAOIARKNAIFMZAZRYAKAYRUAFOIAZURKHFGNAAOFTAKZROFCARDZMDDXIXAOUXYTRKUFOIAUREAFLAHXZOFYAURHXZOAXCHNRMKHRRGXQORPORUPHAOXPFZFCXKEXPAOUURNKAUUROFNRMUUPXIAFJAFKFOGPAEEXEXQAGUHALXZXUUHAHRMZAFOGXUZXOYFUAZZTAIXFEEJZMXUAGYAUHAEFKCATAFIADMEKRRYZUHAPAEEFKKFOCAGDMKOXUMKAUHAIEAFKPXGAPXOGRPZUHANFEIROJRMUZXGAERRQXOCGRPOROFDXOAFOUXSMAZUKAAUPHAKAZMOGFJZFOGHREXGFJZZAAYAGFEPFJZURFNXGAZRSMXAUPFZXUZFUYRZTHAKAZRIEAFOXUZTFLAYAOUUHAZAUHXOCZTEAFZAGYAPAEEROAIHXEGXOFHRMZAHREGRDCKRPOTARTEAXZMZMFEEJYFGALAKJYMIHRDFOGXOFSMXAUPFJXPFZFCRRGGAFEUFQAOORUXIARDNJYKZNKAUUROPHRHFGNAAOEADUFPXGRPPXUHROAZRONADRKAXQOAPHAKHAKHMZNFOGFTHJZXIXFOHFLXOCGXAGPHXEAZHAPFZJAUFJRMOCFOGHFOGZRYAPRYFOZHAPFZORUJRMOCFZXKAYAYNAKHAKNMUZHAPFZZUXEEHFOGZRYAUFEEPAEEYFGAFOGUHRMCHGFKQDRKFOAOCEXZHPRYFOJAUPAFKXOCFEPFJZUHAIEAFKOAZZRDHAFEUHXOHAKNKMOAUUAIHAAQFOGXUZLXLFIXUJXOFTFXKRDDXOAIHAAKDMENEFIQAJAZTARTEAAZUAAYAGXUFCKXALRMZTXUJUHFUZHAHFGORUIRODAKKAGHAKIRYTEAVXROROHAKZROPHRZAAJAZPAKANEMAUHRMCHALAOXONRJHRRGLAKJTXAKIXOCFOGUHAIRERMKRDHXZEROCHFXKZMIHFZDKXAOGZGXGORULAOUMKAURZTAIXDJAVIATUFZUHAZMOZHROAROXUPHAOUHAJIFEEAGXUCREGAOHAXOHAKXUAGUHAEXOAZRDHXZYRUHAKZDAFUMKAZHRPALAKFEZRHAKCRRGUAAUHHAKZUFUMKARKUHATKRYXZARDHAKZUFUMKADRKHAPFZORUJAUDMEECKRPOFOGPHFUPFZNAUUAKHAKHAFEUHPXUHRMUDEFPFOGHAKZTXKXUZRDUHFUUROAFOGASMFEXUJPHXIHFKANAUUAKUHFOFDRKUMOAURUHATRZZAZZRKXOUHAFMUMYORDUHAJAFKXPFZZUFJXOCFUNKAUUROYJCRGYRUHAKHFLXOCIRYAXOTAKZROURIEFXYYARDUHAQXOZDREQPXUHPHRYPFZFUUHFUUXYADXVAGYJTAKYFOAOUKAZXGAOIAXNAEXALAZHAUHAOTEFXOEJZFPALAOUZIRYXOCPHRZALAKJZHFGRPXZIFKIACMAZZAGJAURDPHXIHUHADFXOUZMZTXIXROZMDDXIAGURXYTFKUMOZAUUEAGZFGOAZZFOGYFGAYACEFGURIHFOCAZIAOAFOGZRIXAUJUXYAFEPFJZDERPAGZYRRUHEJDRKYAFUYJCRGYRUHAKZZXGAORUPXUHUMYMEUMRMZZPXDUOAZZNMUNEFOGEJEXQAUHACEXGXOCRDFDMEEKXLAKUHKRMCHFTEFXOYJLXZXUZURHAKKAZAYNEAGUHAZRBRMKORDIHKXZUXFOFOGHRTADMENAZXGAFIAKUFXOTEAFZFOUZUKAFYPXUHCKAAOUKAAZROAFIHNFOQFOGYAFGRPZNAFMUXDXAGPXUHEXEXAZFEEUHAJAFKKRMOGUHAIHFKYRDLFKXAUJUHAKAPFZORUORKUHAAVIXUAYAOURDXOIXGAOUNMUXEXQAGTAFIAZRPAEEFOGZRMCHUZUXYMEMZZREXUUEAUHFUPHAOUHAEFUUAKIFYAXFEYRZUDAEUXUFGXZUMKNFOIAFOGPXZHAGKFUHAKXUHFGZUXEEHAEGFERRDROAGFJFEAUUAKPFZKAIAXLAGRDPHXIHUHAIROUAOUZALXGAOUEJIFMZAGYKZNKAUUROZMKTKXZAFOGZRYAIROIAKOXUHRMCHUFUDXKZUXUPFZDKRYHRYAFOGUKAYNEAGAVTAIUXOCXQORPORUPHFUGXZFZUKRMZIRYYMOXIFUXROURYAHRPALAKORKADAKAOIAPFZYFGAFOGUHAIERMGZAAYAGURTFZZUHAOAVUGFJROYJKAUMKODKRYFEROCPFEQXDRMOGFZXAOUAKAGYJNAGKRRYFOMOAVTAIUAGIHFOCAXOFGGXUXROURYJRPODKAOIHNAGXOXUZZHFGJKAIAZZFTTAFKAGXOFIRKOAKFZYFEEIKXNGKFTAGPXUHPHXUAFOGXOFGGXUXROURYJYFHRCFOJIHAZURDGKFPAKZXZFPFUXOJKRZAPRRGIHAZUXZURRGZUXEECFWAGFOGIROZXGAKAGRDPHFUFKAUHAZAUHXOCZUHAZXCOZFOGURQAOZXFZQAGUHAFOZPAKPFZRNLXRMZFZAIROGCMAZUXZIRYXOCYKZNKAUUROAVTAIUZRUHAKLXZXURKZROGAZIAOGXOCURGXOOAKAVTEFOFUXROZAOZMAGFEXUUEACXKEXPFZUREGPRMEGZHRKUEJNAYJIRYTFOXROUHAGFMCHUAKRDFDKXAOGFOGGXZUFOUKAEFUXRORDUHAEFUAGKNKAUUROZUHXZEXUUEACXKEXUPFZFGGAGHFGKAIAOUEJERZUHAKYRUHAKUHRMCHXOGAAGYKZNKAUUROAKAEROCZMNBRXOAGUHAERZZPFZORUZRCKAFUFZYXCHUFUDXKZUFTTAFKYKZHRYAHRYAXUZAAYZPFZUHAOFYAHFGNAAOFLAKJTKAUUJNMUFCXGGJIFKAEAZZPRYFOPHRHFGOACEAIUAGHAKIHXEGFOGGXZFTTRXOUAGFOGGXZHAFKUAOAGHAKHMZNFOGZRDFKDKRYIROCAOXFEHFGUHAMOXROTKRLAGUHFUZATFKFUXROFUEFZUAOZMAGZATFKFUXRONJYMUMFEIROZAOUORUFDUAKFOJEACFETKRIAZZZRROFDUAKUHXZALAOUUHAEFGJHFLXOCRLAKAVAKUAGHAKZAEDFUFNFEEIFMCHUIREGURRQFDALAKFOGGXAGFDUAKFLAKJNKXADXEEOAZZHAKHMZNFOGOFUMKFEEJFYFORDLAKJZAOZXUXLADAAEXOCZFOGZHRIQAGXOAVTKAZZXNEJNJURRZMGGAOIRYYMOXIFUXRORDUHAOAPZIRMEGHFKGEJXUZAAYZORPNATAKZMFGAGNMUUHFUZRYARLAKZALAKXUJROHXZTFKUZRYAGADXIXAOIJXOTFUXAOIAFOGXOGMECAOIAHFGIROUKXNMUAGURHFZUAOHAKAOGHAHFGNKRRGAGRLAKUHXZXGAFUXEEHXZZTXKXUZPAKAZAKXRMZEJFDDAIUAGUHAYAGXIFEYAOXOZXZUAGROUKFLAEEXOCNAXOCUKXAGFZFKAYAGJFOGYAFOPHXEAYKZNKAUUROHFGRDDAKAGURUFQAIHFKCARDHXZEXUUEACXKEFOGXHRTAFGGAGYJCRGYRUHAKXOIROIEMZXROUHAIHXEGPXEEORUNAEXQAHAKYFYYFFZZXEEJFOGDKXLRERMZFEXUUEADEXKUFZALAKZAOZXNEAYFOPFZPAFQAORMCHURYFKKJDRKZFXGZHAYKHRYAXZFZAOZXNEAYFOXOHXZPFJUHRMCHORULAKJTKFIUXIFEHAXZDROGRDZIXAOIAFOGEXLAZHFEDHXZEXDAXOFEFNRKFURKJUKJXOCAVTAKXYAOUZFUHXOCHXZNMUUAKDEJPXDAIRMEGOAXUHAKIRYTKAHAOGORKAOGMKAFOGXOGAAGIRODAZZAGYJCRGYRUHAKXZHRMEGORUHFLAEXQAGXUYJZAEDXOFOZPAKURFSMAZUXRORDYXOAZHADMKUHAKXODRKYAGYAUHFUHAKEFUAHMZNFOGMZAGURZFJYKHRYAHFGGAKXLAGUHXZZIXAOUXDXIUMKODKRYFYFUAKOFEMOIEAFDKAOIHZFLFOUDRKHAIFYAXUZAAYZRDYXVAGDKAOIHFOGZIRUUXZHRKXCXOFOGHFGIROOAIUXROZORPEXLXOCXODKFOIARDPHRYYRKAUHFOROAPKRUAGANADRKAHXZOFYAFOGIFEEAGHXYZAEDORNEAUHFUZFYAALAOXOCFUOXOARIERIQFZAKLFOUPFZGAZTFUIHAGURYAAUUHAIRFIHNJPHXIHRMKEXUUEALXZXURKPFZAVTAIUAGYKZNKAUUROFOGXZFUFEROAXOUHAGKFPXOCKRRYPFXUXOCHAKIRYXOCBRHOCKFHFYNKAUURONAXOCFNZAOUROFLXZXUURROARDHXZZIHRREDAEERPZPHREXLAGXOUHAIRMOUKJYJCRGYRUHAKKAFGUHAALAOXOCTFTAKPHXEAZHAPFXUAGXZAPAGXUPFZFPAUOXCHUUHAKFXOEFZHAGUHATFOAZFOGUHAPXOGZRMOGAGFOCKJFOGKAZUEAZZTRRKIHXEGZFXGYKZNKAUURODKRYUXYAURUXYAPHFUPAFUHAKDRKHAKBRMKOAJXPXZHZHAPAKAZFDAHAKAFEXUUEANADRKAUAOUHAGRRKNAEEFOORMOIAGPFKKAOZKAUMKOORZRROAKPFZUHAGRRKRTAOAGUHFOXKFOGRPOXOURUHAHFEEUHAKAEFJFUKMOQFOGZRYANFOGNRVAZNAZXGAUHAYZURRGFTAKZROEXQAFOMKZACXKEFOGFUUHADRRURDUHAZUFXKIFZAPFZPFKKAOPXUHFZHFPEAGNMOGEAXOHXZFKYZXZUHFUUHAIHXEGXFZQAGJAZYXZZXPRMEGHFLARTAOAGUHAZHFPEFOGUKXAGURCAUFTAATFUUHADFIANMUXUPFZHFZUXEJUMKOAGDKRYYAURPFKKAOZZHRMEGAKTMUYAGRPOTEAFZAZFXGFZYFEELRXIAPHAOPFKKAORTAOAGUHAGKFPXOCKRRYGRRKFOGUFQARDDUHXZZHFPEIROUXOMAGUHAZTAFQAKAVUKFIUXOCPXUHXUZYXOMUAHFOGUHATXOFOGPXUHFZRKURDDFZUXGXRMZHFZUAGRDDXOCUHAIEMYZJPKFTTXOCUHAIKAFUMKAPHXIHORPFTTAFKAGYFGAFGADUFUUAYTUURDREGUHAZHFPENMUUHAGKFTAKJPFZYMIHURRHAFLJFOGEFKCAURNAZMZUFXOAGRKPXAEGAGNJUHRZAHFOGZFOGFKYZCXLAXUURHFKKXAUTEAFZAPFZUHAOUHAGXKAIUXROFOGZHAIFOTMUXUFPFJUHXZZFXGXUUMKOAGFOGDXVAGXUZAJAZROYKZNKAUURO</textarea>
</div>
<div class="element">
<p><span class="label">Exercise</span> Why will the frequency analysis
strategy we’ve just described fail for ciphertexts encrypted using
rectangular transposition?</p>
</div>
<div class="element">
<p><span class="label">Exercise</span> The strategy as we’ve described
it above doesn’t work verbatim for Polybius squares. How would you adapt
this strategy to get it to work for a Polybius square? Explain in your
own words why breaking a Polybius square will be “just as easy” as what
we’ve described above.</p>
</div>
<div class="element">
<p><span class="label">Exercise</span> The strategy as we’ve described
it above doesn’t work verbatim for digraphic substitution schemes like
the Hill and Playfair ciphers. How would you adapt this strategy to get
it to work for these digraphic substitution ciphers? Do you have any
concerns about applying this strategy? In other words, what reasons can
you give to support the idea that these digraphic substitution ciphers
will be harder to break than simple substitution ciphers using the
strategy we’ve outlined above?</p>
</div>
<div class="element">
<p><span class="label">Harder Sage Exercise</span> Adapt the code for
the SageCell above so that it can help with decrypting digraphic
substitution schemes.</p>
</div>
<p>In the sections that follow, we’ll elaborate on the ideas we’ve seen
in this section to see how variants of the same fundamental observation
— that English text exhibits certain patterns — can be used to mount
attacks on other ciphers. But first, we must develop some theory.</p>
<h2 id="probability">3.3. Interlude: Probability</h2>
<h3 id="experiments-and-events">Experiments and Events</h3>
<p>In probability theory, the word “experiment” is used to talk
abstractly and heuristically about processes which generate “outcomes”
and which might be rather intricate. These experiments are formally
modeled by <em>probability spaces</em>. The general definition requires
a background in measure theory, which is not a prerequisite for this
course, so we won’t make the general definition. Instead, we’ll use the
following:</p>
<div class="element">
<p><span class="label">Definition</span> A <em>(discrete) probability
space</em> is a nonempty countable set <span
class="math inline">\(\Omega\)</span> called the <em>sample space</em>
and whose elements are called <em>outcomes</em>. Each outcome <span
class="math inline">\(x \in \Omega\)</span> is assigned a real number
<span class="math inline">\(P[x]\)</span> between 0 and 1 called its
<em>probability</em>, and the probabilities of all of the outcomes must
sum to 1. <span class="math display">\[ \sum_{x \in \Omega} P[x] = 1.
\]</span></p>
</div>
<p>“Countable” means the the outcomes can be put into a list so that the
summation <span class="math inline">\(\sum_{x \in \Omega} P[x]\)</span>
makes sense. Any finite set is countable. Some infinite sets are also
countable, but for now we’ll focus on the finite case.</p>
<p>The probability associated to each outcome should be thought of as
some measure of our “confidence” that our experiment will produce that
outcome. For example, it might be the percentage of times we expect the
experiment to produce that outcome if the experiment were to be repeated
many many times.</p>
<p>Rolling a dice is an example of an experiment. The possible outcomes
of this experiment are the numbers 1 through 6. In other words, the
sample space is <span class="math inline">\(\Omega = \{1, 2, 3, 4, 5,
6\}\)</span>. Assigning each outcome probability 1/6 means that the dice
is “fair” and each outcome is equally likely. We have thus constructed a
probability space: we have a finite set <span
class="math inline">\(\Omega\)</span> that enumerates the possible
outcomes, and we’ve assigned a probability to each outcome.</p>
<p>A single experiment can also have “multiple parts.” For example,
flipping a fair coin twice can be thought of as a single experiment.
Possible outcomes of this experiment might be something like “heads and
then heads again,” or “heads and then tails,” and so forth. All of these
outcomes taken together as a set form the sample space. If we abbreviate
heads as <span class="math inline">\(H\)</span> and tails as <span
class="math inline">\(T\)</span>, we might write <span
class="math inline">\(\Omega = \{HH, HT, TH, TT\}\)</span>. If we assign
each out these four outcomes probability 1/4, we’re modeling the
situation where the coin is fair and the result of each coin flip is
unrelated to the other.</p>
<p>In the two examples we’ve just seen, all of the outcomes have the
same probability. This is a very common situation and so it has a
special name:</p>
<div class="element">
<p><span class="label">Definition</span> A probability space is
<em>uniform</em> if all of its outcomes have equal probability.</p>
</div>
<p>It is sometimes useful to group various outcomes together. This is
accomplished by the following definition:</p>
<div class="element">
<p><span class="label">Definition</span> Given a probability space, an
<em>event</em> <span class="math inline">\(E\)</span> is a subset of the
sample space. We define <span class="math display">\[ P[E] = \sum_{x \in
E} P[x]. \]</span></p>
</div>
<p>Be careful: the words “event” and “outcome” feel somewhat similar in
day-to-day in English, but have distinct definitions in probability
theory!</p>
<p>Consider again the example of the rolling a dice. An “event” might be
something like “the dice roll is odd.” Formally, if we’re thinking of
the sample space <span class="math inline">\(\Omega = \{1, 2, 3, 4, 5,
6\}\)</span>, the event “the dice roll is odd” corresponds to the event
<span class="math inline">\(E = \{1, 3, 5\}\)</span>. This event is also
assigned a probability, just by summing together the probabilities of
all of the outcomes that comprise that event: <span
class="math display">\[ P[E] = P[1] + P[3] + P[5] = \frac{1}{6} +
\frac{1}{6} + \frac{1}{6} = \frac{3}{6} = \frac{1}{2}. \]</span></p>
<div class="element">
<p><span class="label">Exercise</span> Suppose you have 4 boxes (labeled
1, 2, 3, and 4), and you have 8 colors available (red, blue, green,
yellow, pink, purple, teal, brown). Consider an experiment where each of
the 4 boxes is assigned a color. For example, one possible outcome of
this experiment might be the one where box 1 is colored red, box 2 is
colored blue, box 3 is colored green, and box 4 is colored blue.</p>
<ol type="a">
<li>How many possible outcomes are there?</li>
<li>How many outcomes are in the event “no two boxes have the same
color”?</li>
</ol>
</div>
<div class="element">
<p><span class="label">Exercise</span> Suppose you have <span
class="math inline">\(k\)</span> boxes and you have <span
class="math inline">\(n\)</span> colors available. Consider again the
same experiment where each of the <span class="math inline">\(k\)</span>
boxes is assigned one of the <span class="math inline">\(n\)</span>
colors “at random” (ie, construct a uniform probability space). What is
the probability of the event that no two boxes have the same color? What
is the probability that there are at least two boxes of the same color?
Find expressions in terms of <span class="math inline">\(n\)</span> and
<span class="math inline">\(k\)</span>.</p>
</div>
<div class="element">
<p><span class="label">Sage Exercise</span> Write some code that takes
as input a positive integer <span class="math inline">\(n\)</span> and
returns the smallest positive integer <span
class="math inline">\(k\)</span> such that, when <span
class="math inline">\(k\)</span> boxes are assigned <span
class="math inline">\(n\)</span> colors at random, the probability that
there are at least two boxes of the same color is at least 50%. If you
run your code with <span class="math inline">\(n = 365\)</span>, you
should get <span class="math inline">\(k = 23\)</span> as output.
Explain what this has to do with the <a
href="https://en.wikipedia.org/wiki/Birthday_problem">birthday
paradox</a>.</p>
</div>
<div class="element">
<p><span class="label">Proof Exercise</span> Prove formally that, if a
discrete probability space is uniform, it must be finite.</p>
</div>
<h3 id="random-variables">Random Variables</h3>
<p>A very common way that events show up is by considering <em>random
variables</em>, which are mathematical gadgets that represent making an
observation (or taking a measurement) on the outcome of an experiment.
Each random variable has a set of possible values that the random
variable can take. Letters like <span class="math inline">\(X, Y,
\cdots\)</span> are used to denote random variables. If you like formal
definitions, here it is:</p>
<div class="element">
<p><span class="label">Definition</span> Fix a probability space <span
class="math inline">\(\Omega\)</span>. A <em>random variable</em> is a
function with domain <span class="math inline">\(\Omega\)</span>, and
its <em>set of (possible) values</em> is the range of this function.</p>
</div>
<p>For example, consider again the “multi-part” experiment we discussed
above where we flip a coin twice. Making an observation of the first
coin flip can be thought of as a random variable, which we will call
<span class="math inline">\(X\)</span>. This observation can be either
“heads” or “tails.” If we abbreviate “heads” and “tails” as <span
class="math inline">\(H\)</span> and <span
class="math inline">\(T\)</span> again, then we can write things like
<span class="math inline">\(X = H\)</span> to refer to the event that
the first coin flip landed heads. In other words, inside the sample
space <span class="math inline">\(\Omega = \{HH, HT, TH, TT\}\)</span>,
the notation <span class="math inline">\(X = H\)</span> describes the
event <span class="math inline">\(\{HH, HT\}\)</span> and we have <span
class="math display">\[ P[X = H] = P[HH] + P[HT] = \frac{1}{4} +
\frac{1}{4} = \frac{1}{2}. \]</span> There are many other observations
or measurements we could make with the same experiment. For example, we
might instead be interested in the number of heads. This is another
random variable; let’s call it <span class="math inline">\(Y\)</span>.
This can take values 0, 1, and 2. The notation <span
class="math inline">\(Y = 1\)</span> describes the event that we observe
1 heads out of the two coin flips, ie, the event <span
class="math inline">\(\{HT, TH\}\)</span>, and we have <span
class="math display">\[ P[Y = 1] = P[HT] + P[TH] = \frac{1}{4} +
\frac{1}{4} = \frac{1}{2}. \]</span> On the other hand, <span
class="math inline">\(Y = 0\)</span> corresponds to the singleton event
<span class="math inline">\(\{TT\}\)</span>, so <span
class="math display">\[ P[Y = 0] = P[TT] = \frac{1}{4}. \]</span> This
leads us to the following definition:</p>
<div class="element">
<p><span class="label">Definition</span> A random variable is
<em>uniform</em> if all of its values have equal probability.</p>
</div>
<p>In our example above, the random variable <span
class="math inline">\(X\)</span> is uniform but <span
class="math inline">\(Y\)</span> is not. With <span
class="math inline">\(X\)</span>, the two possible values are <span
class="math inline">\(H\)</span> and <span
class="math inline">\(T\)</span>, and both of those have probability
1/2. With <span class="math inline">\(Y\)</span>, however, there are
three possible values, with one of those values being twice as likely as
either of the other two.</p>
<div class="element">
<p><span class="label">Proof Exercise</span> Prove formally that, if
<span class="math inline">\(\Omega\)</span> is a discrete probability
space and <span class="math inline">\(X\)</span> is a uniform random
variable on <span class="math inline">\(\Omega\)</span>, then the set of
values of <span class="math inline">\(X\)</span> must be finite. (This
should be very similar to the last “Proof Exercise.”)</p>
</div>
<p>Here is another useful notion that comes up often when dealing with
random variables:</p>
<div class="element">
<p><span class="label">Definition</span> Suppose <span
class="math inline">\(X\)</span> is a random variable whose values are
real numbers. The <em>expected value</em> (or <em>expectation</em>) of
<span class="math inline">\(X\)</span>, denoted <span
class="math inline">\(E[X]\)</span>, is defined by <span
class="math display">\[ E[X] = \sum_{\text{values } a} a \cdot P[X = a].
\]</span></p>
</div>
<p>For example, in the experiment involving two coin flips, the random
variable <span class="math inline">\(Y\)</span> which counts the number
of heads has real number values. Its expectation is <span
class="math display">\[ E[Y] = 0 \cdot \frac{1}{4} + 1 \cdot \frac{1}{2}
+ 2 \cdot \frac{1}{4} = 1. \]</span></p>
<div class="element">
<p><span class="label">Exercise</span> Consider the experiment where you
roll a pair of fair dice. Let the random variable <span
class="math inline">\(X\)</span> denote the sum of the dice rolls.</p>
<ol type="a">
<li>What are the possible values of <span
class="math inline">\(X\)</span>?</li>
<li>What is <span class="math inline">\(P[X = 7]\)</span>?</li>
<li>What is <span class="math inline">\(P[X = 7 \text{ or }
11]\)</span>?</li>
<li>What is <span class="math inline">\(E[X]\)</span>?</li>
</ol>
</div>
<div class="element">
<p><span class="label">Exercise</span> Below are four versions of the
same game. Your archnemesis gets to pick the version of the game, and
then you get to choose how many times to flip a coin: 10 times or 100
times. Identify how many coin flips you should choose for each version
of the game. It costs $1 to play each game. Explain your reasoning.</p>
<ol type="a">
<li>If the proportion of heads is larger than 0.60, you win $1.</li>
<li>If the proportion of heads is larger than 0.40, you win $1.</li>
<li>If the proportion of heads is between 0.40 and 0.60, you win
$1.</li>
<li>If the proportion of heads is smaller than 0.30, you win $1.</li>
</ol>
</div>
<div class="element">
<p><span class="label">Exercise</span> Let’s say we play a game where we
keep flipping a fair coin until we’ve seen either one heads or three
tails overall.</p>
<ol type="a">
<li>What is the probability that you see strictly more tails than
heads?</li>
<li>What is the probability that you see strictly more heads than
tails?</li>
<li>How many flips are expected on average?</li>
<li>How many tails are expected on average?</li>
</ol>
</div>
<h2 id="conditional-probability">3.4. Interlude: Conditional
Probability</h2>
<p>We introduce a definition that looks very simple at first, but
actually introduces many counter-intuitive results. So before getting to
the definition, consider the following situation. Suppose Kambili and
Amaka both secretly flip two fair coins. Kambili announces that her
second flip was heads. Amaka announces that she had at least one heads.
Who’s more likely to have flipped two heads? In other words, if you had
to make a bet about who flipped more heads, who would you bet on? We’ll
discuss the answer to this question in more detail below. For now, just
think about what your intuition says.</p>
<div class="element">
<p><span class="label">Definition</span> Fix a probability space. Given
two events <span class="math inline">\(A\)</span> and <span
class="math inline">\(B\)</span>, we define the <em>conditional
probability</em> <span class="math inline">\(P[A \mid B]\)</span> by
<span class="math display">\[ P[A \mid B] = \frac{P[A \cap B]}{P[B]},
\]</span> where <span class="math inline">\(A \cap B\)</span> is the set
of all outcomes that are in both <span class="math inline">\(A\)</span>
and <span class="math inline">\(B\)</span>. The conditional probability
<span class="math inline">\(P[A \mid B]\)</span> is also called the
probability of <span class="math inline">\(A\)</span> <em>given</em>
<span class="math inline">\(B\)</span>.</p>
</div>
<p>The intuition here is that <span class="math inline">\(P[A \mid
B]\)</span> represents how confident we are that <span
class="math inline">\(A\)</span> happens <em>given that we already know
that <span class="math inline">\(B\)</span> happens</em>.</p>
<p>Let’s now see this definition in action. For many people (but not
everyone), the intuitive answer to the question posed at the beginning
of this section is, “both are equally likely.” If that’s what you
thought, you’re in good company. Unfortunately, it’s not correct!</p>
<p>To see why, let’s formalize what’s going on. The experiment we’re
considering involves two coin flips, so we’re again dealing with the
uniform probability space whose sample space is <span
class="math inline">\(\Omega = \{HH, HT, TH, TT\}\)</span>. The event of
interest <span class="math inline">\(A\)</span> is the singleton event
that both flips were heads, ie, <span class="math inline">\(A =
\{HH\}\)</span>.</p>
<p>In Kambili’s situation, we know that her second flip was heads. In
other words, we’re restricting ourselves to the event <span
class="math inline">\(B_1 = \{HH, TH\}\)</span>, and we have <span
class="math display">\[ P(A \mid B_1) = \frac{P(A \cap B_1)}{P(B_1)} =
\frac{P(A)}{P(B_1)} = \frac{1/4}{1/2} = \frac{1}{2}. \]</span> This
tells us that the probability that Kambili has two heads is 1/2. In
Amaka’s situation, we only that one of her flips was heads. In other
words, we’re now restricting ourselves to the event <span
class="math inline">\(B_2 = \{HH, TH, HT\}\)</span>, and we have <span
class="math display">\[ P(A \mid B_2) = \frac{P(A \cap B_2)}{P(B_2)} =
\frac{P(A)}{P(B_2)} = \frac{1/4}{3/4} = \frac{1}{3}. \]</span> This
tells us that the probability that Amaka has two heads is 1/3.</p>
<p>In other words, it’s more likely that Kambili has two heads! If we
had to bet on one of the two having more heads based on the information
we’ve been given, we should bet on Kambili.</p>
<p>Here are some exercise to practice:</p>
<div class="element">
<p><span class="label">Exercise</span> There are three coins in a bag.
One is a normal quarter: one side is heads, the other side is tails. The
second coin is almost identical except that both sides are heads;
similarly, both sides of the third coin are tails. You shake the bag
around to shuffle the coins. You then close your eyes, pull one coin out
at random, put it down on a table, and then open your eyes. You see
heads. What is the probability that the other side of the coin is also
heads?</p>
</div>
<div class="element">
<p><span class="label">Exercise</span> Explain what <a
href="https://xkcd.com/795/">this xkcd comic</a> has to do with
conditional probability.</p>
</div>
<div class="element">
<p><span class="label">Exercise</span> Suppose 80% of people like peanut
butter, 89% like jelly, and 78% like both. Given that a randomly sampled
person likes peanut butter, what’s the probability that they also like
jelly?</p>
</div>
<div class="element">
<p><span class="label">Exercise</span> Lupus is a medical phenomenon
where antibodies that are supposed to attack foreign cells to prevent
infections instead see plasma proteins as foreign bodies, leading to a
high risk of blood clotting. It is believed that 2% of the population
suffers from this disease. A test for lupus is 98% accurate if a person
actually has the disease, and 74% accurate if a person does not have the
disease. There is a line from the Fox television show <em>House</em>
that is often used after a patient tests positive for lupus: “It’s never
lupus.” Do you think there is truth to this statement? Use appropriate
probabilities to support your answer.</p>
</div>
<div class="element">
<p><span class="label">Harder Exercise</span> Suppose you play the
following game. You roll two fair dice. Let <span
class="math inline">\(U\)</span> be the sum of the numbers on the two
dice.</p>
<ul>
<li>If <span class="math inline">\(U = 7\)</span> or <span
class="math inline">\(11\)</span>, you win.</li>
<li>If <span class="math inline">\(U = 2, 3\)</span>, or <span
class="math inline">\(12\)</span>, you lose.</li>
<li>Otherwise, you roll both dice repeatedly until one of the following
happens:
<ul>
<li>If you roll <span class="math inline">\(U\)</span> again, you
win.</li>
<li>If you roll 7, you lose.</li>
</ul></li>
</ul>
<p>What is the probability that you win?</p>
</div>
<p>The idea of conditional independence leads us to the following
important definition that occurs frequently in probability theory:</p>
<div class="element">
<p><span class="label">Definition</span> Fix a probability space. We say
that two events <span class="math inline">\(A\)</span> and <span
class="math inline">\(B\)</span> are <em>independent</em> if <span
class="math display">\[ P(A \cap B) = P(A) P(B). \]</span></p>
</div>
<p>It is often most convenient to reformulate this definition slightly.
In the case that <span class="math inline">\(P(B) &gt; 0\)</span>,
observe that <span class="math inline">\(P(A \cap B) = P(A)
P(B)\)</span> is equivalent to <span class="math inline">\(P(A \cap
B)/P(B) = P(A)\)</span>. But the left-hand side of this equation is
<span class="math inline">\(P(A \mid B)\)</span> by definition, so we
see that independence of <span class="math inline">\(A\)</span> and
<span class="math inline">\(B\)</span> is equivalent to asserting that
<span class="math display">\[ P(A \mid B) = P(A). \]</span> This
statement should be interpreted as follows: if <span
class="math inline">\(A\)</span> and <span
class="math inline">\(B\)</span> are independent, our confidence in
<span class="math inline">\(A\)</span> happening does not change at all
even if we’re told that <span class="math inline">\(B\)</span> happened
(or that it did not happen). More loosely, knowing whether or not <span
class="math inline">\(B\)</span> happens tells us “nothing” about
whether or not <span class="math inline">\(A\)</span> happens!</p>
<div class="element">
<p><span class="label">Exercise</span> The American Community Survey is
an ongoing survey that provides data every year to give communities the
current information they need to plan investments and services. The 2010
American Community Survey estimates that 14.6% of Americans live below
the poverty line, 20.7% speak a language other than English at home, and
4.2% fall into both categories. Is the event that a randomly chosen
American lives below the poverty line independent of the event that the
person speaks a language other than English at home?</p>
</div>
<div class="element">
<p><span class="label">Exercise</span> A bag contains 5 red marbles and
3 blue marbles. Two marbles are drawn randomly from the bag: Alejandra
takes the first one and Beatrice takes the second. Is the event that
Alejandra’s marble is blue independent of the event that Beatrice’s
marble is blue?</p>
</div>
<div class="element">
<p><span class="label">Exercise</span> Fix a probability space <span
class="math inline">\(\Omega\)</span> and two events <span
class="math inline">\(A\)</span> and <span
class="math inline">\(B\)</span>. Let <span class="math inline">\(\neg
B\)</span> denote the event that <span class="math inline">\(B\)</span>
does not happen, ie, <span class="math inline">\(\neg B = \Omega
\setminus B\)</span>. Show that <span class="math inline">\(A\)</span>
and <span class="math inline">\(B\)</span> are independent if and only
if <span class="math inline">\(A\)</span> and <span
class="math inline">\(\neg B\)</span> are independent.</p>
</div>
<p>There is also a version of this definition for random variables.</p>
<div class="element">
<p><span class="label">Definition</span> Fix a probability space. Two
random variables <span class="math inline">\(X\)</span> and <span
class="math inline">\(Y\)</span> are <em>independent</em> if the events
<span class="math inline">\(X = a\)</span> and <span
class="math inline">\(Y = b\)</span> are independent for all pairs <span
class="math inline">\((a, b)\)</span> where <span
class="math inline">\(a\)</span> is a value of <span
class="math inline">\(X\)</span> and <span
class="math inline">\(b\)</span> is a value of <span
class="math inline">\(Y\)</span>.</p>
</div>
<h2 id="index-of-coincidence">3.5. Index of Coincidence</h2>
<p>Imagine starting with some text consisting of only uppercase alphabet
characters. Separate all of the letters from each other. Throw them all
into in a bag to shuffle them up. Then draw two letters from it without
replacement. What is the probability that the two letters you drew are
the same?</p>
<p>Let <span class="math inline">\(N\)</span> be the total number of
letters in the bag. For each letter <span
class="math inline">\(\alpha\)</span>, let <span
class="math inline">\(N_\alpha\)</span> be the number of times that
<span class="math inline">\(\alpha\)</span> appears in the bag. Then
<span class="math inline">\(N_\alpha/N\)</span> is the probability that
<span class="math inline">\(\alpha\)</span> is the first letter you draw
from the bag. After you draw that letter, there are <span
class="math inline">\(N-1\)</span> letters left in the bag and <span
class="math inline">\(\alpha\)</span> occurs only <span
class="math inline">\(N_\alpha-1\)</span> times, so the probability of
drawing <span class="math inline">\(\alpha\)</span> again is <span
class="math inline">\((N_\alpha-1)/(N-1)\)</span>. Thus the overall
probability of drawing <span class="math inline">\(\alpha\)</span> twice
is <span class="math display">\[ \frac{N_\alpha(N_\alpha - 1)}{N(N-1)}.
\]</span> Our question we posed in the first paragraph, however, was not
about the probability that we draw <span
class="math inline">\(\alpha\)</span> from the bag twice. It was about
drawing two of the same letter, which can be any letter. This means we
have to sum over all of the possible choices of <span
class="math inline">\(\alpha\)</span>. In other words, the probability
we’re looking for is actually <span class="math display">\[ \sum_{\alpha
\in \{\text{A}, \dotsc, \text{Z}\}} \frac{N_\alpha(N_\alpha -
1)}{N(N-1)}. \]</span> There is one step we did above that you should
justify to yourself before proceeding:</p>
<div class="element">
<p><span class="label">Exercise</span> Above we stated that the
probability of drawing <span class="math inline">\(\alpha\)</span> for
our first letter is <span class="math inline">\(N_\alpha/N\)</span> and
the probability of drawing <span class="math inline">\(\alpha\)</span>
for our second letter is <span
class="math inline">\((N_\alpha-1)/(N-1)\)</span>, so the probability of
drawing two <span class="math inline">\(\alpha\)</span>’s in a row is
the product of these. Justify this “multiplication” of probabilities
using conditional probabilities.</p>
<p><em>Hint</em>. Consider the experiment of drawing two letters from
the bag. Let <span class="math inline">\(A_\alpha\)</span> be the event
that the first letter is <span class="math inline">\(\alpha\)</span> and
<span class="math inline">\(B_\alpha\)</span> the event that the second
letter is <span class="math inline">\(\alpha\)</span>. What is <span
class="math inline">\(P(A_\alpha)\)</span>? What is <span
class="math inline">\(P(B_\alpha \mid A_\alpha)\)</span>?</p>
</div>
<p>Since there are 26 letters in the English alphabet, it turns out to
be convenient to normalize this probability we computed above by
multiplying by 26. The resulting number gets a special name:</p>
<div class="element">
<p><span class="label">Definition</span> Let <span
class="math inline">\(N\)</span> be the length of some text and, for
each letter <span class="math inline">\(\alpha\)</span>, let <span
class="math inline">\(N_\alpha\)</span> be the number of times <span
class="math inline">\(\alpha\)</span> occurs in this text. The <em>index
of coincidence</em> of the text, denoted <span
class="math inline">\(\mathrm{IC}\)</span>, is the number <span
class="math display">\[ \mathrm{IC} = 26 \sum_{\alpha \in \{\text{A},
\dotsc, \text{Z}\}} \frac{N_\alpha(N_\alpha - 1)}{N(N-1)}. \]</span></p>
</div>
<p>Here are some exercises to help you play with this definition.</p>
<div class="element">
<p><span class="label">Exercise</span> Suppose that you start with a
text where <em>every letter appears equally often</em>. What would the
index of coincidence of such a text be?</p>
</div>
<div class="element">
<p><span class="label">Exercise</span> What is the largest possible
index of coincidence? What kind of text would result in an index of
coincidence that’s as large as possible?</p>
</div>
<div id="important-ic-exercise" class="element">
<p><span class="label">Important Exercise</span> Let <span
class="math inline">\(N\)</span> be the length of some text and, for
each letter <span class="math inline">\(\alpha\)</span>, let <span
class="math inline">\(N_\alpha\)</span> be the number of times <span
class="math inline">\(\alpha\)</span> occurs in this text. Let <span
class="math inline">\(p_\alpha = N_\alpha/N\)</span>. Show that, if
<span class="math inline">\(N\)</span> is very large, then<br />
<span class="math display">\[ \mathrm{IC} \approx 26 \sum_{\alpha \in
\{\text{A}, \dotsc, \text{Z}\}} p_\alpha^2. \]</span></p>
</div>
<p>As we’ve seen, relative frequencies of letters in English are roughly
stable from text to text, at least for sufficiently long texts.
Correspondingly, the index of coincidence is also roughly stable from
text to text! Here is the relevant heuristic:</p>
<div class="element">
<p><span class="label">Heuristic</span> The index of coincidence of long
English plaintext is (a) typically around 1.75, and (b) almost always
between 1.5 and 2.</p>
</div>
<div id="sagecell-index-of-coincidence-comparison" class="element">
<p><span class="label">SageCell</span> Here is a SageCell to help
convince you of the above heuristic. You’ll see several input boxes
which default to passages from Emily Brönte’s <em>Wuthering
Heights</em>, the Declaration of Independence, F. Scott Fitzgerald’s
<em>The Great Gatsby</em>, and the Preamble to the Universal Declaration
of Human Rights. The code outputs a table indicating the index of
coincidence of each of these texts.</p>
<ul>
<li><p>Does the above heuristic hold up for this data?</p></li>
<li><p>Edit the texts to texts of your choice and see what happens! In
particular, roughly how short can the texts be before the heuristic
starts to break down?</p></li>
</ul>
<div class="sage">
<script type="text/x-sage">
from re import sub
from collections import Counter

samples = ["""I saw nothing; but neither the sheep nor he would go on, so I bid him take the road lower down. He probably raised the phantoms from thinking, as he traversed the moors alone, on the nonsense he had heard his parents and companions repeat. Yet, still, I don’t like being out in the dark now; and I don’t like being left by myself in this grim house: I cannot help it; I shall be glad when they leave it, and shift to the Grange.

“They are going to the Grange, then?” I said.

“Yes,” answered Mrs. Dean, “as soon as they are married, and that will be on New Year’s Day.”

“And who will live here then?”

“Why, Joseph will take care of the house, and, perhaps, a lad to keep him company. They will live in the kitchen, and the rest will be shut up.”

“For the use of such ghosts as choose to inhabit it?” I observed.

“No, Mr. Lockwood,” said Nelly, shaking her head. “I believe the dead are at peace: but it is not right to speak of them with levity.”

At that moment the garden gate swung to; the ramblers were returning.

“They are afraid of nothing,” I grumbled, watching their approach through the window. “Together, they would brave Satan and all his legions.”

As they stepped on to the door-stones, and halted to take a last look at the moon—or, more correctly, at each other by her light—I felt irresistibly impelled to escape them again; and, pressing a remembrance into the hand of Mrs. Dean, and disregarding her expostulations at my rudeness, I vanished through the kitchen as they opened the house-door; and so should have confirmed Joseph in his opinion of his fellow-servant’s gay indiscretions, had he not fortunately recognised me for a respectable character by the sweet ring of a sovereign at his feet.

My walk home was lengthened by a diversion in the direction of the kirk. When beneath its walls, I perceived decay had made progress, even in seven months: many a window showed black gaps deprived of glass; and slates jutted off, here and there, beyond the right line of the roof, to be gradually worked off in coming autumn storms.

I sought, and soon discovered, the three headstones on the slope next the moor: the middle one grey, and half buried in heath; Edgar Linton’s only harmonized by the turf and moss creeping up its foot; Heathcliff’s still bare.

I lingered round them, under that benign sky: watched the moths fluttering among the heath and harebells, listened to the soft wind breathing through the grass, and wondered how any one could ever imagine unquiet slumbers for the sleepers in that quiet earth.""",
           """When in the Course of human events, it becomes necessary for one people to dissolve the political bands which have connected them with another, and to assume among the powers of the earth, the separate and equal station to which the Laws of Nature and of Nature's God entitle them, a decent respect to the opinions of mankind requires that they should declare the causes which impel them to the separation.

We hold these truths to be self-evident, that all men are created equal, that they are endowed by their Creator with certain unalienable Rights, that among these are Life, Liberty and the pursuit of Happiness.--That to secure these rights, Governments are instituted among Men, deriving their just powers from the consent of the governed, --That whenever any Form of Government becomes destructive of these ends, it is the Right of the People to alter or to abolish it, and to institute new Government, laying its foundation on such principles and organizing its powers in such form, as to them shall seem most likely to effect their Safety and Happiness. Prudence, indeed, will dictate that Governments long established should not be changed for light and transient causes; and accordingly all experience hath shewn, that mankind are more disposed to suffer, while evils are sufferable, than to right themselves by abolishing the forms to which they are accustomed. But when a long train of abuses and usurpations, pursuing invariably the same Object evinces a design to reduce them under absolute Despotism, it is their right, it is their duty, to throw off such Government, and to provide new Guards for their future security.--Such has been the patient sufferance of these Colonies; and such is now the necessity which constrains them to alter their former Systems of Government. The history of the present King of Great Britain is a history of repeated injuries and usurpations, all having in direct object the establishment of an absolute Tyranny over these States. To prove this, let Facts be submitted to a candid world.

He has refused his Assent to Laws, the most wholesome and necessary for the public good.

He has forbidden his Governors to pass Laws of immediate and pressing importance, unless suspended in their operation till his Assent should be obtained; and when so suspended, he has utterly neglected to attend to them.

He has refused to pass other Laws for the accommodation of large districts of people, unless those people would relinquish the right of Representation in the Legislature, a right inestimable to them and formidable to tyrants only.

He has called together legislative bodies at places unusual, uncomfortable, and distant from the depository of their public Records, for the sole purpose of fatiguing them into compliance with his measures.

He has dissolved Representative Houses repeatedly, for opposing with manly firmness his invasions on the rights of the people.

He has refused for a long time, after such dissolutions, to cause others to be elected; whereby the Legislative powers, incapable of Annihilation, have returned to the People at large for their exercise; the State remaining in the mean time exposed to all the dangers of invasion from without, and convulsions within.

He has endeavoured to prevent the population of these States; for that purpose obstructing the Laws for Naturalization of Foreigners; refusing to pass others to encourage their migrations hither, and raising the conditions of new Appropriations of Lands.

He has obstructed the Administration of Justice, by refusing his Assent to Laws for establishing Judiciary powers.

He has made Judges dependent on his Will alone, for the tenure of their offices, and the amount and payment of their salaries.

He has erected a multitude of New Offices, and sent hither swarms of Officers to harrass our people, and eat out their substance.

He has kept among us, in times of peace, Standing Armies without the Consent of our legislatures.

He has affected to render the Military independent of and superior to the Civil power.

He has combined with others to subject us to a jurisdiction foreign to our constitution, and unacknowledged by our laws; giving his Assent to their Acts of pretended Legislation:

For Quartering large bodies of armed troops among us:

For protecting them, by a mock Trial, from punishment for any Murders which they should commit on the Inhabitants of these States:

For cutting off our Trade with all parts of the world:

For imposing Taxes on us without our Consent:

For depriving us in many cases, of the benefits of Trial by Jury:

For transporting us beyond Seas to be tried for pretended offences

For abolishing the free System of English Laws in a neighbouring Province, establishing therein an Arbitrary government, and enlarging its Boundaries so as to render it at once an example and fit instrument for introducing the same absolute rule into these Colonies:

For taking away our Charters, abolishing our most valuable Laws, and altering fundamentally the Forms of our Governments:

For suspending our own Legislatures, and declaring themselves invested with power to legislate for us in all cases whatsoever.

He has abdicated Government here, by declaring us out of his Protection and waging War against us.

He has plundered our seas, ravaged our Coasts, burnt our towns, and destroyed the lives of our people.

He is at this time transporting large Armies of foreign Mercenaries to compleat the works of death, desolation and tyranny, already begun with circumstances of Cruelty & perfidy scarcely paralleled in the most barbarous ages, and totally unworthy the Head of a civilized nation.

He has constrained our fellow Citizens taken Captive on the high Seas to bear Arms against their Country, to become the executioners of their friends and Brethren, or to fall themselves by their Hands.

He has excited domestic insurrections amongst us, and has endeavoured to bring on the inhabitants of our frontiers, the merciless Indian Savages, whose known rule of warfare, is an undistinguished destruction of all ages, sexes and conditions.

In every stage of these Oppressions We have Petitioned for Redress in the most humble terms: Our repeated Petitions have been answered only by repeated injury. A Prince whose character is thus marked by every act which may define a Tyrant, is unfit to be the ruler of a free people.

Nor have We been wanting in attentions to our Brittish brethren. We have warned them from time to time of attempts by their legislature to extend an unwarrantable jurisdiction over us. We have reminded them of the circumstances of our emigration and settlement here. We have appealed to their native justice and magnanimity, and we have conjured them by the ties of our common kindred to disavow these usurpations, which, would inevitably interrupt our connections and correspondence. They too have been deaf to the voice of justice and of consanguinity. We must, therefore, acquiesce in the necessity, which denounces our Separation, and hold them, as we hold the rest of mankind, Enemies in War, in Peace Friends.

We, therefore, the Representatives of the united States of America, in General Congress, Assembled, appealing to the Supreme Judge of the world for the rectitude of our intentions, do, in the Name, and by Authority of the good People of these Colonies, solemnly publish and declare, That these United Colonies are, and of Right ought to be Free and Independent States; that they are Absolved from all Allegiance to the British Crown, and that all political connection between them and the State of Great Britain, is and ought to be totally dissolved; and that as Free and Independent States, they have full Power to levy War, conclude Peace, contract Alliances, establish Commerce, and to do all other Acts and Things which Independent States may of right do. And for the support of this Declaration, with a firm reliance on the protection of divine Providence, we mutually pledge to each other our Lives, our Fortunes and our sacred Honor.""", 
           """Gatsby’s house was still empty when I left—the grass on his lawn had grown as long as mine. One of the taxi drivers in the village never took a fare past the entrance gate without stopping for a minute and pointing inside; perhaps it was he who drove Daisy and Gatsby over to East Egg the night of the accident, and perhaps he had made a story about it all his own. I didn’t want to hear it and I avoided him when I got off the train.

I spent my Saturday nights in New York because those gleaming, dazzling parties of his were with me so vividly that I could still hear the music and the laughter, faint and incessant, from his garden, and the cars going up and down his drive. One night I did hear a material car there, and saw its lights stop at his front steps. But I didn’t investigate. Probably it was some final guest who had been away at the ends of the earth and didn’t know that the party was over.

On the last night, with my trunk packed and my car sold to the grocer, I went over and looked at that huge incoherent failure of a house once more. On the white steps an obscene word, scrawled by some boy with a piece of brick, stood out clearly in the moonlight, and I erased it, drawing my shoe raspingly along the stone. Then I wandered down to the beach and sprawled out on the sand.

Most of the big shore places were closed now and there were hardly any lights except the shadowy, moving glow of a ferryboat across the Sound. And as the moon rose higher the inessential houses began to melt away until gradually I became aware of the old island here that flowered once for Dutch sailors’ eyes—a fresh, green breast of the new world. Its vanished trees, the trees that had made way for Gatsby’s house, had once pandered in whispers to the last and greatest of all human dreams; for a transitory enchanted moment man must have held his breath in the presence of this continent, compelled into an aesthetic contemplation he neither understood nor desired, face to face for the last time in history with something commensurate to his capacity for wonder.

And as I sat there brooding on the old, unknown world, I thought of Gatsby’s wonder when he first picked out the green light at the end of Daisy’s dock. He had come a long way to this blue lawn, and his dream must have seemed so close that he could hardly fail to grasp it. He did not know that it was already behind him, somewhere back in that vast obscurity beyond the city, where the dark fields of the republic rolled on under the night.

Gatsby believed in the green light, the orgastic future that year by year recedes before us. It eluded us then, but that’s no matter—tomorrow we will run faster, stretch out our arms further… And one fine morning—

So we beat on, boats against the current, borne back ceaselessly into the past.""",
           """Whereas recognition of the inherent dignity and of the equal and inalienable rights of all members of the human family is the foundation of freedom, justice and peace in the world,

Whereas disregard and contempt for human rights have resulted in barbarous acts which have outraged the conscience of mankind, and the advent of a world in which human beings shall enjoy freedom of speech and belief and freedom from fear and want has been proclaimed as the highest aspiration of the common people,

Whereas it is essential, if man is not to be compelled to have recourse, as a last resort, to rebellion against tyranny and oppression, that human rights should be protected by the rule of law,

Whereas it is essential to promote the development of friendly relations between nations,

Whereas the peoples of the United Nations have in the Charter reaffirmed their faith in fundamental human rights, in the dignity and worth of the human person and in the equal rights of men and women and have determined to promote social progress and better standards of life in larger freedom,

Whereas Member States have pledged themselves to achieve, in co-operation with the United Nations, the promotion of universal respect for and observance of human rights and fundamental freedoms,

Whereas a common understanding of these rights and freedoms is of the greatest importance for the full realization of this pledge,

Now, therefore,

The General Assembly,

Proclaims this Universal Declaration of Human Rights as a common standard of achievement for all peoples and all nations, to the end that every individual and every organ of society, keeping this Declaration constantly in mind, shall strive by teaching and education to promote respect for these rights and freedoms and by progressive measures, national and international, to secure their universal and effective recognition and observance, both among the peoples of Member States themselves and among the peoples of territories under their jurisdiction."""]

# Remove all non alphabetic characters and capitalize
def encode(text: str):
    stripped = sub(r"[^a-zA-Z]", "", text)
    return stripped.upper()

# Calculate index of coincidence of given text    
def coincidence(text: str):
    n = len(text)
    c = Counter(text)
    return 26.0 * sum([(m*(m-1))/(n*(n-1)) for x, m in c.items()])

# Prints an output div aligning with the interact controls   
def output_div(label: str, content: str):
    s = '<div class="sagecell_interactControlCell" style="width: 100%;">'
    s += f'<label class="sagecell_interactControlLabel">{label}</label>'
    s += f'<div class="sagecell_interactControl">{content}</div>'
    s += '</div>'
    pretty_print(html(s))

@interact
def _(text1=input_box(default=samples[0], label="Text 1", height=5, width=70),
      text2=input_box(default=samples[1], label="Text 2", height=5, width=70),
      text3=input_box(default=samples[2], label="Text 3", height=5, width=70),
      text4=input_box(default=samples[3], label="Text 4", height=5, width=70)):
    
    texts = [text1, text2, text3, text4]
    texts = [encode(s) for s in texts]
    for i, s in enumerate(texts):
        output_div(f"IC {i+1}", f"{coincidence(s):.2f}")
    
</script>
</div>
</div>
<p>Based on the Important Exercise above, we know that <span
class="math display">\[ \mathrm{IC} \approx 26 \sum_{\alpha \in
\{\text{A}, \dotsc, \text{Z}\}} p_\alpha^2. \]</span> Notice that the
right-hand side stays exactly the same if we perform a simple
substitution on our text! For example, suppose the letter <code>E</code>
has a relative frequency of 13% in some plaintext. Then <span
class="math inline">\(p_{\text{E}}^2 \approx 0.13^2\)</span> will appear
as a summand in the above expression for the <span
class="math inline">\(\mathrm{IC}\)</span> of this plaintext. If we
perform a simple substitution that converts the letter <code>E</code> to
something else, say <code>Q</code>, then <span
class="math inline">\(p_{\text{Q}}^2 \approx 0.13^2\)</span> will appear
as a summand of the <span class="math inline">\(\mathrm{IC}\)</span> for
the ciphertext. The subcript is different, but the value is exactly the
same! Since we’re summing over all of the letters, the value of <span
class="math inline">\(\mathrm{IC}\)</span> does not change when we
perform a simple substitution.</p>
<div class="element">
<p><span class="label">Exercise</span> Suppose some English plaintext is
encrypted using a transposition cipher (eg, rectangular transposition).
How will the index of coincidence of the plaintext compare to that of
the ciphertext?</p>
</div>
<p>This suggests that the index of coincidence can be used as a test to
determine whether text encrypted using an unknown cipher involved a
non-simple substitution. If no non-simple substitution was involved, we
should see an index of coincidence that matches what’s expected of
English plaintext based on the above heuristic. Otherwise, there should
be some discrepancy!</p>
<div class="element">
<p><span class="label">Exercise</span> Here are several ciphertexts that
were encrypted using unknown ciphers. For which of them do you think
that the encryption process may have involved a non-simple substitution?
Calculate indices of coincidence and explain your reasoning.</p>
Ciphertext 1:
<textarea readonly rows=10 style="width: 100%;">YJCRGYRUHAKEXLAGXOFHFOGZRYAHRMZAXOUHAIEAFOFOGFOIXAOUURPORDNKAUUROHAKHMZNFOGZDFYXEJHFGNAAOKAZXGAOUZUHAKADRKCAOAKFUXROZFOGNRKAXOGAAGUHAOFYARDUHAXKNXKUHTEFIANKAUURORDNKAUUROPHAUHAKNJIRXOIXGAOIARKNAIFMZAZRYAKAYRUAFOIAZURKHFGNAAOFTAKZROFCARDZMDDXIXAOUXYTRKUFOIAUREAFLAHXZOFYAURHXZOAXCHNRMKHRRGXQORPORUPHAOXPFZFCXKEXPAOUURNKAUUROFNRMUUPXIAFJAFKFOGPAEEXEXQAGUHALXZXUUHAHRMZAFOGXUZXOYFUAZZTAIXFEEJZMXUAGYAUHAEFKCATAFIADMEKRRYZUHAPAEEFKKFOCAGDMKOXUMKAUHAIEAFKPXGAPXOGRPZUHANFEIROJRMUZXGAERRQXOCGRPOROFDXOAFOUXSMAZUKAAUPHAKAZMOGFJZFOGHREXGFJZZAAYAGFEPFJZURFNXGAZRSMXAUPFZXUZFUYRZTHAKAZRIEAFOXUZTFLAYAOUUHAZAUHXOCZTEAFZAGYAPAEEROAIHXEGXOFHRMZAHREGRDCKRPOTARTEAXZMZMFEEJYFGALAKJYMIHRDFOGXOFSMXAUPFJXPFZFCRRGGAFEUFQAOORUXIARDNJYKZNKAUUROPHRHFGNAAOEADUFPXGRPPXUHROAZRONADRKAXQOAPHAKHAKHMZNFOGFTHJZXIXFOHFLXOCGXAGPHXEAZHAPFZJAUFJRMOCFOGHFOGZRYAPRYFOZHAPFZORUJRMOCFZXKAYAYNAKHAKNMUZHAPFZZUXEEHFOGZRYAUFEEPAEEYFGAFOGUHRMCHGFKQDRKFOAOCEXZHPRYFOJAUPAFKXOCFEPFJZUHAIEAFKOAZZRDHAFEUHXOHAKNKMOAUUAIHAAQFOGXUZLXLFIXUJXOFTFXKRDDXOAIHAAKDMENEFIQAJAZTARTEAAZUAAYAGXUFCKXALRMZTXUJUHFUZHAHFGORUIRODAKKAGHAKIRYTEAVXROROHAKZROPHRZAAJAZPAKANEMAUHRMCHALAOXONRJHRRGLAKJTXAKIXOCFOGUHAIRERMKRDHXZEROCHFXKZMIHFZDKXAOGZGXGORULAOUMKAURZTAIXDJAVIATUFZUHAZMOZHROAROXUPHAOUHAJIFEEAGXUCREGAOHAXOHAKXUAGUHAEXOAZRDHXZYRUHAKZDAFUMKAZHRPALAKFEZRHAKCRRGUAAUHHAKZUFUMKARKUHATKRYXZARDHAKZUFUMKADRKHAPFZORUJAUDMEECKRPOFOGPHFUPFZNAUUAKHAKHAFEUHPXUHRMUDEFPFOGHAKZTXKXUZRDUHFUUROAFOGASMFEXUJPHXIHFKANAUUAKUHFOFDRKUMOAURUHATRZZAZZRKXOUHAFMUMYORDUHAJAFKXPFZZUFJXOCFUNKAUUROYJCRGYRUHAKHFLXOCIRYAXOTAKZROURIEFXYYARDUHAQXOZDREQPXUHPHRYPFZFUUHFUUXYADXVAGYJTAKYFOAOUKAZXGAOIAXNAEXALAZHAUHAOTEFXOEJZFPALAOUZIRYXOCPHRZALAKJZHFGRPXZIFKIACMAZZAGJAURDPHXIHUHADFXOUZMZTXIXROZMDDXIAGURXYTFKUMOZAUUEAGZFGOAZZFOGYFGAYACEFGURIHFOCAZIAOAFOGZRIXAUJUXYAFEPFJZDERPAGZYRRUHEJDRKYAFUYJCRGYRUHAKZZXGAORUPXUHUMYMEUMRMZZPXDUOAZZNMUNEFOGEJEXQAUHACEXGXOCRDFDMEEKXLAKUHKRMCHFTEFXOYJLXZXUZURHAKKAZAYNEAGUHAZRBRMKORDIHKXZUXFOFOGHRTADMENAZXGAFIAKUFXOTEAFZFOUZUKAFYPXUHCKAAOUKAAZROAFIHNFOQFOGYAFGRPZNAFMUXDXAGPXUHEXEXAZFEEUHAJAFKKRMOGUHAIHFKYRDLFKXAUJUHAKAPFZORUORKUHAAVIXUAYAOURDXOIXGAOUNMUXEXQAGTAFIAZRPAEEFOGZRMCHUZUXYMEMZZREXUUEAUHFUPHAOUHAEFUUAKIFYAXFEYRZUDAEUXUFGXZUMKNFOIAFOGPXZHAGKFUHAKXUHFGZUXEEHAEGFERRDROAGFJFEAUUAKPFZKAIAXLAGRDPHXIHUHAIROUAOUZALXGAOUEJIFMZAGYKZNKAUUROZMKTKXZAFOGZRYAIROIAKOXUHRMCHUFUDXKZUXUPFZDKRYHRYAFOGUKAYNEAGAVTAIUXOCXQORPORUPHFUGXZFZUKRMZIRYYMOXIFUXROURYAHRPALAKORKADAKAOIAPFZYFGAFOGUHAIERMGZAAYAGURTFZZUHAOAVUGFJROYJKAUMKODKRYFEROCPFEQXDRMOGFZXAOUAKAGYJNAGKRRYFOMOAVTAIUAGIHFOCAXOFGGXUXROURYJRPODKAOIHNAGXOXUZZHFGJKAIAZZFTTAFKAGXOFIRKOAKFZYFEEIKXNGKFTAGPXUHPHXUAFOGXOFGGXUXROURYJYFHRCFOJIHAZURDGKFPAKZXZFPFUXOJKRZAPRRGIHAZUXZURRGZUXEECFWAGFOGIROZXGAKAGRDPHFUFKAUHAZAUHXOCZUHAZXCOZFOGURQAOZXFZQAGUHAFOZPAKPFZRNLXRMZFZAIROGCMAZUXZIRYXOCYKZNKAUUROAVTAIUZRUHAKLXZXURKZROGAZIAOGXOCURGXOOAKAVTEFOFUXROZAOZMAGFEXUUEACXKEXPFZUREGPRMEGZHRKUEJNAYJIRYTFOXROUHAGFMCHUAKRDFDKXAOGFOGGXZUFOUKAEFUXRORDUHAEFUAGKNKAUUROZUHXZEXUUEACXKEXUPFZFGGAGHFGKAIAOUEJERZUHAKYRUHAKUHRMCHXOGAAGYKZNKAUUROAKAEROCZMNBRXOAGUHAERZZPFZORUZRCKAFUFZYXCHUFUDXKZUFTTAFKYKZHRYAHRYAXUZAAYZPFZUHAOFYAHFGNAAOFLAKJTKAUUJNMUFCXGGJIFKAEAZZPRYFOPHRHFGOACEAIUAGHAKIHXEGFOGGXZFTTRXOUAGFOGGXZHAFKUAOAGHAKHMZNFOGZRDFKDKRYIROCAOXFEHFGUHAMOXROTKRLAGUHFUZATFKFUXROFUEFZUAOZMAGZATFKFUXRONJYMUMFEIROZAOUORUFDUAKFOJEACFETKRIAZZZRROFDUAKUHXZALAOUUHAEFGJHFLXOCRLAKAVAKUAGHAKZAEDFUFNFEEIFMCHUIREGURRQFDALAKFOGGXAGFDUAKFLAKJNKXADXEEOAZZHAKHMZNFOGOFUMKFEEJFYFORDLAKJZAOZXUXLADAAEXOCZFOGZHRIQAGXOAVTKAZZXNEJNJURRZMGGAOIRYYMOXIFUXRORDUHAOAPZIRMEGHFKGEJXUZAAYZORPNATAKZMFGAGNMUUHFUZRYARLAKZALAKXUJROHXZTFKUZRYAGADXIXAOIJXOTFUXAOIAFOGXOGMECAOIAHFGIROUKXNMUAGURHFZUAOHAKAOGHAHFGNKRRGAGRLAKUHXZXGAFUXEEHXZZTXKXUZPAKAZAKXRMZEJFDDAIUAGUHAYAGXIFEYAOXOZXZUAGROUKFLAEEXOCNAXOCUKXAGFZFKAYAGJFOGYAFOPHXEAYKZNKAUUROHFGRDDAKAGURUFQAIHFKCARDHXZEXUUEACXKEFOGXHRTAFGGAGYJCRGYRUHAKXOIROIEMZXROUHAIHXEGPXEEORUNAEXQAHAKYFYYFFZZXEEJFOGDKXLRERMZFEXUUEADEXKUFZALAKZAOZXNEAYFOPFZPAFQAORMCHURYFKKJDRKZFXGZHAYKHRYAXZFZAOZXNEAYFOXOHXZPFJUHRMCHORULAKJTKFIUXIFEHAXZDROGRDZIXAOIAFOGEXLAZHFEDHXZEXDAXOFEFNRKFURKJUKJXOCAVTAKXYAOUZFUHXOCHXZNMUUAKDEJPXDAIRMEGOAXUHAKIRYTKAHAOGORKAOGMKAFOGXOGAAGIRODAZZAGYJCRGYRUHAKXZHRMEGORUHFLAEXQAGXUYJZAEDXOFOZPAKURFSMAZUXRORDYXOAZHADMKUHAKXODRKYAGYAUHFUHAKEFUAHMZNFOGMZAGURZFJYKHRYAHFGGAKXLAGUHXZZIXAOUXDXIUMKODKRYFYFUAKOFEMOIEAFDKAOIHZFLFOUDRKHAIFYAXUZAAYZRDYXVAGDKAOIHFOGZIRUUXZHRKXCXOFOGHFGIROOAIUXROZORPEXLXOCXODKFOIARDPHRYYRKAUHFOROAPKRUAGANADRKAHXZOFYAFOGIFEEAGHXYZAEDORNEAUHFUZFYAALAOXOCFUOXOARIERIQFZAKLFOUPFZGAZTFUIHAGURYAAUUHAIRFIHNJPHXIHRMKEXUUEALXZXURKPFZAVTAIUAGYKZNKAUUROFOGXZFUFEROAXOUHAGKFPXOCKRRYPFXUXOCHAKIRYXOCBRHOCKFHFYNKAUURONAXOCFNZAOUROFLXZXUURROARDHXZZIHRREDAEERPZPHREXLAGXOUHAIRMOUKJYJCRGYRUHAKKAFGUHAALAOXOCTFTAKPHXEAZHAPFXUAGXZAPAGXUPFZFPAUOXCHUUHAKFXOEFZHAGUHATFOAZFOGUHAPXOGZRMOGAGFOCKJFOGKAZUEAZZTRRKIHXEGZFXGYKZNKAUURODKRYUXYAURUXYAPHFUPAFUHAKDRKHAKBRMKOAJXPXZHZHAPAKAZFDAHAKAFEXUUEANADRKAUAOUHAGRRKNAEEFOORMOIAGPFKKAOZKAUMKOORZRROAKPFZUHAGRRKRTAOAGUHFOXKFOGRPOXOURUHAHFEEUHAKAEFJFUKMOQFOGZRYANFOGNRVAZNAZXGAUHAYZURRGFTAKZROEXQAFOMKZACXKEFOGFUUHADRRURDUHAZUFXKIFZAPFZPFKKAOPXUHFZHFPEAGNMOGEAXOHXZFKYZXZUHFUUHAIHXEGXFZQAGJAZYXZZXPRMEGHFLARTAOAGUHAZHFPEFOGUKXAGURCAUFTAATFUUHADFIANMUXUPFZHFZUXEJUMKOAGDKRYYAURPFKKAOZZHRMEGAKTMUYAGRPOTEAFZAZFXGFZYFEELRXIAPHAOPFKKAORTAOAGUHAGKFPXOCKRRYGRRKFOGUFQARDDUHXZZHFPEIROUXOMAGUHAZTAFQAKAVUKFIUXOCPXUHXUZYXOMUAHFOGUHATXOFOGPXUHFZRKURDDFZUXGXRMZHFZUAGRDDXOCUHAIEMYZJPKFTTXOCUHAIKAFUMKAPHXIHORPFTTAFKAGYFGAFGADUFUUAYTUURDREGUHAZHFPENMUUHAGKFTAKJPFZYMIHURRHAFLJFOGEFKCAURNAZMZUFXOAGRKPXAEGAGNJUHRZAHFOGZFOGFKYZCXLAXUURHFKKXAUTEAFZAPFZUHAOUHAGXKAIUXROFOGZHAIFOTMUXUFPFJUHXZZFXGXUUMKOAGFOGDXVAGXUZAJAZROYKZNKAUURO</textarea>
Ciphertext 2:
<textarea readonly rows=10 style="width: 100%;">SGPPZNQPEYKUOWMOVXDKKKFSMWDJDRPNBITQYUZRMOQBLLYRSYBKGVAVIMNNYRQBSGAYYVOYVPAXTQYHUFEDPVTXJNYVTQCVUHHLAIVPTXLUSIEKPFHTTPOVTQUGZQZRRBYUMDECKLXBUXOVUPJTZDRZZRAQBXNVANNEGSZQYVIKXJEDQFUTVHDLKLOWQPECXBRSGFSZQEYEANVTMDEZWSTXLUYQKWNVEWTQMRKYHKAXTQMEKQEDMRFTTIBRNOEBQPABGVKMRFKWHNVDCHEYVXFTDKLLEMOJEDEDZQOWZQHNDJIPKLANZHQRGSRFXAWOCTMRKYCRAXBIDJNIQEDRGTMRDZEUMDQJJDULKYHKSWNAECWSTJLDGCSQYHXBKUOFMEAQZDJDVSXPZDTPLUGKEMDCIEWYHTEATQSOEMBZBZFCGBVHVXIWETTZVXDKDJIPTQKKSQCWANVGDJHLUKHKUTPFYVFTTIYVOEMOANPCBLYJIESGFMMRANVGDJGCJNUAYVGQTPTILXOJLLINPVTXQBMRKYHKEDEDDJIPYGMDUTYILZIPTQUTMETICSEAPPXPGDPPOVUPMDLLMBBLZQOVQFEZUXEDEDZQYVTXOVKYMDQFBLDBZAKCXRKWEMSOFJNNTBQWOVCTELGVLDMRSYWMMDTQUGTIEMBIDJMELUVHTIZHJQZLPHAZVHRWDJTPLUMWKWGFUTQBTQIDKWFGKYHKEATQGYNIIHILEOMMJDTIGYGCJNMNVGCRDJAVUCUTQGMRHNTXZRTIJFKGSZMDTQMDJRAIYVIWDJHTZQPFUHQJOYPFXBSQOYRBKKYDOYZQDJCTKLWANVDLANSVGGMRECYDTZORSYPNLKEUOUOLMAEATQEBGKOEAXLQCWOGHNWJEYJHPNIPDXYVTQKKSIJMKYHKANZHUTKWSZKLRSSYYVQMEUXBUTKWJTZDDXWZQBEJDJOVQBYHDJDROWTIUTSZLXOJHNTQOLMEUZANTZBESYPNLXUXQBTQWAANHJAKHNBIDJTFCCXBHTPOEOWAWYHTCBAKSZPHOWTITQUTECUTABIPFCUYJZXPGDPPGJOEFSTQWAVHLXKIMGBZZDOFIMAXKJUTVDFVMDEOBLMOTQWAEYTIANJDOVDJMGQBBLKULLGDUTTQCIVPMOMRVXWZXBSQWALDSGZQOUIDFTOWIIZQUHAVGVIUDKKCLDGCSOSYIPOYBIDJMNZHYRANXAUTYHVHPCJFWYHTLXRBWNYDXNJHFDQEJFJNIQWAKJHTQPAVUGPUHTKWHNBIDJVPGUYDNGKLSJANIEDJVGHTWATQYHHTWATQMDVHHJGVECWMRZLHMDEZEUXBSQABGVQBOETPTIUTSZYVCTIEBRJNHNTQIDKWFTTIAVMENVOVAXWZVIGAANRSMEUIRZZRNIANSWHNVDMRUZANNVHJOUMRDZANYWOVVHTXDJNGLLEZHTMDLLZQDJBEWAMROEAXTQIEIWZQYVMRJHOUBRDKSZYVHNANICOVDJVXKQQBNVONHLVXQBDJVPKLDJNBTIUTOVSIJQYDRFSWHTTMEOYHAXEOWNYDTQIDKWRWWOCIBKIEHNVDEATQEMSOTQYVWUOUSOXJQJMDYHELIEGCTPWGBFRZRPQBRFZRTIKWIEMDTQUTOLBLWJYVUAZQDJMNXNHFPHOJQQVQZHTQEYGDHNBVMDEZEUQQTIUTCTMRDJFJJNJUCWMMLXUXTQYUHTMRXPGDFTRWDJMRLXVAQEYEINUCSHABGVIWSOWZQBKEWMHNTQIEZAQWHLOJANXAIERSMEISSQTQQRWAUGSOTZUCJFKUTQMDDJIWETXAIPFCEHQETOCEZRGTKLDJZHJQCREXIMTQMDKLOWCSPAMEFPLDLLTILLUIOUECDJHTDBAUYVTQMDLVOVSVGGQJKLWFIQQBVGDJWGBFCTUTYHDJJDTJFJIDTZAXTQUTQFKBXPORMNPNLXBXTIUTTQMRKYHKSGPPZNLDXPCVSZYVTQYUHTMRXPGDRWDJYDSGOVCWDPTDHTTQMDCAIPZNCAIPHTOERFEZWNYDAOSWNVVVRFXNOVDJPUUXTQMDCFOUMDNVLUOUYDBLGUECUHPAIHPFOVUTOVHTJHXBUXEYZRXXMBQJTQUTANLXVPFJVPMGZEYVCCIMOLMEHNPUQOPPMQQEXJRWDJUMHGMRHAYDVPDBAUOEKWIDWAYRKCZQCRDJTPOV</textarea>
Ciphertext 3:
<textarea readonly rows=10 style="width: 100%;">IKGWERTZONXEULTEZWHWXTYHSZKEGQOJNENRUDJGFRNKUISLDZOMKDKWZHVUOSJLFZEJJONQHWVRFEATRYIDIKKDKKEHNAEWOEYFIRMLNIENIFMAJKELXAMHRKKDKKEEUOIVADUNVRNLNEERNKKNJHHWNAUKESXDYLSHGRVQTKGNUFOEVAELOFYRVSESZYVWSLOLCLDGTTCLKWHEZQGGATZQTZKDRUKFUWRQDAJOEWLAQESHIFMLVITTEMPVEDLIEWHAYGILMZUUJHIUGNERTZKLGLTAYHROLTKGCDDONEEWHWELVDVWOTRQDKNIWWTGZHVJRSTGVWHWEAIHGGONXWOLNEXUAFMEKKEFOSRLDQKSRQSOKRVGMJYDVDNSYSFRNSYTYHYSXEDDRJOEUDNVZHRWWARLSHOFTENBESXSUDYSTDNKOOOLCOINKHVUELNEEZHQPOJHPZCICOTSQETDRWUFKKEZUUJHAFJPVUHSVSROAVZOBHEHNIDFOEVAEBTZKYNLLDRIMHIFZHVNILIHVQAFJTYHRWYTNLLDHEJKULAPWRRLNELVEGLSLFHYNOJWSSYCYROKKTFLNZGBZWILOOSVEJBEUQOEXLFFKOUOUVAAJNVOLQYHRNIFMHVUHWGDZEEDOEMHTZKDVDDSXERWPWGCVEULOTZVNGZRZJHLZOJSESQOWWHWSWZWHDKVZWYSZTYDTEUMVQTLNEXDRVKNXDTWYWLQGLUTYHRSSBCHRKCEIHRWZUIQIFMTYHYSXERIRSODFINGZHZQGAMRLPBDKDNDTUNIEJTZKIIDPHXORFHLNRFXGZZHVZIFJONWOYKTYHRLNEPZOMRDSUANKSRWAFGNUDLDNIJOEYOOEVAKZHVBSLKPGHDGTTFWHWJOFUSLUNVVAFJHROTWJTFWACKACDSLROFNALZHVPOGTOIPOJKCFURWITCBALKATKOLNEIEYZKRCLGZZIWHLLORIHSAYTZELQOMGHLDKDKREKIAGHTZKMRJAATAEGPJKSJLNYGRVPEEHRRQCWONKRTZKHRQDGLMIVDWGNRQDVOSIHGSXDZQGZKRVAPGYTLOALOOEVALSYIXDWTEJVINGNZVHWJTYUOMMHKKECOTTKEFGSKKEQUPVQEVZHVKOMYEUROJGNUVOKNOLODZGVVFOFLIIPEVPOJHPZONYLSGVIELOFUFYLSXKLCRWKKRMDNLYGRBIFJIJFRWZIFQSZGDYHNGZFFUTMTAKHLQXETRGFOSVGMWLOIDRWYPVFTSHLVFHSXATWEJHYKKEKCEVWRATGFIAKUVVUEAMNRWHAYFVHTEEWROKZUMVZAKREEJTZKNVGBQGDZYEJYIFQIFZHVGIJKCKLOFUFKKECORBZHWTBVQESZHZWSOGLCVIHKRTHINKDUHCSEHRGMSJEGUOYXEJVENKNZQSWBEEPOFZHJPAFEANLNVUWJKOOKDSOAUQGRSSVKPILVWJOWJLSYSRQDKRAKHSBATKHDGLFYHRWGNUWHWXESHYGTDKKEJOGYWLATEFITZKRFRFLUBVJRSJUROLQCOINEVUFWLNUUMZQGSATLPNKZOIPSAYOLJHLGNUVOGTDZVCGBEIHDLNEKKRWKHVDDKZOEHSGTTYHSDUPVQEPZTYHMGURKKEEODUOEGTEXUEQGNUKADLBLUIWJIEKESZHVGGSXLZQTGTSFQLQNAIPOFOZVGBQZHVWUJLAEGMGYSTUEWVIEJUHOTJIOGZHVDTZILZIFKYTZOLTGRVLLATGVUEVXOLQDLNEDXNVKRKKALHEELGFYKPZALIHVGTZKMFWHKLLLWTWXIEJAEUNXWHWNERWHSTDYDRWHECOSDOSKHNWJTFWHWYOWWWATDSUESZHZQGLNRFXGZZHVJRSYSRQDOUNUHRWJHFZAFEOEHCGALUHVWXIDDGATELQQMOEKVLMSBVUSXURKKEKREVSEJYIEWHSZQLLELKAIWH</textarea>
Ciphertext 4:
<textarea readonly rows=10 style="width: 100%;">LDPOUOUJALYVLBZOVTMBLHLUCZUAAPJITLVULJZLZLYZHVFVMYWUVLLLWVSAZKVPZLSOCAVLPWSJASPHUIZHKPDOOJCOJHLUVJULKAOLADLATPUOAHVYOULHVKZAHTZHBLUTAVNWODLVZLMYVLAHOLOYOAALLHZWAYHHLLUBKXZHHSAVAAPUOVJDPOOSALZHMDVAUYHBULVHKHMBUAZYVLNUKPLALAOSAHLLTKUJYLAWLJZLVAOAAWLUVPUPVVZHMRTUKPLUYPXLBYOZAAHLAZOFBOKVSJKHLSAYLLOBJLHZOZJDPTOLPWOSTALAALVOWZYLHPHUAVODSLVOKZALYLAABAOIZVLLMZSPLLCKAUHAOSATHSHLLUYLJAYHLLBKXAHHSOOAFALLHUYLDKKVLAILFOJPLYYVHDAYOPLAJHYUAPHBPUSHLSUIPLOYNAAHZOTAUHVONZALYLSHLLPPMSYIFLAKHOUABLZWYABMPVWOPHWZUALZAOVHAJZYLBOLZALPLOYNNACZVULLYTZUYAHULAPZBPLAATKUHVLNKTUPLPYCAULNOQPZYBVALWDMYVZYOTJALZVUULMAOVAVLLNCLYAUKAOOHDLLLUCUYMHFTVMYVCNYVLLUATUJITLVKLZZLBAAYJLPMCVLALOZKLPUZZAOPAPLOYNMAOVALLWWVASHLVLSVAYVYIAHPVOSZHPKAUPAZVUAAAPBLLNUDLVUCYUTSLAPHNFUZPVAMKBAUHUPUVVJZWBOUYPPJLWHSZVUNKYPHPUGPUZNADWYVLUZBPZMJYOVZTVHALAZOTSOZHSTLVLTSZRAPFLVSAMLJMLOAPALHYLZMHAKFUWOPHWZUWLZKYUBLPJKLUKLPLDKSJSPAAAHLAOVHNYCTLUALSUZNVZULIAPHSLZZOKBOKVSAULVIHJNOUMLYKVNSAPOKHYUAZHLUPJUBAHZZULHJKVHJPYNKUHSSFSWLYELUPLLJAOZHODOALUAOHHTPUKRULHVYTKYZLPZWKVLZAMVBYMOLDLPCSLZPYSHBLMZMHLSYIOLUAHYANVPAOLAOLTCZSILHZFSIZVPUOAPNMOYLVATDZVJOAPOFOYLHJLBHJVZLATBKDIAUOSLHNVYUAUHMPVBHLIZUZBHKYZHBWVAZPUYWBBZNPUUPYCHHPFIOSAHLLZTQVJILCAULPZJKLHPLUZNYAKVLLBOJABLKTUHLZYIBVLSAZKVLWZAPPTZAOPAYLPPYANAOPAPLZOKPAYBVFOAADYMVVBMOZJCNYVLLUATUKHVUAVWPYCUKDLLHNKBYVZAMYPOMLYBBLAYJZYLBFPBAZOJZOHLIALUWOALHUPZLAMBYMLJHVULOMZALVLVJSLUHPZZUJKBZOVPUODUALLLZJZFPOADOPVJJAUHZYZPOUAALHTVLSAAYPOMLYTVYYLZZLFAVTNZMLVUCYUTALAOOZLPYAVVFOMWALZYULLPANRUNVLMYIHPAYPAPHUOZZHPYAVVFLMLYWLHPAKBUPQYHLKZUBBWZYPHUAVSZOHSPHNCUKPYUPALIJVJQALALOALZSHZIPLOATUHVHMUVIBZSAAYLFUHVUFYCOLALLAZZLHAAZYVCWVOLZAPASHLMZJLAIIZPBTLAAAKJVUHHKKVPDKYLSOZOLHYZMKBLZOZPHUZALAHVZSDLAVOTDZVAOZSTLVULUHKLLZJZFHVYMOYWALSBJIPVNOVKHLMOZIVKYPUKPLOVZLNCVYZUYWAZVHHZZSDPVTMTPLAKHULWHKZYPLZPUWNTAVUYHBJSLUZLBZZLZKWUPLAKUPOVLYYWALHUPPVAOSZSPZHUZLOABZVISVKLHIUAPHLKKULDZOUBVWZZKLKULOOZLHABYALUSNFLJSLLAVKAAHUAALKOVTALOOZLHMYZLBALWKVZHAZVYOHLSMDYZVLAJOHTJVVTAKVHPMUHVSLYPNKYZJAPVAWZMWLLVSSBZULOZZAVLLWWVDSBLVYSSKLXPPUBAZLOONYAPOYVWMLZYULLAAVHPUUOPALLPSNHZBSAHYPLYANUOPALTZPSHAILOVTALKHVUMPYHTKLIVSAYAUFHVASZULFHOOHZSJSALNKVOLYALNSZLPASCHPVLPIKHLWZAJSZHLBBBUZBHJSUMVYTVIALHSKHPUKHZAAUVMAYTKOWLLPVVZAVYAFMPOWLYSBJIPJYYLVMKYZVLAVOZWSYLBZWVVLHMPMAPNNBULAPOTVUVAJSTHWPLUPJDOAZOPHTBLZZYLLOZOPHKVZCZSYLWKLZYULLAACHPVLZOBYLWZLALKHLMSYFVWVZWVNPPUDTAUOHMSYFPLTZUZZOUPPZCVHPVUAZUYONLPZOMAVLALOWSVOWLHLYOZBLLMZVKHMYUSAVNLPMTHYABLZKJZOPSZAVBUPAVZHVZJBALLVOAYIZVSLJLLKAOLDLLFYILALOSZNHPSCAWPLLVZDYJPWUHSHVILUMPHUSOAPHUPHVOYCALLUBKYLAALVOVWSLWALHHSLYVNMOYPALEYYLLZJAPLZOHLAYATLLUHUPPUNOPALLUTHTALPLVELWZVKSAHOSKALNHYULMZUVPZCVHPYUTMVADVPOHBKAUUJBVCPSUZVPZODAOPOULLHKZUCLBHVKYVLALWLYCAULAOWWSVBPHUAVAVLMOZZHLAZAVLMOYAAHYWVBWVZZLIBAAYJNPOUAHLZSDYMHVUYASBHHPPGAVVMUMLVNYPYUYLZBLPMZAUWNVZHAZVYOALZUVVLJHBLYNLAYOPNTHPYVAZPUAOLPOUYYHKZHUPPONJALKVAUPUPVVZLMHUDYWWWVHYPPAZVMUVUSZHKOOZLHZVYIAABKJLLAKOHUTZPPHAPYAVVQUMABJZPFLLIYZMUBPPNHOZLZAZUSADVHVZLMYHZSAIOPUZPBNPQKHJFPYDWYVLLZHOOHZLTKKQLBNLZLKWLUAKUOVZUPSDHPSUSMVLAVLYOUAYLBMLOVAYLMPVJMZPLKHOUATLBHVHUKAUFWLHTVUAAMPOZLYHHPSYOLOZLLHLZYLJHAKSTPBAKAVBLLMVUDPMLMJUZZHKALPUOLAZOYYDZHTVVMMMLPZJYOAYVHZYVHZWBVYLLWUSHHKVLAABLAOZPIYBHZJAULLHOOLZARWVHNTUPBAZULPVTZLMJWHALUZHUKHPNPYZTLADVPOABLAOUJLVZVUVAMSBNYLSPAZHLBOYZHLHOZLMAMJALYKVKLYULLAPOTASYPHUFLPKUWLLKVUHAMZUWKBPLYYVAALVOCJSPPDWYVLOOZLHTJPVIKUPLDVAOOAZLVYAIZLBQBJAAZQVYHBKPJZPVAMPULVNYPVUBAVVYZJUAAAPBUPUVHUKJBHVRSUDNLKKLVIYFBDSNHZPPNCUZOZPHUZALAOVPALJYZHAWVLMYUALLKLKPSNHZPSAMVYUVHXABYPLNYUYSLHNKILVPMZYVHKTYLAWVHVZUTBVNVZWMYAYJVLUAAPNTOFLIVHRTJPASYHVMWYTPBOUZUTMLAHVFYUYTLBKDYPZOAJLOOOFBZVJSTKVATUPVLAUOPIOAHPAHVUZOMZALALAZHMLYZVAJPBAVUMNMYVYBALHPKDHASOSYWZHAAVLMOYDKVSYMTVPZWUVPHNLAEUZZVBADVPOVBYABUJLVZMUYAVWKPLYUCBPNUZHPTJUZFHVLAZMIOULLPLZMAAVPMYIHQSFFBVYMYYUAHVZAWYNPZUBFIULVLKZZHIAAVLLYMPKWVLYYUALLKMKLVMLUMJZHVVYIZSPPOAULNOLMZYLAFTZLLVNMUZSSPOZHUDPLHNUPVOYIBNPYUWPVJCUZLHLAPIOSZNPOUALLUYPHHIUYYPYAHVFLNCTYUULUALHKHUNSYNPAUPVZUIBYKLHPVZZZHYAUVLYKALPVHJAUULEHLWHLTSKHPUMUAAPZTYUBLVAPMYYUKAVPBNJULAHOZHTZLIBVLSASYPBLVUOAALLVZJUSLVPVZAMYPHNRUHHVDFJBHYOLYZAYVHPISPZNOUYVVBTCZSAHIBLHSDSHHZHUAKSPLNYUUMHBKUTHLAFSOSAVLTMYMZBVVVYLNCTYUULMAYZVZZLBWPUNKUYVDBVLUPSNHZBSAZYULHLKSKJPHNYULAZOTCLZSLCPZULKAPLDWADOVALSYVPLSNZLHVAMZYUBPSHHSJZZOLDZHLAVYCLLOZOIHHJKAPHNLCKVULLYTOUYALFLLIKHJPSYBUVNZVBOAMWPVZYJAPLAHVKUUNDUHPHNHDYPNZHUZALBOZOSHWKBYULVLYKBHZYLZHHLCNBKJVYZVZHAYIABUYVVBAZDUUHLKAKZFYKVLLAPOSZCMLVYVLBWSVOWLZLAPHPAAOZLPYTAZHVUWPYNAUYSLHNTHLYPMZVVMPYULNYTLLJYULHPVZVAJSTHWLOADALRVVYZLMAKHLOVKZASVHPUUAHKHFUYUSFLHYFHLKIUNPBDJAYOPTJABZJHZULJVBMYALWSFMLKYPJFYZHSJWLFHHSYSLLPSKOUTALAVHZIHYVIYHBLZNUZAHKHVSASUFVBDOYAAFOOHLLMKJVHPPPCSKGHLUVAOPUHLJOZZVYUAUHKPLYVLBMVSJSDPPLAGAURZHJLWUHCAVPLOUOALOPLNZAHIZVYLYHHHTHZNZPAUAPOJLYUVYBAVFLAITJAVLLOLLEAJVBPYUVLZOMPALYYLMPZUUKHYKAILLOVYUVYHAMASLSOLTCZSILAZFPOOLYKHOUZHLLOZPELJAVKLKTPZPAJBUYZYALVJPHUVZTZUBNAUZOHKLHKZUCLBHVKYVLAPINYUAVLUOOPIUHHPAAUMZBVVYYUMVLAZPYLALOTPYLJSPZKZUUPHHZNCZHLVDLOZVRUUDSYVBLHMMDYLHZYPBHKUUAPUZPPNOBZKLZKLBAAYJUPMVVSHNSHZLEZLHLKZUUJPVKVAZPULPLUCZYHFAVNALMZOVLLYWZWLVZZPUODCLHLLPWAVALPUVKYMYYLZKLUZOPAVLATZTOSBILLTAYBZYVYLLAWHWLAKLPPUAVHZLOCLIHLUDUYZLVLSKUFFLIYHWLLAUKBPQHYYFWJPDULZOJVLYOJHHYAZLPBATOZRHKYLLILFCHYAFJPDOOJFTLHKUMHPLYAUFHZAUPBAMVPAAILLOSYYBLHVYMMWLVLLLWVSUHYLOCIDLLLHUADUNPUUPAHUALVAZPUVAYVBPIAYAOPYZIOLLAYLUHDODCYLHKUOLAMLVTYPTLATAATVPMLAVHTAALWFZOIAYLLPSZNHPSYAABLEVLLAHUBKUHUYDYAHIUHQSYLBKPJZPVAVPUYCZLBODCLHLLPYTLUAKKTOMLVLAPOJBYZJTUALHJMZBVVTYNLPAYVHPUUZHKALLASUTOLALLLYDCOHHLLWSWHALAKVPOULYPHLACZQPBAHJKLUNTHHUTUAPPUFDHKHLLOCUJBVQKYOLAILATFAOLLPMZBVVVYTJTRVUUPLKAYKPVHKZDCOVALLZZBWBAYHUPDVZJODPOSVPBKCUALPSHPIFLUYAYABBWVVYUJUALVJPHUKZUYJLVYVZKWUJLAULFOVLAHVLOCLIKLUMLVHALAVOCLPMJVZQPBAHJKLUJVUMVUZBHNPPFUATDZLBOAYALVLLMYXHPJBJLPZLOUUALLLZJZFPOADOPLJKBUJVUVLYZBWZYLHPHUAVKHVUOASLKOZTLHDSOAVKYOZLLMAHVTPUKRULLPUTPLDZUPHWYUJLMHLLYKPULZODALLVYMAYLLOWYLLYUZHLACAZPLAVLMOPBLUAAKAZHVLHZMYTJLPUHLPNYUSLHUJYVNZLZZHTZSLIHLWKWSLUHPVNOAABLYZWLLBTQLKMNVLAVODKYVSMOYYALALAJPLBMKVYVUBPUAPLAZVVUKAPLUOTUHHLIUHKFOBYAVFPMAVLAVONWVVKLLWMSVLALOZSJUVVZPVLZTSSLUBFSWIOPUZHLKSKJLHOYAAHLAOBZPLUKAVLJUSLVPYZHHLVUYKMOPVNAOBANALVYIMHLKLUKPWULKLUULAAAZHALHZOOAFALLHIYHSZLVCYKTMVSHSSHNSHLPLUVJALAYOIPPOAZVJUYDKHOUAHHSASSWAVPHPJJSUVJULVAIPUDLLALOUTALKHOUAALAZHMLYVNALYHIHPUAPHPKZUNVABOIAAVLHVSASPFZKZCVKSLKHOUAHHMAZLYULHUKLPKUWLLKZUHAAZAOLAOLCFHBLSMSDWYVLSACVLHFJDYJVBUSWKHLLJJULVHAAYJSHHSPLULJZHZSAIOPVZJLTJTYULAHKVVSKHASLVOJYZHAKHOUANPDUZJOPPOLULKWLUAKUHZLAAHZVTFPMOYNVAUKHVKAMYZOWLBYWVVAOMZAPJKHLSAYVHPPUODAPHTMYSYHLPLUUJVLAYOWLVAAJUPMVVCKUPPYLCWVLPJKULLBDTHASBSSFKWLANLLVOHAJVYOBLVPYLSCBZMVYAVUYBHLKZUYVHBZLJOYKVVFUY</textarea>
</div>
<div class="element">
<p><span class="label">Harder Exercise</span> Try decrypting the
ciphertexts from the previous exercise for which you decided that the
encryption process did not involve a non-simple substitution! (At least
one of these won’t be very easy.)</p>
</div>
<div class="element">
<p><span class="label">(Harder?) Sage Exercise</span> Do you speak a
language other than English? If so, edit the code above and replace the
sample texts in order to find out what the typical index of coincidence
is for that language!</p>
<p>Depending on what language you decide to work with, the code might
involve varying amounts of editing. Here are some example remarks:</p>
<ul>
<li>(German) The German alphabet has 30 distinct letters (the 26 used in
English, plus <code>Ä</code>, <code>Ö</code>, <code>Ü</code>, and
<code>ẞ</code>). This should not require too much editing.</li>
<li>(French) The typical framing used for French is that there are just
26 letters in the alphabet. The many types of diacritics (<em>accent
aigu, accent grave, accent circonflexe, tréma, et cédille</em>) are not
regarded as creating separate letters, so you will need to be careful
about all of this.</li>
<li>(Spanish) You’ll want to be careful about dealing with
<code>Ñ</code> (which is regarded as a separate 27th letter of the
alphabet) and with the <em>acento agudo</em> (which is <em>not</em>
regarded as creating separate letters).</li>
<li>(Mandarin) Note that defining the index of coincidence requires
specifying the number of characters in the writing system. This means
that you’ll need to begin by specifying some finite list of possible
characters.</li>
<li>(Korean) You will want to decide whether you want to keep each
syllable intact, or if you want to break each syllable up into its
constituent consonant and vowel symbols.</li>
<li>I do not know how to make sense of the index of coincidence for
languages which use an <a
href="https://en.wikipedia.org/wiki/Abugida">abugida</a> (eg, Bengali,
Nepali, Thai, Tamil, etc). Should the vowel diacritics be separated from
the consonants onto which they attach? If so, should they be counted
separately from the “independent” vowel forms? You’ll have to first make
decisions about questions like these if you want to work with such a
language.</li>
</ul>
</div>
<h2 id="breaking-the-vignere-cipher">3.6. Breaking the Vignère
Cipher</h2>
<p>With the index of coincidence in hand, we’re now ready to break the
Vignère cipher. Recall that this cipher was considered unbreakable for
about 300 years…! The method we will describe is not <a
href="https://en.wikipedia.org/wiki/Kasiski_examination">the first
method that was discovered</a>, but it makes good use of the
mathematical machinery we’ve developed.</p>
<p>The idea is as follows. Suppose we start with following ciphertext
which we know to be encrypted using the Vignère cipher.</p>
<textarea readonly rows=10 style="width: 100%;">IKGWERTZONXEULTEZWHWXTYHSZKEGQOJNENRUDJGFRNKUISLDZOMKDKWZHVUOSJLFZEJJONQHWVRFEATRYIDIKKDKKEHNAEWOEYFIRMLNIENIFMAJKELXAMHRKKDKKEEUOIVADUNVRNLNEERNKKNJHHWNAUKESXDYLSHGRVQTKGNUFOEVAELOFYRVSESZYVWSLOLCLDGTTCLKWHEZQGGATZQTZKDRUKFUWRQDAJOEWLAQESHIFMLVITTEMPVEDLIEWHAYGILMZUUJHIUGNERTZKLGLTAYHROLTKGCDDONEEWHWELVDVWOTRQDKNIWWTGZHVJRSTGVWHWEAIHGGONXWOLNEXUAFMEKKEFOSRLDQKSRQSOKRVGMJYDVDNSYSFRNSYTYHYSXEDDRJOEUDNVZHRWWARLSHOFTENBESXSUDYSTDNKOOOLCOINKHVUELNEEZHQPOJHPZCICOTSQETDRWUFKKEZUUJHAFJPVUHSVSROAVZOBHEHNIDFOEVAEBTZKYNLLDRIMHIFZHVNILIHVQAFJTYHRWYTNLLDHEJKULAPWRRLNELVEGLSLFHYNOJWSSYCYROKKTFLNZGBZWILOOSVEJBEUQOEXLFFKOUOUVAAJNVOLQYHRNIFMHVUHWGDZEEDOEMHTZKDVDDSXERWPWGCVEULOTZVNGZRZJHLZOJSESQOWWHWSWZWHDKVZWYSZTYDTEUMVQTLNEXDRVKNXDTWYWLQGLUTYHRSSBCHRKCEIHRWZUIQIFMTYHYSXERIRSODFINGZHZQGAMRLPBDKDNDTUNIEJTZKIIDPHXORFHLNRFXGZZHVZIFJONWOYKTYHRLNEPZOMRDSUANKSRWAFGNUDLDNIJOEYOOEVAKZHVBSLKPGHDGTTFWHWJOFUSLUNVVAFJHROTWJTFWACKACDSLROFNALZHVPOGTOIPOJKCFURWITCBALKATKOLNEIEYZKRCLGZZIWHLLORIHSAYTZELQOMGHLDKDKREKIAGHTZKMRJAATAEGPJKSJLNYGRVPEEHRRQCWONKRTZKHRQDGLMIVDWGNRQDVOSIHGSXDZQGZKRVAPGYTLOALOOEVALSYIXDWTEJVINGNZVHWJTYUOMMHKKECOTTKEFGSKKEQUPVQEVZHVKOMYEUROJGNUVOKNOLODZGVVFOFLIIPEVPOJHPZONYLSGVIELOFUFYLSXKLCRWKKRMDNLYGRBIFJIJFRWZIFQSZGDYHNGZFFUTMTAKHLQXETRGFOSVGMWLOIDRWYPVFTSHLVFHSXATWEJHYKKEKCEVWRATGFIAKUVVUEAMNRWHAYFVHTEEWROKZUMVZAKREEJTZKNVGBQGDZYEJYIFQIFZHVGIJKCKLOFUFKKECORBZHWTBVQESZHZWSOGLCVIHKRTHINKDUHCSEHRGMSJEGUOYXEJVENKNZQSWBEEPOFZHJPAFEANLNVUWJKOOKDSOAUQGRSSVKPILVWJOWJLSYSRQDKRAKHSBATKHDGLFYHRWGNUWHWXESHYGTDKKEJOGYWLATEFITZKRFRFLUBVJRSJUROLQCOINEVUFWLNUUMZQGSATLPNKZOIPSAYOLJHLGNUVOGTDZVCGBEIHDLNEKKRWKHVDDKZOEHSGTTYHSDUPVQEPZTYHMGURKKEEODUOEGTEXUEQGNUKADLBLUIWJIEKESZHVGGSXLZQTGTSFQLQNAIPOFOZVGBQZHVWUJLAEGMGYSTUEWVIEJUHOTJIOGZHVDTZILZIFKYTZOLTGRVLLATGVUEVXOLQDLNEDXNVKRKKALHEELGFYKPZALIHVGTZKMFWHKLLLWTWXIEJAEUNXWHWNERWHSTDYDRWHECOSDOSKHNWJTFWHWYOWWWATDSUESZHZQGLNRFXGZZHVJRSYSRQDOUNUHRWJHFZAFEOEHCGALUHVWXIDDGATELQQMOEKVLMSBVUSXURKKEKREVSEJYIEWHSZQLLELKAIWH</textarea>
<p>We make a guess for the “period,” ie, the length of the key word.
Suppose we guess a period of 5. We then break the ciphertext into rows
of that length.</p>
<div
style="font-family: monospace; overflow-wrap: break-word; width: 3.5em;">
<p>IKGWE RTZON XEULT EZWHW XTYHS ZKEG…</p>
</div>
<p>If the period we’ve guessed is correct, each column of this rectangle
was encrypted using a Caesar cipher with the same shift. This means that
we should be able to detect that our guess for the period is correct by
examining indices of coincidence! If every column has an index of
coincidence in the range that’s expected of English text, our guess for
the period is probably correct. Otherwise, we should try a different
period.</p>
<p>In our example, if we guess a period of 5, it turns out that the
indices of coincidence of the five columns are 1.13, 1.11, 1.18, 1.15,
and 1.15, respectively. This is well outside the range that’s expected
of English text, so our guess 5 is probably wrong. So then we try a
period of 6, and we find indices of coincidence of 1.75, 1.77, 1.73,
1.72, 1.79, and 1.74 — all in the right range! This means there’s an
excellent chance that the period is 6.</p>
<p>Once we have a guess for the period, we’re in the clear! We then just
have to figure out what the shift is for each column, and we can do this
using basic frequency analysis: the most frequent letter in each column
should correspond to <code>E</code>, so we should guess that the shift
for that column is the shift that moves <code>E</code> to the most
frequent letter. (If that doesn’t work we might try shifting so that the
second most frequent letter in that column moves to <code>E</code>
instead.)</p>
<div id="sagecell-breaking-vignere" class="element">
<p><span class="label">SageCell</span> Here is a tool to help you break
a Vignère cipher using these ideas. Hit “Run.” You’ll see the
following:</p>
<ul>
<li><p>An “Input” box for ciphertext. It defaults to the ciphertext at
the beginning of this section.</p></li>
<li><p>A box labeled “Period” for you to guess a period. It defaults to
5, but we’ve already seen above that 5 is not the right guess, so you’ll
want to change this.</p></li>
<li><p>A box labeled “Shifts” to guess what the shifts were used to
encrypt each column. It must be a list (enclosed in square brackets) of
the same length as the period you guessed. If you’re changing the period
and aren’t ready to guess shifts yet, just make this a list of 0s of the
right length!</p></li>
</ul>
<p>Below these input fields, the code outputs several things.</p>
<ul>
<li><p>First you’ll see a table listing the indices of coincidence for
each column. Remember that your guess for period is probably correct
when the indices are all approximately 1.75.</p></li>
<li><p>Next, you’ll see a large table labeled “Ranks.” This table ranks
the letters that appear in each column by frequency, from most frequent
to least frequent. Below each letter is the Caesar shift that would
encrypt <code>E</code> into that letter. You’ll want to use this table
to construct your guess for the shifts. Most likely, the shift for
column <span class="math inline">\(i\)</span> will be the number that
appears below the most frequent letter in that column.</p></li>
<li><p>Finally, you’ll see the result of decrypting using your proposed
guesses!</p></li>
</ul>
<p>Decrypt the ciphertext! Hint: It’s one of the sample passages we’ve
seen above.</p>
<div class="sage">
<script type="text/x-sage">
from re import sub
from collections import Counter
from itertools import cycle

ciphertext = """IKGWERTZONXEULTEZWHWXTYHSZKEGQOJNENRUDJGFRNKUISLDZOMKDKWZHVUOSJLFZEJJONQHWVRFEATRYIDIKKDKKEHNAEWOEYFIRMLNIENIFMAJKELXAMHRKKDKKEEUOIVADUNVRNLNEERNKKNJHHWNAUKESXDYLSHGRVQTKGNUFOEVAELOFYRVSESZYVWSLOLCLDGTTCLKWHEZQGGATZQTZKDRUKFUWRQDAJOEWLAQESHIFMLVITTEMPVEDLIEWHAYGILMZUUJHIUGNERTZKLGLTAYHROLTKGCDDONEEWHWELVDVWOTRQDKNIWWTGZHVJRSTGVWHWEAIHGGONXWOLNEXUAFMEKKEFOSRLDQKSRQSOKRVGMJYDVDNSYSFRNSYTYHYSXEDDRJOEUDNVZHRWWARLSHOFTENBESXSUDYSTDNKOOOLCOINKHVUELNEEZHQPOJHPZCICOTSQETDRWUFKKEZUUJHAFJPVUHSVSROAVZOBHEHNIDFOEVAEBTZKYNLLDRIMHIFZHVNILIHVQAFJTYHRWYTNLLDHEJKULAPWRRLNELVEGLSLFHYNOJWSSYCYROKKTFLNZGBZWILOOSVEJBEUQOEXLFFKOUOUVAAJNVOLQYHRNIFMHVUHWGDZEEDOEMHTZKDVDDSXERWPWGCVEULOTZVNGZRZJHLZOJSESQOWWHWSWZWHDKVZWYSZTYDTEUMVQTLNEXDRVKNXDTWYWLQGLUTYHRSSBCHRKCEIHRWZUIQIFMTYHYSXERIRSODFINGZHZQGAMRLPBDKDNDTUNIEJTZKIIDPHXORFHLNRFXGZZHVZIFJONWOYKTYHRLNEPZOMRDSUANKSRWAFGNUDLDNIJOEYOOEVAKZHVBSLKPGHDGTTFWHWJOFUSLUNVVAFJHROTWJTFWACKACDSLROFNALZHVPOGTOIPOJKCFURWITCBALKATKOLNEIEYZKRCLGZZIWHLLORIHSAYTZELQOMGHLDKDKREKIAGHTZKMRJAATAEGPJKSJLNYGRVPEEHRRQCWONKRTZKHRQDGLMIVDWGNRQDVOSIHGSXDZQGZKRVAPGYTLOALOOEVALSYIXDWTEJVINGNZVHWJTYUOMMHKKECOTTKEFGSKKEQUPVQEVZHVKOMYEUROJGNUVOKNOLODZGVVFOFLIIPEVPOJHPZONYLSGVIELOFUFYLSXKLCRWKKRMDNLYGRBIFJIJFRWZIFQSZGDYHNGZFFUTMTAKHLQXETRGFOSVGMWLOIDRWYPVFTSHLVFHSXATWEJHYKKEKCEVWRATGFIAKUVVUEAMNRWHAYFVHTEEWROKZUMVZAKREEJTZKNVGBQGDZYEJYIFQIFZHVGIJKCKLOFUFKKECORBZHWTBVQESZHZWSOGLCVIHKRTHINKDUHCSEHRGMSJEGUOYXEJVENKNZQSWBEEPOFZHJPAFEANLNVUWJKOOKDSOAUQGRSSVKPILVWJOWJLSYSRQDKRAKHSBATKHDGLFYHRWGNUWHWXESHYGTDKKEJOGYWLATEFITZKRFRFLUBVJRSJUROLQCOINEVUFWLNUUMZQGSATLPNKZOIPSAYOLJHLGNUVOGTDZVCGBEIHDLNEKKRWKHVDDKZOEHSGTTYHSDUPVQEPZTYHMGURKKEEODUOEGTEXUEQGNUKADLBLUIWJIEKESZHVGGSXLZQTGTSFQLQNAIPOFOZVGBQZHVWUJLAEGMGYSTUEWVIEJUHOTJIOGZHVDTZILZIFKYTZOLTGRVLLATGVUEVXOLQDLNEDXNVKRKKALHEELGFYKPZALIHVGTZKMFWHKLLLWTWXIEJAEUNXWHWNERWHSTDYDRWHECOSDOSKHNWJTFWHWYOWWWATDSUESZHZQGLNRFXGZZHVJRSYSRQDOUNUHRWJHFZAFEOEHCGALUHVWXIDDGATELQQMOEKVLMSBVUSXURKKEKREVSEJYIEWHSZQLLELKAIWH"""

# Remove all non alphabetic characters and capitalize
def encode(text: str):
    stripped = sub(r"[^a-zA-Z]", "", text)
    return stripped.upper()

# Encode a string as a list of numbers 0--25
def numerify(text: str):
    return [(ord(x) - 65) for x in encode(text)]

# Turn a list of numbers 0--25 back into a string
def denumerify(nums: list):
    return "".join([chr((x % 26) + 65) for x in nums])

# Decrypt a string using the given key sequence  
def decrypt(text: str, shifts: list):
    nums = numerify(text.upper())
    transformed = [(x - shift) % 26 for x, shift in zip(nums, cycle(shifts))]
    return denumerify(transformed)

# Calculate index of coincidence of given text
# Use dictionary of counts if supplied    
def coincidence(text: str, c=None):
    n = len(text)
    if c is None:
        c = Counter(text)
    return 26.0 * sum([(m*(m-1))/(n*(n-1)) for x, m in c.items()])
    
def shift_to_E(letter):
    return (ord(letter) - ord("E")) % 26

# Prints an output div aligning with the interact controls   
def output_div(label: str, content: str):
    s = '<div class="sagecell_interactControlCell" style="width: 100%;">'
    s += f'<label class="sagecell_interactControlLabel">{label}</label>'
    s += f'<div class="sagecell_interactControl">{content}</div>'
    s += '</div>'
    pretty_print(html(s))

@interact
def _(text=input_box(default=ciphertext, label="Input", height=5, width=70),
      period=input_box(default="5", label="Period", width=62),
      shifts=input_box(default="[0,0,0,0,0]", label="Shifts", width=62)):
    if not text.isalpha() or not text.isupper():
        raise Exception("Ciphertext must consist only of uppercase characters")
    if int(period) != period or period < 1:
        raise Exception("Period must be a positive integer")
    
    alphabet = list(build_alphabet(name="upper"))
    cols = ["".join([text[x] for x in range(i, len(text), period)]) for i in range(period)]
    counts = [Counter(c) for c in cols]
    indices = [coincidence(s, c) for s, c in zip(cols, counts)]
    ranked = [sorted(alphabet, key=lambda x: c.get(x, 0), reverse=True) for c in counts]
    
    o = "<table style='text-align: center;'><tr><td>Col</td><td>IC</td></tr>"
    for i in range(period):
        o += f"<tr><td>{i+1}</td>"
        o += f"<td>{indices[i]:.2f}</td>"
    o += "</table>"
    output_div("ICs", o)
    
    o = "<table style='text-align: center; font-size: 0.7em;'>"
    for i in range(period):
        o += f"<tr><td rowspan=2 style='padding-right: 0.5em;>Col {i+1}</td>"
        o += "<td style='padding-right: 0.5em;>Letter</td>"
        for j in range(26):
            o += f"<td style='padding-right: 0.5em;>{ranked[i][j]}</td>"
        o += "</tr><tr><td style='padding-right: 0.5em;>Shift</td>"
        for j in range(26):
            o += f"<td style='padding-right: 0.5em;>{shift_to_E(ranked[i][j])}</td>"
        o += "</tr>"
    o += "</table>"
    output_div("Ranks", o)
    
    if len(shifts) != period:
        output = "Cannot decrypt; number of shifts must match period"
    else:
        output = decrypt(text, shifts)
    
    output_div("Output", f'<div style="inline-size: 45em; overflow-wrap: break-word;">{ output }</div>')
</script>
</div>
</div>
<div class="element">
<p><span class="label">Exercise</span> The following ciphertext was
encrypted using a Vignère cipher. Find the corresponding plaintext. Also
state what the key word used for encryption was.</p>
<textarea readonly rows=10 style="width: 100%;">KEAFVQGKSQLSCBPRTCQWFRSVRIYQEEJJRKVPGMEAJRXUMPAUNOFVCTKURBXEJVLVVRGBMEZLIRPEJRTVMHKHRISLJCQWEFUIZERJFSREEPJYDRNDVIKNYURMNSZVCMWJASGEZIUJZCUEIDRLFVDCSMETCNPRVDLVJMTKHRQSNVPQWAAPFCVKCESRWIEGJGRSHSICFTKEGJPQVEAJRTGFHXRGNPAEPYEUYVRBYFPZXFVVDOZTVIDWDEQDEEUJGJSHSVFLLFVDOZEUDGTRBYFAFIIUFFNSXNYMUVWUJXVDYTSLRTXFFBQLTNHEZEQVKHRXECCQQWRREWKLAEFAAEGFERTRSGFHNZRJKHRSMTYRWIKRZGRINGKSPMEUZLURTVOKCZRVVRVOKNZRJXOYEEEUJCUEAXMKYEGDSJIMTYQRRRXMIUFLNPLRTWSIGNCINOXCPRJRNGIIZICAVSGIIPRJNKOYESWGYUJIBOWZERGESRCYKFDXRRVPYJJRACEFMMBVRJVIECIRLRAKHRZHZWDGIEQOIZKFGIIAULVZPYFRQTRFIRJVIEJHVRQDLTNOIOGPGJSVPRRCMQBAZPXZFLQIAAFQGYYUZSFFVMVBCJAPPQDVLVRRLVRIVQVIAVOIUCGEVNGJSLJKGCAADLFCWQIBNOXVIGPXTBULVZPYFRQTSEVQGVMREXFJYADYOFELKWJRSCPAVIRQIEXJRUCCVYESSSQVLJVAEUSWREGRNBULVIGNFVRUSIVNQJEBOWFWRELSUJSEJYPUTUJRBNGVYRNQXLICQWMLBHFICTJAGIMIUYPFVVDIRKRJVSRGXVJUCJIADPZECFKOOMYJYYVKHRCSKKMOFFZZLVRPVZFRFPTFKRLNPUMFEQJVSRFQVURQJALJEDRACKHBMMTRLFZFRBVYVJNSUGJPFMCAFUFPEYJMFVAEMCKYYVZWBVPUJYEIISJGVVRGINVUCKFWQLTUFJFLPVYEZQXPZLIRCHQSWTFKRNJJRVTPKVDUVVIRFHFRCMIRJSTVIOFKZEYPVWRYMJKCPTEJJXYVYEYDNXRWFPIVTSVPFWRJVPNTXJKGNCIAUSOZACKEQXMKYRJVVVPPVEAGFFLFWKVPFRYFQPVRQWIEFJIDSPCTENOINCGHVOSIEGGGPVSFBPZWCHZLYFHNZRJCOIFXYVUQDAATMKKGPXNRYXKFZGCVVEVFCMQBEQBXYZKYZTUGPRJFKEGRZIJJFGNAFTMCVLVZSUPYCUFCMEAPRVVBVFCNMPFEYDIAIPXFBGNCMLMSMVPKWHRBFREBQEEQNIKYCPJHRIEUCYWXHREFLKYEFMSJXUZQJFFZBVMVJQLSJPVBDYPJHVQARJQJRTGFVVUZGKWRFRYVPPVRIPYJWGPXEETAYVLCIELPYKFZGXRNOHULIGRSXFHKYCUZXGISWKFGGRVOGVNGVYAAFBGICUJIBOSWDSTUEEPYJXJGVOAIIICGRJAAEECFMMFFOBGTYYPRLVBRWICPQYVOLVICAVSNOHNYCPZSLPYIWYVYEEHSZEEVFDVFWRZBVYEFFZVERJCAHHLZEECEDGIVFNGPXHRSFFLOWVTGPHFEHWRNJJXYDYFUEAJRXTMSLEGSCJYCYRSNOMEEMEVNGZSLEEIZRYXLFNYURCPVWKFKGUTBQPRPUKKHFBGIVBVYIAHWFYBQETFQIRBMHZTPSMVURJVYBVRXRLFYAAEWFDCFFNWVEEKFGIEVTSECWQEEVNQFIRCCFNULVIGPKHRXSICBCEDHOJFIRWEAGFPPYCKJMVOIKYCUVVROAFDCPFFSFVIRPCKHRGVZVLFJOSESEASCEAAEXYVNTZNPFLZDQGCFTBZVRLGOCYBQRKGQEOSISIIMTKWBIYEUPGUYRBVJCYVVRHOHVIJQLIFYZNVJNSRRETVIQQESJPYCUFCMEYBYXYCFRTGIMJJYNCYOVXGVPJRPFBXKYCDVGVORZEEQWAAPVXPRJVMVOHYRBUKIYMEELLWJUNMHVXPGVOSMYTZBKKYQFWGZRGKHRIIRKMHKHRDEEUJGJTUFMEKCPJIGZSWKFGVMBUMFEQVYETPPURLFJIYWIIMYUVSGIIWLKGJOSXMEVBGJPVUIKYCXZSVPRFWPCMIFIMEXUQDEAQIIYYRJTUFVVJRKCLYVVBVBKETUFHVGRJJOSULVYCCITNMMKKJGFFGIEKICUGEPUJFIRJZNTTLLDYPRNQEMMZLGNHVDLJKPWXGYFWLERKCTUFVVMCNYAFEVFNLGUIGJRWCMQUSBGWGRPMCIAHAZECPVVRSXYVJGJSGIIWCMYVRFXIIVYNIENECTISUYEQULVVWGJWRSIJKCGGEQXMKYBTZNXBRUZLVFXVDEKZMPKODVSKVPCSEYBMJYYFIENDLVUCXVNGPXYVQCEDNMWZERJVPNVWVKFCKFBMPFNCFRDBPVFGCPVDNOHRJYVKHRGIRJRQWBNMXYRXCIGBEQREGHVSGFHYZKUVLSIIJVCOVDGPGFDKCEDEFGFXLKKIBORFNGPKHRQIIJMPFFNOSCUUJZTRIEZICFJEEWEEKUKKHHOWKVYFPGNJXREBFIAJOFIFUUYEROXVICFNIGIKCFMOPMVFRREBJZSYPSBJCGDEQUSSCGIYTGIIXRPNRNQTXYVPWSYPVTJKFGGYEBQZUQQWFEVMKJRJVBEJKYKLGJSBGXYVDGRSGULVXJQNOSULVRQVFNVTLVUDCTEFBRUKFGTOYPVJFDVYEPVWYZMPJDROXVUZAKHRXLZKCCIMFPJKYCYFMROXYVLJVCNTXRGYNCOIFVKYGUWOYMCSPQCPIAHMERFQCLBXZFZAGKHRTSCVKPNOEEWJZPAFUEGEKYCTZSQZMEXBQEJHBRIFQGDAXJRXREGJTHSIKFFKJGHFWKJUJZCUNMXYRDVTEBRJCYVVDRYGLJCOVTUJWUFCUEOGIEGGCPVVRSCURW</textarea>
</div>
<h2 id="g-test">3.7. Interlude: <span
class="math inline">\(G\)</span>-Test</h2>
<h3 id="example-setup">Example Setup</h3>
<p>To motivate this section, consider the following situation. Suppose
that every registered voters in an imaginary county in the United States
is classified into the mutually exclusive and exhaustive racial groups
“White,” “Black,” “Hispanic,” and “Other.” Before proceeding any
further, let’s stop to think through this:</p>
<div class="element">
<p><span class="label">Exercise</span> Brainstorm as many reasons as you
can about why it might be problematic (and/or overly simplistic) to
categorize all of the registered voters of our imaginary county into one
and only one of the racial categories “White,” “Black,” “Hispanic,” and
“Other.”</p>
</div>
<p>I urge you to think carefully about issues like the ones you may have
identified in the above exercise whenever someone proposes some
clear-cut categorization scheme to you. In any case, we’ll continue this
section with our simplistic modeling assumption that these four racial
categories are mutually exclusive and exhaustive. We’ll see later that
there are situations where assuming a mutually exclusive and exhaustive
categorization is not so problematic, including in problems related to
cryptography.</p>
<p>Suppose that, by inspecting the voter rolls, we find that racial
distribution of this county is as follows:</p>
<table style="margin: auto; width: 75%; text-align: center;">
<tr>
<th width="35%">
</th>
<th width="15%">
White
</th>
<th width="15%">
Black
</th>
<th width="15%">
Hispanic
</th>
<th width="15%">
Other
</th>
<th width="15%">
Total
</th>
</tr>
<tr>
<th>
Distribution
</th>
<td>
72%
</td>
<td>
7%
</td>
<td>
12%
</td>
<td>
9%
</td>
<td>
100%
</td>
</tr>
</table>
<p>Since jurors are supposed to be drawn from the list of registered
voters, we might hope that a random sample of jurors would follow this
same racial distribution. Suppose that we actually sample 275 jurors and
observe the racial distribution displayed in the second row of the table
below.</p>
<table style="margin: auto; width: 75%; text-align: center;">
<tr>
<th width="35%">
</th>
<th width="15%">
White
</th>
<th width="15%">
Black
</th>
<th width="15%">
Hispanic
</th>
<th width="15%">
Other
</th>
<th width="15%">
Total
</th>
</tr>
<tr>
<th>
Distribution
</th>
<td>
72%
</td>
<td>
7%
</td>
<td>
12%
</td>
<td>
9%
</td>
<td>
100%
</td>
</tr>
<tr>
<th>
Observed
</th>
<td>
210
</td>
<td>
10
</td>
<td>
20
</td>
<td>
35
</td>
<td>
275
</td>
</tr>
<tr>
<th>
Expected
</th>
<td>
198
</td>
<td>
19.25
</td>
<td>
33
</td>
<td>
24.75
</td>
<td>
275
</td>
</tr>
</table>
<p>If our random sample of jurors followed the overall racial
distribution of registered voters, we would expect that 72% of them
would be White, which would be <span class="math inline">\(0.72 \cdot
275 = 198\)</span> people. We can calculate the expected numbers of
jurors in the other groups similarly to fill in the third row above.</p>
<p>Note that, even if the sample of jurors was representative of the
county’s electorate, there would be <em>some</em> deviation from the
expected counts. For example, remember that we’re assuming that the
categories are mutually exclusive, so we could not possibly observe a
sample with 19.25 Black jurors! But if we had observed something like
198 White jurors, 19 Black jurors, 33 Hispanic jurors, and 25 Other
jurors — or something very close to that — we probably would not be very
surprised with our results. Stated differently, the data we collected
would feel consistent with the hypothesis that the racial distribution
of jurors matches the racial distribution of the electorate.</p>
<p>But it <em>feels</em> like what we observed was actually pretty far
from the expected counts…! How can we quantify and make sense of this
observation?</p>
<h3 id="g-test-1"><span class="math inline">\(G\)</span>-Test</h3>
<p>The idea is to introduce a number that measures the difference
between the observed and expected rows. There are a variety of numbers
that can be used, but let us consider one that is often denoted <span
class="math inline">\(G\)</span>.<a href="#fn2" class="footnote-ref"
id="fnref2" role="doc-noteref"><sup>2</sup></a> It is defined as
follows:</p>
<div class="element">
<p><span class="label">Definition</span> Suppose <span
class="math inline">\(X\)</span> is a random variable with finitely many
values <span class="math inline">\(a_1, \dotsc, a_n\)</span> and let
<span class="math inline">\(p_i = P[X = a_i]\)</span>. Suppose we make
<span class="math inline">\(N\)</span> observations of the values <span
class="math inline">\(a_1, \dotsc, a_n\)</span> and that <span
class="math inline">\(O_i\)</span> is the number of observations of
<span class="math inline">\(a_i\)</span> that we made. Let <span
class="math inline">\(E_i = N p_i\)</span> and then define <span
class="math display">\[ G = 2 \sum_i O_i \ln \left( \frac{O_i}{E_i}
\right). \]</span> If <span class="math inline">\(O_i = 0\)</span> for
some <span class="math inline">\(i\)</span>, we set the corresponding
summand <span class="math inline">\(O_i \ln(O_i/E_i) = 0\)</span>. If
there exists an <span class="math inline">\(i\)</span> such that <span
class="math inline">\(E_i = 0\)</span> but <span
class="math inline">\(O_i \neq 0\)</span>, set <span
class="math inline">\(G = \infty\)</span>.</p>
</div>
<p>In our example, the random variable <span
class="math inline">\(X\)</span> represents observing the race of a
randomly drawn voter from our county. It has 4 possible values (White,
Black, Hispanic, Other), so <span class="math inline">\(n = 4\)</span>.
The values <span class="math inline">\(p_i\)</span> are the percentages
of the electorate in each racial group, the values <span
class="math inline">\(O_i\)</span> are the observed counts, and the
values <span class="math inline">\(E_i\)</span> are the expected counts.
We have <span class="math display">\[ G = 2 \left( 210 \ln \left(
\frac{210}{198} \right) + 10 \ln \left( \frac{10}{19.25} \right) + 20
\ln \left( \frac{20}{33} \right) + 35 \ln \left( \frac{35}{24.75}
\right) \right) \approx 15.84 \]</span></p>
<p>Here is a fundamental observation about this quantity:</p>
<div class="element">
<p><span class="label">Gibbs’ Inequality</span> We always have <span
class="math inline">\(G \geq 0\)</span>. Moreover, <span
class="math inline">\(G = 0\)</span> if and only if <span
class="math inline">\(O_i = E_i\)</span> for all <span
class="math inline">\(i = 1, \dotsc, n\)</span>.</p>
</div>
<p>Observe that if <span class="math inline">\(O_i = E_i\)</span> for
all <span class="math inline">\(i\)</span>, then <span
class="math inline">\(\ln(O_i/E_i) = \ln(1) = 0\)</span> for all <span
class="math inline">\(i\)</span>, so <span class="math inline">\(G =
0\)</span>. This proves one small part of the above theorem; we will
omit the rest of the proof, but if you’re a proof-inclined person, you
can find some accessible proofs <a
href="https://en.wikipedia.org/wiki/Gibbs%27_inequality">on
Wikipedia</a>. The key idea to take away is that <span
class="math inline">\(G\)</span> is 0 when the observed counts exactly
match up with the expected counts, and that <span
class="math inline">\(G\)</span> gets big when the observed counts
differ significantly from the expected counts.</p>
<p>How big is “big”? In particular, in our example, is 15.84 a “big”
value of <span class="math inline">\(G\)</span>? The answer to this
question is provided by the following difficult theorem from probability
theory, which we state slightly imprecisely and explain in a bit more
detail after the statement.</p>
<div class="element">
<p><span class="label">Wilks’ Theorem</span> Suppose the <span
class="math inline">\(N\)</span> observations of the values <span
class="math inline">\(a_1, \dotsc, a_n\)</span> that we make are in fact
independent observations of the random variable <span
class="math inline">\(X\)</span>. For large values of <span
class="math inline">\(N\)</span>, the values of <span
class="math inline">\(G\)</span> are well approximated by a chi-square
distribution with <span class="math inline">\(n-1\)</span> degrees of
freedom.</p>
</div>
<p>Several points of explanation are now in order. First, a “chi-square
distribution with <span class="math inline">\(k\)</span> degrees of
freedom” is a certain function <span class="math inline">\(f_k\)</span>
defined on <span class="math inline">\([0, \infty)\)</span> and taking
non-negative values everywhere with total integral equal to 1.<a
href="#fn3" class="footnote-ref" id="fnref3"
role="doc-noteref"><sup>3</sup></a> In other words, we have <span
class="math inline">\(f_k(x) \geq 0\)</span> for all <span
class="math inline">\(x \geq 0\)</span> and<br />
<span class="math display">\[ \int_0^\infty f_k(x)\, dx = 1. \]</span>
The formula for <span class="math inline">\(f_k(x)\)</span> is
complicated and also unimportant for our purposes, because as we will
note below, most well-developed programming languages have built-in
functions that know how to calculate relevant integrals of <span
class="math inline">\(f_k\)</span>. Still, it’s useful to at least have
some geometric intuition about what the functions <span
class="math inline">\(f_k\)</span> look like for varying values of <span
class="math inline">\(k\)</span>. This is what the following SageCell
does.</p>
<div class="element">
<span class="label">SageCell</span> The following code plots a graph of
the function <span class="math inline">\(f_k\)</span> described above.
Hit “Run.” It defaults to <span class="math inline">\(k = 3\)</span>,
but then change the first line of the code to see what happens for other
positive integers <span class="math inline">\(k\)</span>! Make sure to
pay attention to the scale on the axes as you explore.
<div class="sage">
<script type="text/x-sage">
k = 3 # must be positive!
chisq = RealDistribution("chisquared", k)
chisq.plot(xmin = 0, xmax = 4*k)
</script>
</div>
</div>
<p>Second, to say that “the values of <span
class="math inline">\(G\)</span> are well approximated by a chi-square
distribution with <span class="math inline">\(n-1\)</span> degrees of
freedom” is to say that, for any (not necessarily finite) interval <span
class="math inline">\((a, b)\)</span>, the probability that <span
class="math inline">\(G\)</span> lands inside the interval <span
class="math inline">\((a, b)\)</span> is approximately <span
class="math display">\[ \int_a^b f_k(x)\, dx. \]</span> Sage can compute
these types of integrals for us when <span class="math inline">\(a =
0\)</span> and <span class="math inline">\(b\)</span> is finite, but we
can always reduce the general case to this special case.</p>
<div class="element">
<span class="label">SageCell</span> The following Sage code calculates
for us that <span class="math display">\[ \int_0^{15.84} f_3(x)\, dx
\approx 0.999. \]</span> Notice where the degrees of freedom 3 goes, and
also where the upper endpoint of integration 15.84 goes. The
<code>cum_distribution_function</code> stands for “cumulative
distribution function,” which means that the output is the total area
from 0 up to the input value.
<div class="sage">
<script type="text/x-sage">
k = 3
chisq = RealDistribution("chisquared", k)
chisq.cum_distribution_function(15.84)
</script>
</div>
</div>
<p>It follows that <span class="math display">\[ \int_{15.84}^\infty
f_3(x)\, dx = 1 - \int_0^{15.84} f_3(x) \approx 1 - 0.999 = 0.001.
\]</span></p>
<p>The number 0.001 is our <em>p-value</em>. It is telling us that the
probability of observing a value of <span
class="math inline">\(G\)</span> that is bigger than 15.84 is only about
0.1%! That is quite a small probability, so our calculation suggests
that the value of <span class="math inline">\(G\)</span> that we saw is
in fact quite large.</p>
<p>Stated differently, our p-value of 0.001 tells us that, if jurors in
this county were truly representative of the county’s electorate, there
would only be roughly a 0.1% chance of seeing a sample that deviated at
least as much from the expected counts as the data that we saw. Because
that’s such a small probability, this suggests that it’s very unlikely
that our sample of jurors is actually representative of the county’s
electorate. We have quantified the observation we made informally
above.</p>
<p>If you go back and look at the statement of Wilks’ Theorem, you’ll
see one detail that we’ve ignored so far, which brings us to the third
point of explanation. The theorem only works for “large values of <span
class="math inline">\(N\)</span>.” Was our value of <span
class="math inline">\(N = 275\)</span> large enough to justify what we
did above?</p>
<p>The answer to this question depends on how well you want the values
of <span class="math inline">\(G\)</span> to be approximated by a
chi-square distribution. The better an approximation you want, the
higher a value of <span class="math inline">\(N\)</span> you need. That
being said, statisticians have found through practice that the following
heuristic generally works well:</p>
<div class="element">
<p><span class="label">Heuristic Addendum to Wilks’ Theorem</span> The
approximation of <span class="math inline">\(G\)</span> by a chi-square
distribution with <span class="math inline">\(n-1\)</span> degrees of
freedom is “good enough” as long as the vast majority of the expected
counts <span class="math inline">\(E_1, \dotsc, E_n\)</span> are all at
least 5.</p>
</div>
<p>In our situation, all of the expected counts are well above 5, so we
do not need to worry.</p>
<p>This process (of computing expected counts, finding an observed value
of <span class="math inline">\(G\)</span>, and using a chi-square
approximation to find a p-value, ie, the probability of observing a
larger value of <span class="math inline">\(G\)</span> than what we
observed if the observations do in fact come from the theoretical
distribution) is called a <em><span
class="math inline">\(G\)</span>-test</em>. It is a very useful
technique for a lot of problems in statistics, and below, we will apply
it to codebreaking! Meanwhile, here are some problems to practice with
the ideas you’ve encountered here.</p>
<div class="element">
<p><span class="label">Exercise</span> Use the
<code>cum_distribution_function</code> in Sage to calculate the
following integrals.</p>
<ol type="a">
<li><span class="math inline">\(\displaystyle \int_0^{20} f_{10}(x)\,
dx\)</span></li>
<li><span class="math inline">\(\displaystyle \int_{10}^{\infty}
f_{3}(x)\, dx\)</span></li>
<li><span class="math inline">\(\displaystyle \int_{10}^{20} f_{15}(x)\,
dx\)</span></li>
</ol>
</div>
<div class="element">
<p><span class="label">Exercise</span> A professor using an open source
introductory statistics book predicts that 60% of the students will
purchase a hard copy of the book, 25% will print it out from the web,
and 15% will read it online. At the end of the semester she asks her
students to complete a survey where they indicate what format of the
book they used. Of the 126 students, 71 said they bought a hard copy of
the book, 30 said they printed it out from the web, and 25 said they
read it online. How well does this data fit the professor’s predictions?
Run a <span class="math inline">\(G\)</span>-test to find out!</p>
</div>
<p>We conclude this section with a technical remark regarding the
definition of <span class="math inline">\(G\)</span>. Feel free to skip
over this at first pass, but make sure to come back to it at some point
soon!</p>
<div class="element">
<p><span class="label">Technical Remark</span> You’ll notice that <span
class="math inline">\(G\)</span> is defined to be <span
class="math inline">\(\infty\)</span> if there is a nonzero observed
count corresponding to an expected count of 0. This makes theoretical
sense: if there’s a value we theoretically expect to be
<em>impossible</em> to observe, but then we observe it, the distance
from the observed distribution to the expected distribution should be
massive!</p>
<p>In practice, if you see an expected count of 0, it’s worth thinking
carefully to decide if this really makes sense. We’ll see in examples
below that sometimes, the way we compute expected counts will lead to
certain expected counts being 0 when they maybe “shouldn’t” be, in which
case it may be useful to “fudge” the expected count a little bit.</p>
</div>
<h2 id="breaking-rectangular-transposition">3.8. Breaking Rectangular
Transposition</h2>
<p>Suppose we have a long passage which we know to be encrypted using
rectangular transposition:</p>
<textarea readonly rows=10 style="width: 100%;">OIPWMJALWSLELJLYEAMENUABIHSDACESRTIEEMKHAOAMNPAIIELNAPRCAAHGITRFECHETALEOIWUTTUDENBLPCUURSTOSOULIEEVCDOYUNOEPHTOATENHWTIRSBEAAHITENDDOEYNBTDNHIELWONOEYNTNEIHNTREIAEURQEPESERTTCNJERBLYELEDNNHAAWGELREYZLAIARLUIDLLGELJNNBASEYNAOWSEIIHSCHYVRSEENAODSENWITNONEADLHEFHJTOBLYELEENWLSAOBLWELAHMSETXNIODOELNNINYWFOIOLCLAAUHEPIMMAMNJASBLYELEWNEIHAILUTQLSPSIOEULPLYBNAOGLLWIEYNSFOERPRSMIHHOCPOKPIDTNHAEONYUGAOOCNATEEINNVETLGETPAHOPRYEFOILLCLAAUREOLWNMASANELAELJNNBAHEYLWLPIEBOALBRNGIARYKDSYANOUHIWOITKNASRYUGOGORTTLIREADMHSGABRIHLTELAIATCRPJLREAUELBAYLCPTHANHHCPIWCOUEDRPTERHDOTGNAOFSOTTIIIHSSHLOYIRTMSOESEEHRBEWETENWEWHTOETTLTLIAYCTOIETFRYOFSHUAOTADHTTNOADZSHEDLESEFIYOLPTFRYORSHUAOTADERYNOISUNSNHRGETIOGARESCAICOLNLYAORTRIISIGNTINMSUBLSNRADSEEUTRTMONSMGINTIGHETBUAOAHATARWKTOPOTSAEOCLMEIETMWOEHMSNRADEEEHTVATNROEYEHLEASEGFROOSLTNOETOGGJANSMAAWIYELBLJWAIRNEHTTAEIIAANGTUEASCBAIHSTEAUHPCSAESNALNSUDOTEAHRTRTIEHKLIBGNEEOIGFNNRFIYAAYTRAOSIIJMFSNEEIRWSETOICWEOGHMMVSEEITPCUIAHEFIORHWTAIMDONAURIPTZEPANFCGIAADLNETSROOLVLAEEFVADENSBEALTGOSRWGEUNOTGISFICHOTPUJBASMALWINNADGOAHNNITTBNAEDWTEAHTRSFOTIOSOPTMVNOEGILPOTORSBEALAWDEAHNTWAMHSHGTAHIEEENBVNNWIOKITENHNRICISDTIAINMRGOTNNCAAOSHLNROERJFREEAELBAYLHITESNTAEHMNHOGOURETHUTUSDSOINCVDOELEFDRENOCFRYAHNWOEODPNSESIILFSHJCNUOENAIGTGEHVRETDTILOBHITENETISPRFNROSSELNUAGIIIMDARIIGHNLDVILEAIDWLIEEILJDLSMABWINRIANOEHTHIWOUENSOEGENRAEONRRCDTAFHIEUWAROBHREETPTNIEASLRIALNFOTRNGNARDAMAAOTEFNOLTUCTIETAIOKNRWEHRAETTTAMHRCDAHEAUEFLRESRSCICBOSASROKRUGCRDOAFNELWROFDSNRUYENHDCEOANRWLAGNLIIEYHDTLEELRLWHITENSEHTHIWHUEASOEONDWDRHGOETENNXDURDOAOTXDETNNTOROODAHTNATTNXDEDOOTTROUABTTHHHSAITNBESEDGLNAOOAOHTTGJVNIEETSAHFMARCRSEREYELCEEBRMMHDTEIENAIFDHHCTOTAIGTTHUTMTEAAOOSLFRETLMTITMNTEOHAWETHAHWSENGYNFIDPOAIMRWTLOOSONGTDURNBAAINLEEHWTLCEEGNEETVDLTLLEOETLJTIOMHWWIVSIEFASEROAYDDNMALASRBEIIYRGFLETNDEHHHWIETUEOSHTABCMEEAAORBEHIGONDUSRNEUIYTGABPTIPLHDDAYLEMRMAOFHOWONCCJMAIMALDUELMTAIMNDADENEEETDSTAIHLTWSHSOILBLEEHUFAEIMCNTEWEFONTHTECGSHHIOOWRLOHHSAIEBRNLIINCSAKANLADSRFAARSWFIOGDAHRSELIDAEHTHMSOEHIEHRFEWOUWMRODNNOAEDELMONONRLPADNEAGOEITRNNBIALNMTCATHEORRMFEEUMRMSMOUMSTORBUAETWALHTHTTESOLOELWPELCHAPIDRGOALNLYAIUNLDCIDDNWAEOASRTHFSFLOTSWRWEOBUDELOEUNXTOESMTOTTMSHEIEPRNAELSFIOTGTEILTNLITSREWRMNORMEIBEMGISJNEOHRTMANFNDAGYNAICMEEBSREACINLDTEAHNEKYSERANHIDAIIVTNRMDITHETPRIAOTSUPBEERISTAHAEIDMASYNHMUHMCEDFPEERHSRDIERGTNOITSAICDNCNETNOLDXEAELNILTIRSAAGYLEOLRGHNTEGISOEONBLEPOXRHIGINRTMUHOSENLSDEILWTYSNAOGLHWTAFRSCROKPONTOEMEIHPCEYPEUODKBDOSJDTNIWDAESUTDASTITHOEAHSTHEOPDPTGONTIGTPRIAOHSTIAERTIDHSYATLRPETLMTIRROIJAGHIHAEWHDHATRSEEPIIIDSNDTRELECWADINYHHNEITGRNDIANSACTITTAHHEAWSBAEOYHBWOHOGTURRHGOETEEISRCTOEIMSOESISMASEDTNEFHTTOEOTPSWONPLDAMAIHJKADERLAOETTDNARWNOHBNMEUYEHDSERORDNEIIHDCETHADANETLSEIDOETSDNTIYACPFEOASLELHSTLIOTNOHASHTTGCAOCDHDREIRUSTEUHNNRUDORONCUGIDTYURNTIGHNRTPSFAEYFYETIERCPSA</textarea>
<p>Here is a strategy for breaking the code.</p>
<p>We start by making an arbitrary guess for the “period,” ie, the
length of the key word. We know that the period has to be a divisor of
the length of the ciphertext. The above ciphertext is 2808 characters,
and 2808 has 32 possible divisors:</p>
<p><span class="math display">\[ 1, 2, 3, 4, 6, 8, 9, 12, 13, 18, 24,
26, 27, 36, 39, 52, 54, 72, \\
78, 104, 108, 117, 156, 216, 234, 312, 351, 468, 702, 936, 1404, 2808
\]</span></p>
<p>Since there are only 26 characters in the English alphabet, the
period can be at most 26.<a href="#fn4" class="footnote-ref" id="fnref4"
role="doc-noteref"><sup>4</sup></a> This means that the period must be
one of the following:</p>
<p><span class="math display">\[ 1, 2, 3, 4, 6, 8, 9, 12, 13, 18, 24, 26
\]</span></p>
<p>Let’s guess that the period is 6. We then arrange our ciphertext into
a rectangle of width 6. In this case, our rectangle will have height
<span class="math inline">\(N = 2808/6 = 468\)</span>. That is a lot of
lines to display, so for ease of reading, I will truncate displaying
this rectangle, but remember that the rectangle is actually very
long.</p>
<div style="font-family: monospace;">
<p>OIPWMJ<br />
ALWSLE<br />
LJLYEA<br />
MENUAB<br />
IHSDAC<br />
ESRTIE<br />
EMKHAO<br />
AMNPAI<br />
IELNAP<br />
RCAAH…</p>
</div>
<p>Now for every pair of numbers <span class="math inline">\(i \neq
j\)</span> between 1 and 6, consider the tall column of width 2 we would
get by placing the <span class="math inline">\(i\)</span>th and <span
class="math inline">\(j\)</span>th column of the above rectangle next to
each other. For example, if <span class="math inline">\(i = 4\)</span>
and <span class="math inline">\(j = 2\)</span>, we would get the
following <span class="math inline">\(468 \times 2\)</span>
rectangle:</p>
<div style="font-family: monospace; overflow-wrap: break-word;">
<p>WI<br />
SL<br />
YJ<br />
UE<br />
DH<br />
TS<br />
HM<br />
PM<br />
NE<br />
AC<br />
…</p>
</div>
<p>We think of this as 468 observations of a pair of English letters
<em>if</em> the columns <span class="math inline">\(i\)</span> and <span
class="math inline">\(j\)</span> were consecutive in the plaintext. In
particular, for every pair of letters <span
class="math inline">\(\alpha\)</span> and <span
class="math inline">\(\beta\)</span>, we count the number of times that
we see the sequence <span class="math inline">\(\alpha\beta\)</span>
appearing in this column. Let <span
class="math inline">\(O^{(i,j)}_{\alpha\beta}\)</span> be this number.
We can see from our truncated example above that <span
class="math inline">\(O^{(4,2)}_{\text{WI}},
O^{(4,2)}_{\text{SL}}\)</span>, etc, are all <em>at least</em> 1. (In
fact, it turns out that if you do this counting for the whole
ciphertext, we have <span class="math inline">\(O^{(4,2)}_{\text{WI}} =
1\)</span> and <span class="math inline">\(O^{(4,2)}_{\text{SL}} =
2\)</span>.)</p>
<p>On the other hand, we can use a large sample of English to calculate
the probability <span class="math inline">\(p_{\alpha\beta}\)</span> of
the pair <span class="math inline">\(\alpha\beta\)</span> occurring in
English text. We can use these to calculate expected counts <span
class="math inline">\(E_{\alpha\beta} = N p_{\alpha\beta} = 468
p_{\alpha\beta}\)</span> and then calculate a corresponding value of
<span class="math inline">\(G\)</span> using the observed counts <span
class="math inline">\(O^{(i,j)}_{\alpha\beta}\)</span>. Let us call this
<span class="math inline">\(G^{(i,j)}\)</span>. In other words, we have
<span class="math display">\[ G^{(i,j)} = 2 \sum_{\alpha\beta}
O^{(i,j)}_{\alpha\beta} \ln \left(
\frac{O^{(i,j)}_{\alpha\beta}}{E_{\alpha\beta}} \right). \]</span> We
can then assemble all of these values of <span
class="math inline">\(G^{(i,j)}\)</span> as <span
class="math inline">\(i \neq j\)</span> varies into a box of numbers:
<span class="math display">\[ \begin{bmatrix}
\infty &amp; G^{(1,2)} &amp; G^{(1,3)} &amp; G^{(1,4)} &amp; G^{(1,5)}
&amp; G^{(1,6)} \\
G^{(2,1)} &amp; \infty &amp; G^{(2,3)} &amp; G^{(2,4)} &amp; G^{(2,5)}
&amp; G^{(2,6)} \\
G^{(3,1)} &amp; G^{(3,2)} &amp; \infty &amp; G^{(3,4)} &amp; G^{(3,5)}
&amp; G^{(3,6)} \\
G^{(4,1)} &amp; G^{(4,2)} &amp; G^{(4,3)} &amp; \infty &amp; G^{(4,5)}
&amp; G^{(4,6)} \\
G^{(5,1)} &amp; G^{(5,2)} &amp; G^{(5,3)} &amp; G^{(5,4)} &amp; \infty
&amp; G^{(5,6)} \\
G^{(6,1)} &amp; G^{(6,2)} &amp; G^{(6,3)} &amp; G^{(6,4)} &amp;
G^{(6,5)} &amp; \infty \end{bmatrix}\]</span> Note that all of the
diagonal entries of this box are set to <span
class="math inline">\(\infty\)</span> because we only compute <span
class="math inline">\(G^{(i,j)}\)</span> when <span
class="math inline">\(i \neq j\)</span>. This is an arbitrary convention
and the diagonal entries should just be ignored.</p>
<p>If we guessed the period correctly, then we should find that
<em>every row except one of them</em> has one number that’s much smaller
than all of the others — and this tells us something about how to
permute the letters to find the plaintext! For example, if we find in
the first row that <span class="math inline">\(G^{(1,4)}\)</span> is
much smaller than the other numbers, that tells us that rows 1 and 4 are
likely to be consecutive in the plaintext — because the frequency
distribution of the pairs that occur in the long <span
class="math inline">\(468 \times 2\)</span> rectangle displayed earlier
is close to the frequency distribution of pairs that occur in English
plaintext.</p>
<p>This would be an <em>enormous</em> amount of calculation to do by
hand. If the period we’ve guessed is <span
class="math inline">\(p\)</span>, there are <span
class="math inline">\(p(p-1)\)</span> choices for pairs <span
class="math inline">\((i,j)\)</span> where <span class="math inline">\(i
\neq j\)</span>. For example, with <span class="math inline">\(p =
6\)</span>, there are 30 choices for such pairs, so we have 30 values of
<span class="math inline">\(G^{(i,j)}\)</span> to compute. Moreover,
there are <span class="math inline">\(26^2 = 676\)</span> possible
choices for a sequence <span class="math inline">\(\alpha\beta\)</span>,
so we have that many observed and expected counts to compute every time,
and then a large sum to compute to find <span
class="math inline">\(G^{(i,j)}\)</span>…! So we’ll get a computer to do
these calculations for us.</p>
<p>Before seeing what the result looks like, we pause for a technical
remark. Feel free to ignore this at first pass, but you should come back
to it at some point and try to internalize what it’s saying. It’s
closely related the technical remark at the end of the last section.</p>
<div class="element">
<p><span class="label">Technical Remark</span> There is a technical
problem related to how “large” our sample text is. Even if it is quite
large, it could miss certain pairs of letters that are infrequent in
English — but which are not strictly impossible in English. In the
SageCell below, we’ll use a sample text that combines a passage from
Fitzgerald’s <em>The Great Gatsby</em>, the entire Declaration of
Independence, a passage from Brönte’s <em>Wuthering Heights</em>, the
entire preamble to the Universal Decalaration of Human Rights, and the
entirety of Poe’s short stories “William Wilson,” and “The Tell-Tale
Heart” – but even in this fairly large sample, there are no instances of
the pair <code>OQ</code>, which is not strictly impossible since it can
occur in encodings of legitimate phrases like
<code>Kangaroo Queen</code>! For all we know, some of these legitimate
but infrequent sequences which don’t appear in our sample could very
well occur in the encrypted message. But if it does happen to occur, our
“expected” count based on the sample will be 0, which will lead to a
<span class="math inline">\(G\)</span> value of <span
class="math inline">\(\infty\)</span>.</p>
<p>This is problematic. One solution is expanding the sample even more,
but then the computations also get slower. Here we’ll adopt an
alternative solution: whenever we see an expected count of 0, we’ll
artificially go in and set it to be something nonzero but small. (The
code below will use 0.1, but you’re welcome to change this if you like.
This number is set towards the beginning of the code block, at the line
that says <code>epsilon = 0.1</code>.) This way, we’ll always get finite
<span class="math inline">\(G\)</span> values, but we’ll still be
capturing the fact that pairs that fail to occur in our sample should
occur at most very infreqeuntly in the decrypted ciphertext.</p>
</div>
<p>Returning to our example, we find the following “<span
class="math inline">\(G\)</span>-box.”</p>
<p><span class="math display">\[ \begin{bmatrix}
\infty &amp; 1151.3 &amp; 1090.2 &amp; \color{green}485.5  &amp; 1069.3
&amp; 1005.0 \\
1234.4 &amp; \infty &amp; 1228.3 &amp; 1049.6 &amp;
\color{green}440.2  &amp; 1148.6 \\
\color{green}437.5  &amp; 1044.1 &amp; \infty &amp; 1004.1 &amp; 1164.5
&amp;  933.4 \\
1154.7 &amp; 1088.6 &amp; 977.3  &amp; \infty &amp; 1115.7 &amp;  1023.6
\\
1137.2 &amp; 1221.9 &amp; \color{green}425.9  &amp; 1100.0 &amp; \infty
&amp; 1070.0 \\
1003.7 &amp; \color{green}442.3  &amp; 944.9  &amp; 1021.6 &amp; 1086.1
&amp; \infty
\end{bmatrix} \]</span></p>
<p>The specific numbers we see in this box are not terribly important:
what’s important is that every row except one has a number that’s
significantly smaller than the other numbers on that row. The numbers
that are smaller than the others on the same row are highlighted in
green, and you’ll notice that every row except the fourth has a green
entry. The fact that in row 1, the 4th column is much smaller than the
other entries in that row suggests that columns 1 and 4 in our <span
class="math inline">\(468 \times 6\)</span> rectangle are consecutive.
Similarly, in row 2, the fact that the 5th column is much smaller than
others suggests that columns 2 and 5 are consecutive. If you look at all
the relations you get this way and put them together, you should find
that the above <span class="math inline">\(G\)</span>-box leads us to
think that the ordering of the columns is 6, 2, 5, 3, 1, 4. The fact
that the 4th row doesn’t have an entry that’s much smaller than the
others corresponds to the fact that the 4th column gets reordered to the
end.</p>
<p>Here’s an execise to practice producing this ordering:</p>
<div class="element">
<p><span class="label">Exercise</span> Suppose that, when trying to
break rectangular transposition, you find “<span
class="math inline">\(G\)</span>-boxes” of the following forms, where
the exclamation mark indicates an entry that is much smaller than every
other entry on its row. Write down the corresponding decrypting
permutation (ie, the ordering of the columns in the plaintext) that this
configuration of values suggests.</p>
<ol type="a">
<li><p><span class="math inline">\(\begin{bmatrix} . &amp; . &amp; .
&amp; ! &amp; . \\ . &amp; . &amp; . &amp; . &amp; ! \\ . &amp; . &amp;
. &amp; . &amp; . \\ . &amp; ! &amp; . &amp; . &amp; . \\ . &amp; .
&amp; ! &amp; . &amp; . \end{bmatrix}\)</span></p></li>
<li><p><span class="math inline">\(\begin{bmatrix} . &amp; ! &amp; .
&amp; . &amp; . \\ . &amp; . &amp; . &amp; . &amp; . \\ ! &amp; . &amp;
. &amp; . &amp; . \\ . &amp; . &amp; ! &amp; . &amp; . \\ . &amp; .
&amp; . &amp; ! &amp; . \end{bmatrix}\)</span></p></li>
<li><p><span class="math inline">\(\begin{bmatrix} . &amp; . &amp; .
&amp; ! &amp; . &amp; . &amp; . \\ . &amp; . &amp; . &amp; . &amp; .
&amp; . &amp; ! \\ . &amp; ! &amp; . &amp; . &amp; . &amp; . &amp; . \\
. &amp; . &amp; ! &amp; . &amp; . &amp; . &amp; . \\ . &amp; . &amp; .
&amp; . &amp; . &amp; . &amp; . \\ . &amp; . &amp; . &amp; . &amp; !
&amp; . &amp; . \\ . &amp; . &amp; . &amp; . &amp; . &amp; ! &amp; . \\
\end{bmatrix}\)</span></p></li>
</ol>
</div>
<p>This pattern (one number on each row except one is smaller than all
the others in the same row) will most likely only happen when we guess
the period correctly. If our period was incorrect, we’ll see something
different. In our example, if we guessed that the period is 4, we would
find the following box:</p>
<p><span class="math display">\[ \begin{bmatrix}
\infty &amp; 1272.1 &amp; 1355.2 &amp; \color{orange} 861.3  \\
1453.5 &amp; \infty &amp; 1419.3 &amp; 1312.9  \\
\color{orange} 732.1 &amp; 1353.3 &amp; \infty &amp; 1405.0  \\
1302.4 &amp; 1279.2 &amp; 1297.5 &amp; \infty
\end{bmatrix} \]</span></p>
<p>Notice that all the entries in the second and fourth rows are
similarly sized. Rows 1 and 3 do have one entry that’s a little smaller
than the others, but the difference is not nearly as dramatic as we saw
above. Of course, sometimes, we might find a “<span
class="math inline">\(G\)</span> box” that has the right pattern even
though our guess is wrong. But in that case, we should see nonsense when
we try decrypting using the corresponding permutation, and then we just
make another guess for the period!</p>
<p>We’re now ready to play with a SageCell.</p>
<div id="sagecell-breaking-rectangular-transposition" class="element">
<p><span class="label">SageCell</span> Here is a SageCell that does the
above computations and helps you break rectangular transposition! Once
you hit “Run,” here’s what you’ll see:</p>
<ul>
<li><p>The “Cipher” box will contain ciphertext. It defaults to the
ciphertext at the start of this section.</p></li>
<li><p>The “Sample” box will contain sample English text. It defaults to
several segments from a variety of English texts.</p></li>
<li><p>The “Period” slider is for guessing the period. It defaults to
4.</p></li>
<li><p>The “Sigma” text box is for guessing the ordering of the columns.
It defaults to <code>[1,2,3,4]</code>.</p></li>
</ul>
<p>Based on these inputs, you’ll see the following outputs:</p>
<ul>
<li><p>The “G-Box” will output the box of the values <span
class="math inline">\(G^{(i,j)}\)</span> we described above.</p></li>
<li><p>The “Output” that results from applying the decrypting
permutation Sigma to the ciphertext.</p></li>
<li><p>Finally, under “Remarks,” you’ll see a list of bigrams which
occur in the output text but not in the sample text. Ideally this list
should be short.</p></li>
</ul>
<p>Note that you’ll only see the “Output” and “Remarks” if Sigma is a
permutation of the numbers from 1 up to the period you guessed;
otherwise you’ll see an error message here.</p>
We saw above that the period should be 6 and that the ordering of the
columns should be <code>[6,2,5,3,1,4]</code>. Adjust the period and
sigma to these values and see if this works!
<div class="sage">
<script type="text/x-sage">
from re import sub
from collections import Counter

epsilon = 0.1
ciphertext = """OIPWMJALWSLELJLYEAMENUABIHSDACESRTIEEMKHAOAMNPAIIELNAPRCAAHGITRFECHETALEOIWUTTUDENBLPCUURSTOSOULIEEVCDOYUNOEPHTOATENHWTIRSBEAAHITENDDOEYNBTDNHIELWONOEYNTNEIHNTREIAEURQEPESERTTCNJERBLYELEDNNHAAWGELREYZLAIARLUIDLLGELJNNBASEYNAOWSEIIHSCHYVRSEENAODSENWITNONEADLHEFHJTOBLYELEENWLSAOBLWELAHMSETXNIODOELNNINYWFOIOLCLAAUHEPIMMAMNJASBLYELEWNEIHAILUTQLSPSIOEULPLYBNAOGLLWIEYNSFOERPRSMIHHOCPOKPIDTNHAEONYUGAOOCNATEEINNVETLGETPAHOPRYEFOILLCLAAUREOLWNMASANELAELJNNBAHEYLWLPIEBOALBRNGIARYKDSYANOUHIWOITKNASRYUGOGORTTLIREADMHSGABRIHLTELAIATCRPJLREAUELBAYLCPTHANHHCPIWCOUEDRPTERHDOTGNAOFSOTTIIIHSSHLOYIRTMSOESEEHRBEWETENWEWHTOETTLTLIAYCTOIETFRYOFSHUAOTADHTTNOADZSHEDLESEFIYOLPTFRYORSHUAOTADERYNOISUNSNHRGETIOGARESCAICOLNLYAORTRIISIGNTINMSUBLSNRADSEEUTRTMONSMGINTIGHETBUAOAHATARWKTOPOTSAEOCLMEIETMWOEHMSNRADEEEHTVATNROEYEHLEASEGFROOSLTNOETOGGJANSMAAWIYELBLJWAIRNEHTTAEIIAANGTUEASCBAIHSTEAUHPCSAESNALNSUDOTEAHRTRTIEHKLIBGNEEOIGFNNRFIYAAYTRAOSIIJMFSNEEIRWSETOICWEOGHMMVSEEITPCUIAHEFIORHWTAIMDONAURIPTZEPANFCGIAADLNETSROOLVLAEEFVADENSBEALTGOSRWGEUNOTGISFICHOTPUJBASMALWINNADGOAHNNITTBNAEDWTEAHTRSFOTIOSOPTMVNOEGILPOTORSBEALAWDEAHNTWAMHSHGTAHIEEENBVNNWIOKITENHNRICISDTIAINMRGOTNNCAAOSHLNROERJFREEAELBAYLHITESNTAEHMNHOGOURETHUTUSDSOINCVDOELEFDRENOCFRYAHNWOEODPNSESIILFSHJCNUOENAIGTGEHVRETDTILOBHITENETISPRFNROSSELNUAGIIIMDARIIGHNLDVILEAIDWLIEEILJDLSMABWINRIANOEHTHIWOUENSOEGENRAEONRRCDTAFHIEUWAROBHREETPTNIEASLRIALNFOTRNGNARDAMAAOTEFNOLTUCTIETAIOKNRWEHRAETTTAMHRCDAHEAUEFLRESRSCICBOSASROKRUGCRDOAFNELWROFDSNRUYENHDCEOANRWLAGNLIIEYHDTLEELRLWHITENSEHTHIWHUEASOEONDWDRHGOETENNXDURDOAOTXDETNNTOROODAHTNATTNXDEDOOTTROUABTTHHHSAITNBESEDGLNAOOAOHTTGJVNIEETSAHFMARCRSEREYELCEEBRMMHDTEIENAIFDHHCTOTAIGTTHUTMTEAAOOSLFRETLMTITMNTEOHAWETHAHWSENGYNFIDPOAIMRWTLOOSONGTDURNBAAINLEEHWTLCEEGNEETVDLTLLEOETLJTIOMHWWIVSIEFASEROAYDDNMALASRBEIIYRGFLETNDEHHHWIETUEOSHTABCMEEAAORBEHIGONDUSRNEUIYTGABPTIPLHDDAYLEMRMAOFHOWONCCJMAIMALDUELMTAIMNDADENEEETDSTAIHLTWSHSOILBLEEHUFAEIMCNTEWEFONTHTECGSHHIOOWRLOHHSAIEBRNLIINCSAKANLADSRFAARSWFIOGDAHRSELIDAEHTHMSOEHIEHRFEWOUWMRODNNOAEDELMONONRLPADNEAGOEITRNNBIALNMTCATHEORRMFEEUMRMSMOUMSTORBUAETWALHTHTTESOLOELWPELCHAPIDRGOALNLYAIUNLDCIDDNWAEOASRTHFSFLOTSWRWEOBUDELOEUNXTOESMTOTTMSHEIEPRNAELSFIOTGTEILTNLITSREWRMNORMEIBEMGISJNEOHRTMANFNDAGYNAICMEEBSREACINLDTEAHNEKYSERANHIDAIIVTNRMDITHETPRIAOTSUPBEERISTAHAEIDMASYNHMUHMCEDFPEERHSRDIERGTNOITSAICDNCNETNOLDXEAELNILTIRSAAGYLEOLRGHNTEGISOEONBLEPOXRHIGINRTMUHOSENLSDEILWTYSNAOGLHWTAFRSCROKPONTOEMEIHPCEYPEUODKBDOSJDTNIWDAESUTDASTITHOEAHSTHEOPDPTGONTIGTPRIAOHSTIAERTIDHSYATLRPETLMTIRROIJAGHIHAEWHDHATRSEEPIIIDSNDTRELECWADINYHHNEITGRNDIANSACTITTAHHEAWSBAEOYHBWOHOGTURRHGOETEEISRCTOEIMSOESISMASEDTNEFHTTOEOTPSWONPLDAMAIHJKADERLAOETTDNARWNOHBNMEUYEHDSERORDNEIIHDCETHADANETLSEIDOETSDNTIYACPFEOASLELHSTLIOTNOHASHTTGCAOCDHDREIRUSTEUHNNRUDORONCUGIDTYURNTIGHNRTPSFAEYFYETIERCPSA"""
sampletext = """Gatsby’s house was still empty when I left—the grass on his lawn had grown as long as mine. One of the taxi drivers in the village never took a fare past the entrance gate without stopping for a minute and pointing inside; perhaps it was he who drove Daisy and Gatsby over to East Egg the night of the accident, and perhaps he had made a story about it all his own. I didn’t want to hear it and I avoided him when I got off the train.

I spent my Saturday nights in New York because those gleaming, dazzling parties of his were with me so vividly that I could still hear the music and the laughter, faint and incessant, from his garden, and the cars going up and down his drive. One night I did hear a material car there, and saw its lights stop at his front steps. But I didn’t investigate. Probably it was some final guest who had been away at the ends of the earth and didn’t know that the party was over.

On the last night, with my trunk packed and my car sold to the grocer, I went over and looked at that huge incoherent failure of a house once more. On the white steps an obscene word, scrawled by some boy with a piece of brick, stood out clearly in the moonlight, and I erased it, drawing my shoe raspingly along the stone. Then I wandered down to the beach and sprawled out on the sand.

Most of the big shore places were closed now and there were hardly any lights except the shadowy, moving glow of a ferryboat across the Sound. And as the moon rose higher the inessential houses began to melt away until gradually I became aware of the old island here that flowered once for Dutch sailors’ eyes—a fresh, green breast of the new world. Its vanished trees, the trees that had made way for Gatsby’s house, had once pandered in whispers to the last and greatest of all human dreams; for a transitory enchanted moment man must have held his breath in the presence of this continent, compelled into an aesthetic contemplation he neither understood nor desired, face to face for the last time in history with something commensurate to his capacity for wonder.

And as I sat there brooding on the old, unknown world, I thought of Gatsby’s wonder when he first picked out the green light at the end of Daisy’s dock. He had come a long way to this blue lawn, and his dream must have seemed so close that he could hardly fail to grasp it. He did not know that it was already behind him, somewhere back in that vast obscurity beyond the city, where the dark fields of the republic rolled on under the night.

Gatsby believed in the green light, the orgastic future that year by year recedes before us. It eluded us then, but that’s no matter—tomorrow we will run faster, stretch out our arms further… And one fine morning—

So we beat on, boats against the current, borne back ceaselessly into the past. When in the Course of human events, it becomes necessary for one people to dissolve the political bands which have connected them with another, and to assume among the powers of the earth, the separate and equal station to which the Laws of Nature and of Nature's God entitle them, a decent respect to the opinions of mankind requires that they should declare the causes which impel them to the separation.

We hold these truths to be self-evident, that all men are created equal, that they are endowed by their Creator with certain unalienable Rights, that among these are Life, Liberty and the pursuit of Happiness.--That to secure these rights, Governments are instituted among Men, deriving their just powers from the consent of the governed, --That whenever any Form of Government becomes destructive of these ends, it is the Right of the People to alter or to abolish it, and to institute new Government, laying its foundation on such principles and organizing its powers in such form, as to them shall seem most likely to effect their Safety and Happiness. Prudence, indeed, will dictate that Governments long established should not be changed for light and transient causes; and accordingly all experience hath shewn, that mankind are more disposed to suffer, while evils are sufferable, than to right themselves by abolishing the forms to which they are accustomed. But when a long train of abuses and usurpations, pursuing invariably the same Object evinces a design to reduce them under absolute Despotism, it is their right, it is their duty, to throw off such Government, and to provide new Guards for their future security.--Such has been the patient sufferance of these Colonies; and such is now the necessity which constrains them to alter their former Systems of Government. The history of the present King of Great Britain is a history of repeated injuries and usurpations, all having in direct object the establishment of an absolute Tyranny over these States. To prove this, let Facts be submitted to a candid world.

He has refused his Assent to Laws, the most wholesome and necessary for the public good.

He has forbidden his Governors to pass Laws of immediate and pressing importance, unless suspended in their operation till his Assent should be obtained; and when so suspended, he has utterly neglected to attend to them.

He has refused to pass other Laws for the accommodation of large districts of people, unless those people would relinquish the right of Representation in the Legislature, a right inestimable to them and formidable to tyrants only.

He has called together legislative bodies at places unusual, uncomfortable, and distant from the depository of their public Records, for the sole purpose of fatiguing them into compliance with his measures.

He has dissolved Representative Houses repeatedly, for opposing with manly firmness his invasions on the rights of the people.

He has refused for a long time, after such dissolutions, to cause others to be elected; whereby the Legislative powers, incapable of Annihilation, have returned to the People at large for their exercise; the State remaining in the mean time exposed to all the dangers of invasion from without, and convulsions within.

He has endeavoured to prevent the population of these States; for that purpose obstructing the Laws for Naturalization of Foreigners; refusing to pass others to encourage their migrations hither, and raising the conditions of new Appropriations of Lands.

He has obstructed the Administration of Justice, by refusing his Assent to Laws for establishing Judiciary powers.

He has made Judges dependent on his Will alone, for the tenure of their offices, and the amount and payment of their salaries.

He has erected a multitude of New Offices, and sent hither swarms of Officers to harrass our people, and eat out their substance.

He has kept among us, in times of peace, Standing Armies without the Consent of our legislatures.

He has affected to render the Military independent of and superior to the Civil power.

He has combined with others to subject us to a jurisdiction foreign to our constitution, and unacknowledged by our laws; giving his Assent to their Acts of pretended Legislation:

For Quartering large bodies of armed troops among us:

For protecting them, by a mock Trial, from punishment for any Murders which they should commit on the Inhabitants of these States:

For cutting off our Trade with all parts of the world:

For imposing Taxes on us without our Consent:

For depriving us in many cases, of the benefits of Trial by Jury:

For transporting us beyond Seas to be tried for pretended offences

For abolishing the free System of English Laws in a neighbouring Province, establishing therein an Arbitrary government, and enlarging its Boundaries so as to render it at once an example and fit instrument for introducing the same absolute rule into these Colonies:

For taking away our Charters, abolishing our most valuable Laws, and altering fundamentally the Forms of our Governments:

For suspending our own Legislatures, and declaring themselves invested with power to legislate for us in all cases whatsoever.

He has abdicated Government here, by declaring us out of his Protection and waging War against us.

He has plundered our seas, ravaged our Coasts, burnt our towns, and destroyed the lives of our people.

He is at this time transporting large Armies of foreign Mercenaries to compleat the works of death, desolation and tyranny, already begun with circumstances of Cruelty & perfidy scarcely paralleled in the most barbarous ages, and totally unworthy the Head of a civilized nation.

He has constrained our fellow Citizens taken Captive on the high Seas to bear Arms against their Country, to become the executioners of their friends and Brethren, or to fall themselves by their Hands.

He has excited domestic insurrections amongst us, and has endeavoured to bring on the inhabitants of our frontiers, the merciless Indian Savages, whose known rule of warfare, is an undistinguished destruction of all ages, sexes and conditions.

In every stage of these Oppressions We have Petitioned for Redress in the most humble terms: Our repeated Petitions have been answered only by repeated injury. A Prince whose character is thus marked by every act which may define a Tyrant, is unfit to be the ruler of a free people.

Nor have We been wanting in attentions to our Brittish brethren. We have warned them from time to time of attempts by their legislature to extend an unwarrantable jurisdiction over us. We have reminded them of the circumstances of our emigration and settlement here. We have appealed to their native justice and magnanimity, and we have conjured them by the ties of our common kindred to disavow these usurpations, which, would inevitably interrupt our connections and correspondence. They too have been deaf to the voice of justice and of consanguinity. We must, therefore, acquiesce in the necessity, which denounces our Separation, and hold them, as we hold the rest of mankind, Enemies in War, in Peace Friends.

We, therefore, the Representatives of the united States of America, in General Congress, Assembled, appealing to the Supreme Judge of the world for the rectitude of our intentions, do, in the Name, and by Authority of the good People of these Colonies, solemnly publish and declare, That these United Colonies are, and of Right ought to be Free and Independent States; that they are Absolved from all Allegiance to the British Crown, and that all political connection between them and the State of Great Britain, is and ought to be totally dissolved; and that as Free and Independent States, they have full Power to levy War, conclude Peace, contract Alliances, establish Commerce, and to do all other Acts and Things which Independent States may of right do. And for the support of this Declaration, with a firm reliance on the protection of divine Providence, we mutually pledge to each other our Lives, our Fortunes and our sacred Honor. It was the best of times, it was the worst of times, it was the age of wisdom, it was the age of foolishness, it was the epoch of belief, it was the epoch of incredulity, it was the season of Light, it was the season of Darkness, it was the spring of hope, it was the winter of despair, we had everything before us, we had nothing before us, we were all going direct to Heaven, we were all going direct the other way—in short, the period was so far like the present period, that some of its noisiest authorities insisted on its being received, for good or for evil, in the superlative degree of comparison only.

There were a king with a large jaw and a queen with a plain face, on the throne of England; there were a king with a large jaw and a queen with a fair face, on the throne of France. In both countries it was clearer than crystal to the lords of the State preserves of loaves and fishes, that things in general were settled for ever.

It was the year of Our Lord one thousand seven hundred and seventy-five. Spiritual revelations were conceded to England at that favoured period, as at this. Mrs. Southcott had recently attained her five-and-twentieth blessed birthday, of whom a prophetic private in the Life Guards had heralded the sublime appearance by announcing that arrangements were made for the swallowing up of London and Westminster. Even the Cock-lane ghost had been laid only a round dozen of years, after rapping out its messages, as the spirits of this very year last past (supernaturally deficient in originality) rapped out theirs. Mere messages in the earthly order of events had lately come to the English Crown and People, from a congress of British subjects in America: which, strange to relate, have proved more important to the human race than any communications yet received through any of the chickens of the Cock-lane brood.

France, less favoured on the whole as to matters spiritual than her sister of the shield and trident, rolled with exceeding smoothness down hill, making paper money and spending it. Under the guidance of her Christian pastors, she entertained herself, besides, with such humane achievements as sentencing a youth to have his hands cut off, his tongue torn out with pincers, and his body burned alive, because he had not kneeled down in the rain to do honour to a dirty procession of monks which passed within his view, at a distance of some fifty or sixty yards. It is likely enough that, rooted in the woods of France and Norway, there were growing trees, when that sufferer was put to death, already marked by the Woodman, Fate, to come down and be sawn into boards, to make a certain movable framework with a sack and a knife in it, terrible in history. It is likely enough that in the rough outhouses of some tillers of the heavy lands adjacent to Paris, there were sheltered from the weather that very day, rude carts, bespattered with rustic mire, snuffed about by pigs, and roosted in by poultry, which the Farmer, Death, had already set apart to be his tumbrils of the Revolution. But that Woodman and that Farmer, though they work unceasingly, work silently, and no one heard them as they went about with muffled tread: the rather, forasmuch as to entertain any suspicion that they were awake, was to be atheistical and traitorous.

In England, there was scarcely an amount of order and protection to justify much national boasting. Daring burglaries by armed men, and highway robberies, took place in the capital itself every night; families were publicly cautioned not to go out of town without removing their furniture to upholsterers’ warehouses for security; the highwayman in the dark was a City tradesman in the light, and, being recognised and challenged by his fellow-tradesman whom he stopped in his character of “the Captain,” gallantly shot him through the head and rode away; the mail was waylaid by seven robbers, and the guard shot three dead, and then got shot dead himself by the other four, “in consequence of the failure of his ammunition:” after which the mail was robbed in peace; that magnificent potentate, the Lord Mayor of London, was made to stand and deliver on Turnham Green, by one highwayman, who despoiled the illustrious creature in sight of all his retinue; prisoners in London gaols fought battles with their turnkeys, and the majesty of the law fired blunderbusses in among them, loaded with rounds of shot and ball; thieves snipped off diamond crosses from the necks of noble lords at Court drawing-rooms; musketeers went into St. Giles’s, to search for contraband goods, and the mob fired on the musketeers, and the musketeers fired on the mob, and nobody thought any of these occurrences much out of the common way. In the midst of them, the hangman, ever busy and ever worse than useless, was in constant requisition; now, stringing up long rows of miscellaneous criminals; now, hanging a housebreaker on Saturday who had been taken on Tuesday; now, burning people in the hand at Newgate by the dozen, and now burning pamphlets at the door of Westminster Hall; to-day, taking the life of an atrocious murderer, and to-morrow of a wretched pilferer who had robbed a farmer’s boy of sixpence.

All these things, and a thousand like them, came to pass in and close upon the dear old year one thousand seven hundred and seventy-five. Environed by them, while the Woodman and the Farmer worked unheeded, those two of the large jaws, and those other two of the plain and the fair faces, trod with stir enough, and carried their divine rights with a high hand. Thus did the year one thousand seven hundred and seventy-five conduct their Greatnesses, and myriads of small creatures—the creatures of this chronicle among the rest—along the roads that lay before them. Whereas recognition of the inherent dignity and of the equal and inalienable rights of all members of the human family is the foundation of freedom, justice and peace in the world,

Whereas disregard and contempt for human rights have resulted in barbarous acts which have outraged the conscience of mankind, and the advent of a world in which human beings shall enjoy freedom of speech and belief and freedom from fear and want has been proclaimed as the highest aspiration of the common people,

Whereas it is essential, if man is not to be compelled to have recourse, as a last resort, to rebellion against tyranny and oppression, that human rights should be protected by the rule of law,

Whereas it is essential to promote the development of friendly relations between nations,

Whereas the peoples of the United Nations have in the Charter reaffirmed their faith in fundamental human rights, in the dignity and worth of the human person and in the equal rights of men and women and have determined to promote social progress and better standards of life in larger freedom,

Whereas Member States have pledged themselves to achieve, in co-operation with the United Nations, the promotion of universal respect for and observance of human rights and fundamental freedoms,

Whereas a common understanding of these rights and freedoms is of the greatest importance for the full realization of this pledge,

Now, therefore,

The General Assembly,

Proclaims this Universal Declaration of Human Rights as a common standard of achievement for all peoples and all nations, to the end that every individual and every organ of society, keeping this Declaration constantly in mind, shall strive by teaching and education to promote respect for these rights and freedoms and by progressive measures, national and international, to secure their universal and effective recognition and observance, both among the peoples of Member States themselves and among the peoples of territories under their jurisdiction.  What say of it? what say of CONSCIENCE grim,
That spectre in my path?
                    —Chamberlayne’s Pharronida.

Let me call myself, for the present, William Wilson. The fair page now lying before me need not be sullied with my real appellation. This has been already too much an object for the scorn—for the horror—for the detestation of my race. To the uttermost regions of the globe have not the indignant winds bruited its unparalleled infamy? Oh, outcast of all outcasts most abandoned!—to the earth art thou not forever dead? to its honors, to its flowers, to its golden aspirations?—and a cloud, dense, dismal, and limitless, does it not hang eternally between thy hopes and heaven?

I would not, if I could, here or to-day, embody a record of my later years of unspeakable misery, and unpardonable crime. This epoch—these later years—took unto themselves a sudden elevation in turpitude, whose origin alone it is my present purpose to assign. Men usually grow base by degrees. From me, in an instant, all virtue dropped bodily as a mantle. From comparatively trivial wickedness I passed, with the stride of a giant, into more than the enormities of an Elah-Gabalus. What chance—what one event brought this evil thing to pass, bear with me while I relate. Death approaches; and the shadow which foreruns him has thrown a softening influence over my spirit. I long, in passing through the dim valley, for the sympathy—I had nearly said for the pity—of my fellow men. I would fain have them believe that I have been, in some measure, the slave of circumstances beyond human control. I would wish them to seek out for me, in the details I am about to give, some little oasis of fatality amid a wilderness of error. I would have them allow—what they cannot refrain from allowing—that, although temptation may have erewhile existed as great, man was never thus, at least, tempted before—certainly, never thus fell. And is it therefore that he has never thus suffered? Have I not indeed been living in a dream? And am I not now dying a victim to the horror and the mystery of the wildest of all sublunary visions?

I am the descendant of a race whose imaginative and easily excitable temperament has at all times rendered them remarkable; and, in my earliest infancy, I gave evidence of having fully inherited the family character. As I advanced in years it was more strongly developed; becoming, for many reasons, a cause of serious disquietude to my friends, and of positive injury to myself. I grew self-willed, addicted to the wildest caprices, and a prey to the most ungovernable passions. Weak-minded, and beset with constitutional infirmities akin to my own, my parents could do but little to check the evil propensities which distinguished me. Some feeble and ill-directed efforts resulted in complete failure on their part, and, of course, in total triumph on mine. Thenceforward my voice was a household law; and at an age when few children have abandoned their leading-strings, I was left to the guidance of my own will, and became, in all but name, the master of my own actions.

My earliest recollections of a school-life, are connected with a large, rambling, Elizabethan house, in a misty-looking village of England, where were a vast number of gigantic and gnarled trees, and where all the houses were excessively ancient. In truth, it was a dream-like and spirit-soothing place, that venerable old town. At this moment, in fancy, I feel the refreshing chilliness of its deeply-shadowed avenues, inhale the fragrance of its thousand shrubberies, and thrill anew with undefinable delight, at the deep hollow note of the church-bell, breaking, each hour, with sullen and sudden roar, upon the stillness of the dusky atmosphere in which the fretted Gothic steeple lay imbedded and asleep.

It gives me, perhaps, as much of pleasure as I can now in any manner experience, to dwell upon minute recollections of the school and its concerns. Steeped in misery as I am—misery, alas! only too real—I shall be pardoned for seeking relief, however slight and temporary, in the weakness of a few rambling details. These, moreover, utterly trivial, and even ridiculous in themselves, assume, to my fancy, adventitious importance, as connected with a period and a locality when and where I recognise the first ambiguous monitions of the destiny which afterwards so fully overshadowed me. Let me then remember.

The house, I have said, was old and irregular. The grounds were extensive, and a high and solid brick wall, topped with a bed of mortar and broken glass, encompassed the whole. This prison-like rampart formed the limit of our domain; beyond it we saw but thrice a week—once every Saturday afternoon, when, attended by two ushers, we were permitted to take brief walks in a body through some of the neighbouring fields—and twice during Sunday, when we were paraded in the same formal manner to the morning and evening service in the one church of the village. Of this church the principal of our school was pastor. With how deep a spirit of wonder and perplexity was I wont to regard him from our remote pew in the gallery, as, with step solemn and slow, he ascended the pulpit! This reverend man, with countenance so demurely benign, with robes so glossy and so clerically flowing, with wig so minutely powdered, so rigid and so vast,—-could this be he who, of late, with sour visage, and in snuffy habiliments, administered, ferule in hand, the Draconian laws of the academy? Oh, gigantic paradox, too utterly monstrous for solution!

At an angle of the ponderous wall frowned a more ponderous gate. It was riveted and studded with iron bolts, and surmounted with jagged iron spikes. What impressions of deep awe did it inspire! It was never opened save for the three periodical egressions and ingressions already mentioned; then, in every creak of its mighty hinges, we found a plenitude of mystery—a world of matter for solemn remark, or for more solemn meditation.

The extensive enclosure was irregular in form, having many capacious recesses. Of these, three or four of the largest constituted the play-ground. It was level, and covered with fine hard gravel. I well remember it had no trees, nor benches, nor anything similar within it. Of course it was in the rear of the house. In front lay a small parterre, planted with box and other shrubs, but through this sacred division we passed only upon rare occasions indeed—such as a first advent to school or final departure thence, or perhaps, when a parent or friend having called for us, we joyfully took our way home for the Christmas or Midsummer holidays.

But the house!—how quaint an old building was this!—to me how veritably a palace of enchantment! There was really no end to its windings—to its incomprehensible subdivisions. It was difficult, at any given time, to say with certainty upon which of its two stories one happened to be. From each room to every other there were sure to be found three or four steps either in ascent or descent. Then the lateral branches were innumerable—inconceivable—and so returning in upon themselves, that our most exact ideas in regard to the whole mansion were not very far different from those with which we pondered upon infinity. During the five years of my residence here, I was never able to ascertain with precision, in what remote locality lay the little sleeping apartment assigned to myself and some eighteen or twenty other scholars.

The school-room was the largest in the house—I could not help thinking, in the world. It was very long, narrow, and dismally low, with pointed Gothic windows and a ceiling of oak. In a remote and terror-inspiring angle was a square enclosure of eight or ten feet, comprising the sanctum, “during hours,” of our principal, the Reverend Dr. Bransby. It was a solid structure, with massy door, sooner than open which in the absence of the “Dominie,” we would all have willingly perished by the peine forte et dure. In other angles were two other similar boxes, far less reverenced, indeed, but still greatly matters of awe. One of these was the pulpit of the “classical” usher, one of the “English and mathematical.” Interspersed about the room, crossing and recrossing in endless irregularity, were innumerable benches and desks, black, ancient, and time-worn, piled desperately with much-bethumbed books, and so beseamed with initial letters, names at full length, grotesque figures, and other multiplied efforts of the knife, as to have entirely lost what little of original form might have been their portion in days long departed. A huge bucket with water stood at one extremity of the room, and a clock of stupendous dimensions at the other.

Encompassed by the massy walls of this venerable academy, I passed, yet not in tedium or disgust, the years of the third lustrum of my life. The teeming brain of childhood requires no external world of incident to occupy or amuse it; and the apparently dismal monotony of a school was replete with more intense excitement than my riper youth has derived from luxury, or my full manhood from crime. Yet I must believe that my first mental development had in it much of the uncommon—even much of the outré. Upon mankind at large the events of very early existence rarely leave in mature age any definite impression. All is gray shadow—a weak and irregular remembrance—an indistinct regathering of feeble pleasures and phantasmagoric pains. With me this is not so. In childhood I must have felt with the energy of a man what I now find stamped upon memory in lines as vivid, as deep, and as durable as the exergues of the Carthaginian medals.

Yet in fact—in the fact of the world’s view—how little was there to remember! The morning’s awakening, the nightly summons to bed; the connings, the recitations; the periodical half-holidays, and perambulations; the play-ground, with its broils, its pastimes, its intrigues;—these, by a mental sorcery long forgotten, were made to involve a wilderness of sensation, a world of rich incident, an universe of varied emotion, of excitement the most passionate and spirit-stirring. “Oh, le bon temps, que ce siècle de fer!”

In truth, the ardor, the enthusiasm, and the imperiousness of my disposition, soon rendered me a marked character among my schoolmates, and by slow, but natural gradations, gave me an ascendancy over all not greatly older than myself;—over all with a single exception. This exception was found in the person of a scholar, who, although no relation, bore the same Christian and surname as myself;—a circumstance, in fact, little remarkable; for, notwithstanding a noble descent, mine was one of those everyday appellations which seem, by prescriptive right, to have been, time out of mind, the common property of the mob. In this narrative I have therefore designated myself as William Wilson,—a fictitious title not very dissimilar to the real. My namesake alone, of those who in school phraseology constituted “our set,” presumed to compete with me in the studies of the class—in the sports and broils of the play-ground—to refuse implicit belief in my assertions, and submission to my will—indeed, to interfere with my arbitrary dictation in any respect whatsoever. If there is on earth a supreme and unqualified despotism, it is the despotism of a master-mind in boyhood over the less energetic spirits of its companions.

Wilson’s rebellion was to me a source of the greatest embarrassment; the more so as, in spite of the bravado with which in public I made a point of treating him and his pretensions, I secretly felt that I feared him, and could not help thinking the equality which he maintained so easily with myself, a proof of his true superiority; since not to be overcome cost me a perpetual struggle. Yet this superiority—even this equality—was in truth acknowledged by no one but myself; our associates, by some unaccountable blindness, seemed not even to suspect it. Indeed, his competition, his resistance, and especially his impertinent and dogged interference with my purposes, were not more pointed than private. He appeared to be destitute alike of the ambition which urged, and of the passionate energy of mind which enabled me to excel. In his rivalry he might have been supposed actuated solely by a whimsical desire to thwart, astonish, or mortify myself; although there were times when I could not help observing, with a feeling made up of wonder, abasement, and pique, that he mingled with his injuries, his insults, or his contradictions, a certain most inappropriate, and assuredly most unwelcome affectionateness of manner. I could only conceive this singular behavior to arise from a consummate self-conceit assuming the vulgar airs of patronage and protection.

Perhaps it was this latter trait in Wilson’s conduct, conjoined with our identity of name, and the mere accident of our having entered the school upon the same day, which set afloat the notion that we were brothers, among the senior classes in the academy. These do not usually inquire with much strictness into the affairs of their juniors. I have before said, or should have said, that Wilson was not, in the most remote degree, connected with my family. But assuredly if we had been brothers we must have been twins; for, after leaving Dr. Bransby’s, I casually learned that my namesake was born on the nineteenth of January, 1813—and this is a somewhat remarkable coincidence; for the day is precisely that of my own nativity.

It may seem strange that in spite of the continual anxiety occasioned me by the rivalry of Wilson, and his intolerable spirit of contradiction, I could not bring myself to hate him altogether. We had, to be sure, nearly every day a quarrel in which, yielding me publicly the palm of victory, he, in some manner, contrived to make me feel that it was he who had deserved it; yet a sense of pride on my part, and a veritable dignity on his own, kept us always upon what are called “speaking terms,” while there were many points of strong congeniality in our tempers, operating to awake me in a sentiment which our position alone, perhaps, prevented from ripening into friendship. It is difficult, indeed, to define, or even to describe, my real feelings towards him. They formed a motley and heterogeneous admixture;—some petulant animosity, which was not yet hatred, some esteem, more respect, much fear, with a world of uneasy curiosity. To the moralist it will be unnecessary to say, in addition, that Wilson and myself were the most inseparable of companions.

It was no doubt the anomalous state of affairs existing between us, which turned all my attacks upon him, (and they were many, either open or covert) into the channel of banter or practical joke (giving pain while assuming the aspect of mere fun) rather than into a more serious and determined hostility. But my endeavours on this head were by no means uniformly successful, even when my plans were the most wittily concocted; for my namesake had much about him, in character, of that unassuming and quiet austerity which, while enjoying the poignancy of its own jokes, has no heel of Achilles in itself, and absolutely refuses to be laughed at. I could find, indeed, but one vulnerable point, and that, lying in a personal peculiarity, arising, perhaps, from constitutional disease, would have been spared by any antagonist less at his wit’s end than myself;—my rival had a weakness in the faucal or guttural organs, which precluded him from raising his voice at any time above a very low whisper. Of this defect I did not fail to take what poor advantage lay in my power.

Wilson’s retaliations in kind were many; and there was one form of his practical wit that disturbed me beyond measure. How his sagacity first discovered at all that so petty a thing would vex me, is a question I never could solve; but, having discovered, he habitually practised the annoyance. I had always felt aversion to my uncourtly patronymic, and its very common, if not plebeian praenomen. The words were venom in my ears; and when, upon the day of my arrival, a second William Wilson came also to the academy, I felt angry with him for bearing the name, and doubly disgusted with the name because a stranger bore it, who would be the cause of its twofold repetition, who would be constantly in my presence, and whose concerns, in the ordinary routine of the school business, must inevitably, on account of the detestable coincidence, be often confounded with my own.

The feeling of vexation thus engendered grew stronger with every circumstance tending to show resemblance, moral or physical, between my rival and myself. I had not then discovered the remarkable fact that we were of the same age; but I saw that we were of the same height, and I perceived that we were even singularly alike in general contour of person and outline of feature. I was galled, too, by the rumor touching a relationship, which had grown current in the upper forms. In a word, nothing could more seriously disturb me, (although I scrupulously concealed such disturbance,) than any allusion to a similarity of mind, person, or condition existing between us. But, in truth, I had no reason to believe that (with the exception of the matter of relationship, and in the case of Wilson himself,) this similarity had ever been made a subject of comment, or even observed at all by our schoolfellows. That he observed it in all its bearings, and as fixedly as I, was apparent; but that he could discover in such circumstances so fruitful a field of annoyance, can only be attributed, as I said before, to his more than ordinary penetration.

His cue, which was to perfect an imitation of myself, lay both in words and in actions; and most admirably did he play his part. My dress it was an easy matter to copy; my gait and general manner were, without difficulty, appropriated; in spite of his constitutional defect, even my voice did not escape him. My louder tones were, of course, unattempted, but then the key—it was identical; and his singular whisper, it grew the very echo of my own.

How greatly this most exquisite portraiture harassed me, (for it could not justly be termed a caricature,) I will not now venture to describe. I had but one consolation—in the fact that the imitation, apparently, was noticed by myself alone, and that I had to endure only the knowing and strangely sarcastic smiles of my namesake himself. Satisfied with having produced in my bosom the intended effect, he seemed to chuckle in secret over the sting he had inflicted, and was characteristically disregardful of the public applause which the success of his witty endeavours might have so easily elicited. That the school, indeed, did not feel his design, perceive its accomplishment, and participate in his sneer, was, for many anxious months, a riddle I could not resolve. Perhaps the gradation of his copy rendered it not so readily perceptible; or, more possibly, I owed my security to the master air of the copyist, who, disdaining the letter, (which in a painting is all the obtuse can see,) gave but the full spirit of his original for my individual contemplation and chagrin.

I have already more than once spoken of the disgusting air of patronage which he assumed toward me, and of his frequent officious interference with my will. This interference often took the ungracious character of advice; advice not openly given, but hinted or insinuated. I received it with a repugnance which gained strength as I grew in years. Yet, at this distant day, let me do him the simple justice to acknowledge that I can recall no occasion when the suggestions of my rival were on the side of those errors or follies so usual to his immature age and seeming inexperience; that his moral sense, at least, if not his general talents and worldly wisdom, was far keener than my own; and that I might, to-day, have been a better, and thus a happier man, had I less frequently rejected the counsels embodied in those meaning whispers which I then but too cordially hated and too bitterly despised.

As it was, I at length grew restive in the extreme under his distasteful supervision, and daily resented more and more openly what I considered his intolerable arrogance. I have said that, in the first years of our connexion as schoolmates, my feelings in regard to him might have been easily ripened into friendship; but, in the latter months of my residence at the academy, although the intrusion of his ordinary manner had, beyond doubt, in some measure, abated, my sentiments, in nearly similar proportion, partook very much of positive hatred. Upon one occasion he saw this, I think, and afterwards avoided, or made a show of avoiding me.

It was about the same period, if I remember aright, that, in an altercation of violence with him, in which he was more than usually thrown off his guard, and spoke and acted with an openness of demeanor rather foreign to his nature, I discovered, or fancied I discovered, in his accent, his air, and general appearance, a something which first startled, and then deeply interested me, by bringing to mind dim visions of my earliest infancy—wild, confused and thronging memories of a time when memory herself was yet unborn. I cannot better describe the sensation which oppressed me than by saying that I could with difficulty shake off the belief of my having been acquainted with the being who stood before me, at some epoch very long ago—some point of the past even infinitely remote. The delusion, however, faded rapidly as it came; and I mention it at all but to define the day of the last conversation I there held with my singular namesake.

The huge old house, with its countless subdivisions, had several large chambers communicating with each other, where slept the greater number of the students. There were, however, (as must necessarily happen in a building so awkwardly planned,) many little nooks or recesses, the odds and ends of the structure; and these the economic ingenuity of Dr. Bransby had also fitted up as dormitories; although, being the merest closets, they were capable of accommodating but a single individual. One of these small apartments was occupied by Wilson.

One night, about the close of my fifth year at the school, and immediately after the altercation just mentioned, finding every one wrapped in sleep, I arose from bed, and, lamp in hand, stole through a wilderness of narrow passages from my own bedroom to that of my rival. I had long been plotting one of those ill-natured pieces of practical wit at his expense in which I had hitherto been so uniformly unsuccessful. It was my intention, now, to put my scheme in operation, and I resolved to make him feel the whole extent of the malice with which I was imbued. Having reached his closet, I noiselessly entered, leaving the lamp, with a shade over it, on the outside. I advanced a step, and listened to the sound of his tranquil breathing. Assured of his being asleep, I returned, took the light, and with it again approached the bed. Close curtains were around it, which, in the prosecution of my plan, I slowly and quietly withdrew, when the bright rays fell vividly upon the sleeper, and my eyes, at the same moment, upon his countenance. I looked;—and a numbness, an iciness of feeling instantly pervaded my frame. My breast heaved, my knees tottered, my whole spirit became possessed with an objectless yet intolerable horror. Gasping for breath, I lowered the lamp in still nearer proximity to the face. Were these—these the lineaments of William Wilson? I saw, indeed, that they were his, but I shook as if with a fit of the ague in fancying they were not. What was there about them to confound me in this manner? I gazed;—while my brain reeled with a multitude of incoherent thoughts. Not thus he appeared—assuredly not thus—in the vivacity of his waking hours. The same name! the same contour of person! the same day of arrival at the academy! And then his dogged and meaningless imitation of my gait, my voice, my habits, and my manner! Was it, in truth, within the bounds of human possibility, that what I now saw was the result, merely, of the habitual practice of this sarcastic imitation? Awe-stricken, and with a creeping shudder, I extinguished the lamp, passed silently from the chamber, and left, at once, the halls of that old academy, never to enter them again.

After a lapse of some months, spent at home in mere idleness, I found myself a student at Eton. The brief interval had been sufficient to enfeeble my remembrance of the events at Dr. Bransby’s, or at least to effect a material change in the nature of the feelings with which I remembered them. The truth—the tragedy—of the drama was no more. I could now find room to doubt the evidence of my senses; and seldom called up the subject at all but with wonder at extent of human credulity, and a smile at the vivid force of the imagination which I hereditarily possessed. Neither was this species of scepticism likely to be diminished by the character of the life I led at Eton. The vortex of thoughtless folly into which I there so immediately and so recklessly plunged, washed away all but the froth of my past hours, engulfed at once every solid or serious impression, and left to memory only the veriest levities of a former existence.

I do not wish, however, to trace the course of my miserable profligacy here—a profligacy which set at defiance the laws, while it eluded the vigilance of the institution. Three years of folly, passed without profit, had but given me rooted habits of vice, and added, in a somewhat unusual degree, to my bodily stature, when, after a week of soulless dissipation, I invited a small party of the most dissolute students to a secret carousal in my chambers. We met at a late hour of the night; for our debaucheries were to be faithfully protracted until morning. The wine flowed freely, and there were not wanting other and perhaps more dangerous seductions; so that the gray dawn had already faintly appeared in the east, while our delirious extravagance was at its height. Madly flushed with cards and intoxication, I was in the act of insisting upon a toast of more than wonted profanity, when my attention was suddenly diverted by the violent, although partial unclosing of the door of the apartment, and by the eager voice of a servant from without. He said that some person, apparently in great haste, demanded to speak with me in the hall.

Wildly excited with wine, the unexpected interruption rather delighted than surprised me. I staggered forward at once, and a few steps brought me to the vestibule of the building. In this low and small room there hung no lamp; and now no light at all was admitted, save that of the exceedingly feeble dawn which made its way through the semi-circular window. As I put my foot over the threshold, I became aware of the figure of a youth about my own height, and habited in a white kerseymere morning frock, cut in the novel fashion of the one I myself wore at the moment. This the faint light enabled me to perceive; but the features of his face I could not distinguish. Upon my entering he strode hurriedly up to me, and, seizing me by the arm with a gesture of petulant impatience, whispered the words “William Wilson!” in my ear.

I grew perfectly sober in an instant.

There was that in the manner of the stranger, and in the tremulous shake of his uplifted finger, as he held it between my eyes and the light, which filled me with unqualified amazement; but it was not this which had so violently moved me. It was the pregnancy of solemn admonition in the singular, low, hissing utterance; and, above all, it was the character, the tone, the key, of those few, simple, and familiar, yet whispered syllables, which came with a thousand thronging memories of bygone days, and struck upon my soul with the shock of a galvanic battery. Ere I could recover the use of my senses he was gone.

Although this event failed not of a vivid effect upon my disordered imagination, yet was it evanescent as vivid. For some weeks, indeed, I busied myself in earnest inquiry, or was wrapped in a cloud of morbid speculation. I did not pretend to disguise from my perception the identity of the singular individual who thus perseveringly interfered with my affairs, and harassed me with his insinuated counsel. But who and what was this Wilson?—and whence came he?—and what were his purposes? Upon neither of these points could I be satisfied; merely ascertaining, in regard to him, that a sudden accident in his family had caused his removal from Dr. Bransby’s academy on the afternoon of the day in which I myself had eloped. But in a brief period I ceased to think upon the subject; my attention being all absorbed in a contemplated departure for Oxford. Thither I soon went; the uncalculating vanity of my parents furnishing me with an outfit and annual establishment, which would enable me to indulge at will in the luxury already so dear to my heart,—to vie in profuseness of expenditure with the haughtiest heirs of the wealthiest earldoms in Great Britain.

Excited by such appliances to vice, my constitutional temperament broke forth with redoubled ardor, and I spurned even the common restraints of decency in the mad infatuation of my revels. But it were absurd to pause in the detail of my extravagance. Let it suffice, that among spendthrifts I out-Heroded Herod, and that, giving name to a multitude of novel follies, I added no brief appendix to the long catalogue of vices then usual in the most dissolute university of Europe.

It could hardly be credited, however, that I had, even here, so utterly fallen from the gentlemanly estate, as to seek acquaintance with the vilest arts of the gambler by profession, and, having become an adept in his despicable science, to practise it habitually as a means of increasing my already enormous income at the expense of the weak-minded among my fellow-collegians. Such, nevertheless, was the fact. And the very enormity of this offence against all manly and honourable sentiment proved, beyond doubt, the main if not the sole reason of the impunity with which it was committed. Who, indeed, among my most abandoned associates, would not rather have disputed the clearest evidence of his senses, than have suspected of such courses, the gay, the frank, the generous William Wilson—the noblest and most liberal commoner at Oxford—him whose follies (said his parasites) were but the follies of youth and unbridled fancy—whose errors but inimitable whim—whose darkest vice but a careless and dashing extravagance?

I had been now two years successfully busied in this way, when there came to the university a young parvenu nobleman, Glendinning—rich, said report, as Herodes Atticus—his riches, too, as easily acquired. I soon found him of weak intellect, and, of course, marked him as a fitting subject for my skill. I frequently engaged him in play, and contrived, with the gambler’s usual art, to let him win considerable sums, the more effectually to entangle him in my snares. At length, my schemes being ripe, I met him (with the full intention that this meeting should be final and decisive) at the chambers of a fellow-commoner, (Mr. Preston,) equally intimate with both, but who, to do him justice, entertained not even a remote suspicion of my design. To give to this a better coloring, I had contrived to have assembled a party of some eight or ten, and was solicitously careful that the introduction of cards should appear accidental, and originate in the proposal of my contemplated dupe himself. To be brief upon a vile topic, none of the low finesse was omitted, so customary upon similar occasions that it is a just matter for wonder how any are still found so besotted as to fall its victim.

We had protracted our sitting far into the night, and I had at length effected the manoeuvre of getting Glendinning as my sole antagonist. The game, too, was my favorite écarté! The rest of the company, interested in the extent of our play, had abandoned their own cards, and were standing around us as spectators. The parvenu, who had been induced by my artifices in the early part of the evening, to drink deeply, now shuffled, dealt, or played, with a wild nervousness of manner for which his intoxication, I thought, might partially, but could not altogether account. In a very short period he had become my debtor to a large amount, when, having taken a long draught of port, he did precisely what I had been coolly anticipating—he proposed to double our already extravagant stakes. With a well-feigned show of reluctance, and not until after my repeated refusal had seduced him into some angry words which gave a color of pique to my compliance, did I finally comply. The result, of course, did but prove how entirely the prey was in my toils: in less than an hour he had quadrupled his debt. For some time his countenance had been losing the florid tinge lent it by the wine; but now, to my astonishment, I perceived that it had grown to a pallor truly fearful. I say to my astonishment. Glendinning had been represented to my eager inquiries as immeasurably wealthy; and the sums which he had as yet lost, although in themselves vast, could not, I supposed, very seriously annoy, much less so violently affect him. That he was overcome by the wine just swallowed, was the idea which most readily presented itself; and, rather with a view to the preservation of my own character in the eyes of my associates, than from any less interested motive, I was about to insist, peremptorily, upon a discontinuance of the play, when some expressions at my elbow from among the company, and an ejaculation evincing utter despair on the part of Glendinning, gave me to understand that I had effected his total ruin under circumstances which, rendering him an object for the pity of all, should have protected him from the ill offices even of a fiend.

What now might have been my conduct it is difficult to say. The pitiable condition of my dupe had thrown an air of embarrassed gloom over all; and, for some moments, a profound silence was maintained, during which I could not help feeling my cheeks tingle with the many burning glances of scorn or reproach cast upon me by the less abandoned of the party. I will even own that an intolerable weight of anxiety was for a brief instant lifted from my bosom by the sudden and extraordinary interruption which ensued. The wide, heavy folding doors of the apartment were all at once thrown open, to their full extent, with a vigorous and rushing impetuosity that extinguished, as if by magic, every candle in the room. Their light, in dying, enabled us just to perceive that a stranger had entered, about my own height, and closely muffled in a cloak. The darkness, however, was now total; and we could only feel that he was standing in our midst. Before any one of us could recover from the extreme astonishment into which this rudeness had thrown all, we heard the voice of the intruder.

“Gentlemen,” he said, in a low, distinct, and never-to-be-forgotten whisper which thrilled to the very marrow of my bones, “Gentlemen, I make no apology for this behaviour, because in thus behaving, I am but fulfilling a duty. You are, beyond doubt, uninformed of the true character of the person who has to-night won at écarté a large sum of money from Lord Glendinning. I will therefore put you upon an expeditious and decisive plan of obtaining this very necessary information. Please to examine, at your leisure, the inner linings of the cuff of his left sleeve, and the several little packages which may be found in the somewhat capacious pockets of his embroidered morning wrapper.”

While he spoke, so profound was the stillness that one might have heard a pin drop upon the floor. In ceasing, he departed at once, and as abruptly as he had entered. Can I—shall I describe my sensations? Must I say that I felt all the horrors of the damned? Most assuredly I had little time given for reflection. Many hands roughly seized me upon the spot, and lights were immediately reprocured. A search ensued. In the lining of my sleeve were found all the court cards essential in écarté, and, in the pockets of my wrapper, a number of packs, facsimiles of those used at our sittings, with the single exception that mine were of the species called, technically, arrondees; the honours being slightly convex at the ends, the lower cards slightly convex at the sides. In this disposition, the dupe who cuts, as customary, at the length of the pack, will invariably find that he cuts his antagonist an honor; while the gambler, cutting at the breadth, will, as certainly, cut nothing for his victim which may count in the records of the game.

Any burst of indignation upon this discovery would have affected me less than the silent contempt, or the sarcastic composure, with which it was received.

“Mr. Wilson,” said our host, stooping to remove from beneath his feet an exceedingly luxurious cloak of rare furs, “Mr. Wilson, this is your property.” (The weather was cold; and, upon quitting my own room, I had thrown a cloak over my dressing wrapper, putting it off upon reaching the scene of play.) “I presume it is supererogatory to seek here (eyeing the folds of the garment with a bitter smile) for any farther evidence of your skill. Indeed, we have had enough. You will see the necessity, I hope, of quitting Oxford—at all events, of quitting instantly my chambers.”

Abased, humbled to the dust as I then was, it is probable that I should have resented this galling language by immediate personal violence, had not my whole attention been at the moment arrested by a fact of the most startling character. The cloak which I had worn was of a rare description of fur; how rare, how extravagantly costly, I shall not venture to say. Its fashion, too, was of my own fantastic invention; for I was fastidious to an absurd degree of coxcombry, in matters of this frivolous nature. When, therefore, Mr. Preston reached me that which he had picked up upon the floor, and near the folding doors of the apartment, it was with an astonishment nearly bordering upon terror, that I perceived my own already hanging on my arm, (where I had no doubt unwittingly placed it,) and that the one presented me was but its exact counterpart in every, in even the minutest possible particular. The singular being who had so disastrously exposed me, had been muffled, I remembered, in a cloak; and none had been worn at all by any of the members of our party with the exception of myself. Retaining some presence of mind, I took the one offered me by Preston; placed it, unnoticed, over my own; left the apartment with a resolute scowl of defiance; and, next morning ere dawn of day, commenced a hurried journey from Oxford to the continent, in a perfect agony of horror and of shame.

I fled in vain. My evil destiny pursued me as if in exultation, and proved, indeed, that the exercise of its mysterious dominion had as yet only begun. Scarcely had I set foot in Paris ere I had fresh evidence of the detestable interest taken by this Wilson in my concerns. Years flew, while I experienced no relief. Villain!—at Rome, with how untimely, yet with how spectral an officiousness, stepped he in between me and my ambition! At Vienna, too—at Berlin—and at Moscow! Where, in truth, had I not bitter cause to curse him within my heart? From his inscrutable tyranny did I at length flee, panic-stricken, as from a pestilence; and to the very ends of the earth I fled in vain.

And again, and again, in secret communion with my own spirit, would I demand the questions “Who is he?—whence came he?—and what are his objects?” But no answer was there found. And then I scrutinized, with a minute scrutiny, the forms, and the methods, and the leading traits of his impertinent supervision. But even here there was very little upon which to base a conjecture. It was noticeable, indeed, that, in no one of the multiplied instances in which he had of late crossed my path, had he so crossed it except to frustrate those schemes, or to disturb those actions, which, if fully carried out, might have resulted in bitter mischief. Poor justification this, in truth, for an authority so imperiously assumed! Poor indemnity for natural rights of self-agency so pertinaciously, so insultingly denied!

I had also been forced to notice that my tormentor, for a very long period of time, (while scrupulously and with miraculous dexterity maintaining his whim of an identity of apparel with myself,) had so contrived it, in the execution of his varied interference with my will, that I saw not, at any moment, the features of his face. Be Wilson what he might, this, at least, was but the veriest of affectation, or of folly. Could he, for an instant, have supposed that, in my admonisher at Eton—in the destroyer of my honor at Oxford,—in him who thwarted my ambition at Rome, my revenge at Paris, my passionate love at Naples, or what he falsely termed my avarice in Egypt,—that in this, my arch-enemy and evil genius, could fail to recognise the William Wilson of my school boy days,—the namesake, the companion, the rival,—the hated and dreaded rival at Dr. Bransby’s? Impossible!—But let me hasten to the last eventful scene of the drama.

Thus far I had succumbed supinely to this imperious domination. The sentiment of deep awe with which I habitually regarded the elevated character, the majestic wisdom, the apparent omnipresence and omnipotence of Wilson, added to a feeling of even terror, with which certain other traits in his nature and assumptions inspired me, had operated, hitherto, to impress me with an idea of my own utter weakness and helplessness, and to suggest an implicit, although bitterly reluctant submission to his arbitrary will. But, of late days, I had given myself up entirely to wine; and its maddening influence upon my hereditary temper rendered me more and more impatient of control. I began to murmur,—to hesitate,—to resist. And was it only fancy which induced me to believe that, with the increase of my own firmness, that of my tormentor underwent a proportional diminution? Be this as it may, I now began to feel the inspiration of a burning hope, and at length nurtured in my secret thoughts a stern and desperate resolution that I would submit no longer to be enslaved.

It was at Rome, during the Carnival of 18—, that I attended a masquerade in the palazzo of the Neapolitan Duke Di Broglio. I had indulged more freely than usual in the excesses of the wine-table; and now the suffocating atmosphere of the crowded rooms irritated me beyond endurance. The difficulty, too, of forcing my way through the mazes of the company contributed not a little to the ruffling of my temper; for I was anxiously seeking, (let me not say with what unworthy motive) the young, the gay, the beautiful wife of the aged and doting Di Broglio. With a too unscrupulous confidence she had previously communicated to me the secret of the costume in which she would be habited, and now, having caught a glimpse of her person, I was hurrying to make my way into her presence. At this moment I felt a light hand placed upon my shoulder, and that ever-remembered, low, damnable whisper within my ear.

In an absolute phrenzy of wrath, I turned at once upon him who had thus interrupted me, and seized him violently by the collar. He was attired, as I had expected, in a costume altogether similar to my own; wearing a Spanish cloak of blue velvet, begirt about the waist with a crimson belt sustaining a rapier. A mask of black silk entirely covered his face.

“Scoundrel!” I said, in a voice husky with rage, while every syllable I uttered seemed as new fuel to my fury, “scoundrel! impostor! accursed villain! you shall not—you shall not dog me unto death! Follow me, or I stab you where you stand!”—and I broke my way from the ball-room into a small ante-chamber adjoining, dragging him unresistingly with me as I went.

Upon entering, I thrust him furiously from me. He staggered against the wall, while I closed the door with an oath, and commanded him to draw. He hesitated but for an instant; then, with a slight sigh, drew in silence, and put himself upon his defence.

The contest was brief indeed. I was frantic with every species of wild excitement, and felt within my single arm the energy and power of a multitude. In a few seconds I forced him by sheer strength against the wainscoting, and thus, getting him at mercy, plunged my sword, with brute ferocity, repeatedly through and through his bosom.

At that instant some person tried the latch of the door. I hastened to prevent an intrusion, and then immediately returned to my dying antagonist. But what human language can adequately portray that astonishment, that horror which possessed me at the spectacle then presented to view? The brief moment in which I averted my eyes had been sufficient to produce, apparently, a material change in the arrangements at the upper or farther end of the room. A large mirror,—so at first it seemed to me in my confusion—now stood where none had been perceptible before; and, as I stepped up to it in extremity of terror, mine own image, but with features all pale and dabbled in blood, advanced to meet me with a feeble and tottering gait.

Thus it appeared, I say, but was not. It was my antagonist—it was Wilson, who then stood before me in the agonies of his dissolution. His mask and cloak lay, where he had thrown them, upon the floor. Not a thread in all his raiment—not a line in all the marked and singular lineaments of his face which was not, even in the most absolute identity, mine own!

It was Wilson; but he spoke no longer in a whisper, and I could have fancied that I myself was speaking while he said:

“You have conquered, and I yield. Yet, henceforward art thou also dead—dead to the World, to Heaven and to Hope! In me didst thou exist—and, in my death, see by this image, which is thine own, how utterly thou hast murdered thyself.” True!—nervous—very, very dreadfully nervous I had been and am; but why will you say that I am mad? The disease had sharpened my senses—not destroyed—not dulled them. Above all was the sense of hearing acute. I heard all things in the heaven and in the earth. I heard many things in hell. How, then, am I mad? Hearken! and observe how healthily—how calmly I can tell you the whole story.

It is impossible to say how first the idea entered my brain; but once conceived, it haunted me day and night. Object there was none. Passion there was none. I loved the old man. He had never wronged me. He had never given me insult. For his gold I had no desire. I think it was his eye! yes, it was this! He had the eye of a vulture—a pale blue eye, with a film over it. Whenever it fell upon me, my blood ran cold; and so by degrees—very gradually—I made up my mind to take the life of the old man, and thus rid myself of the eye forever.

Now this is the point. You fancy me mad. Madmen know nothing. But you should have seen me. You should have seen how wisely I proceeded—with what caution—with what foresight—with what dissimulation I went to work! I was never kinder to the old man than during the whole week before I killed him. And every night, about midnight, I turned the latch of his door and opened it—oh, so gently! And then, when I had made an opening sufficient for my head, I put in a dark lantern, all closed, closed, that no light shone out, and then I thrust in my head. Oh, you would have laughed to see how cunningly I thrust it in! I moved it slowly—very, very slowly, so that I might not disturb the old man’s sleep. It took me an hour to place my whole head within the opening so far that I could see him as he lay upon his bed. Ha!—would a madman have been so wise as this? And then, when my head was well in the room, I undid the lantern cautiously—oh, so cautiously—cautiously (for the hinges creaked)—I undid it just so much that a single thin ray fell upon the vulture eye. And this I did for seven long nights—every night just at midnight—but I found the eye always closed; and so it was impossible to do the work; for it was not the old man who vexed me, but his Evil Eye. And every morning, when the day broke, I went boldly into the chamber, and spoke courageously to him, calling him by name in a hearty tone, and inquiring how he has passed the night. So you see he would have been a very profound old man, indeed, to suspect that every night, just at twelve, I looked in upon him while he slept.

Upon the eighth night I was more than usually cautious in opening the door. A watch’s minute hand moves more quickly than did mine. Never before that night had I felt the extent of my own powers—of my sagacity. I could scarcely contain my feelings of triumph. To think that there I was, opening the door, little by little, and he not even to dream of my secret deeds or thoughts. I fairly chuckled at the idea; and perhaps he heard me; for he moved on the bed suddenly, as if startled. Now you may think that I drew back—but no. His room was as black as pitch with the thick darkness, (for the shutters were close fastened, through fear of robbers,) and so I knew that he could not see the opening of the door, and I kept pushing it on steadily, steadily.

I had my head in, and was about to open the lantern, when my thumb slipped upon the tin fastening, and the old man sprang up in bed, crying out—“Who’s there?”

I kept quite still and said nothing. For a whole hour I did not move a muscle, and in the meantime I did not hear him lie down. He was still sitting up in the bed listening;—just as I have done, night after night, hearkening to the death watches in the wall.

Presently I heard a slight groan, and I knew it was the groan of mortal terror. It was not a groan of pain or of grief—oh, no!—it was the low stifled sound that arises from the bottom of the soul when overcharged with awe. I knew the sound well. Many a night, just at midnight, when all the world slept, it has welled up from my own bosom, deepening, with its dreadful echo, the terrors that distracted me. I say I knew it well. I knew what the old man felt, and pitied him, although I chuckled at heart. I knew that he had been lying awake ever since the first slight noise, when he had turned in the bed. His fears had been ever since growing upon him. He had been trying to fancy them causeless, but could not. He had been saying to himself—“It is nothing but the wind in the chimney—it is only a mouse crossing the floor,” or “It is merely a cricket which has made a single chirp.” Yes, he had been trying to comfort himself with these suppositions: but he had found all in vain. All in vain; because Death, in approaching him had stalked with his black shadow before him, and enveloped the victim. And it was the mournful influence of the unperceived shadow that caused him to feel—although he neither saw nor heard—to feel the presence of my head within the room.

When I had waited a long time, very patiently, without hearing him lie down, I resolved to open a little—a very, very little crevice in the lantern. So I opened it—you cannot imagine how stealthily, stealthily—until, at length a simple dim ray, like the thread of the spider, shot from out the crevice and fell full upon the vulture eye.

It was open—wide, wide open—and I grew furious as I gazed upon it. I saw it with perfect distinctness—all a dull blue, with a hideous veil over it that chilled the very marrow in my bones; but I could see nothing else of the old man’s face or person: for I had directed the ray as if by instinct, precisely upon the damned spot.

And have I not told you that what you mistake for madness is but over-acuteness of the sense?—now, I say, there came to my ears a low, dull, quick sound, such as a watch makes when enveloped in cotton. I knew that sound well, too. It was the beating of the old man’s heart. It increased my fury, as the beating of a drum stimulates the soldier into courage.

But even yet I refrained and kept still. I scarcely breathed. I held the lantern motionless. I tried how steadily I could maintain the ray upon the eve. Meantime the hellish tattoo of the heart increased. It grew quicker and quicker, and louder and louder every instant. The old man’s terror must have been extreme! It grew louder, I say, louder every moment!—do you mark me well? I have told you that I am nervous: so I am. And now at the dead hour of the night, amid the dreadful silence of that old house, so strange a noise as this excited me to uncontrollable terror. Yet, for some minutes longer I refrained and stood still. But the beating grew louder, louder! I thought the heart must burst. And now a new anxiety seized me—the sound would be heard by a neighbour! The old man’s hour had come! With a loud yell, I threw open the lantern and leaped into the room. He shrieked once—once only. In an instant I dragged him to the floor, and pulled the heavy bed over him. I then smiled gaily, to find the deed so far done. But, for many minutes, the heart beat on with a muffled sound. This, however, did not vex me; it would not be heard through the wall. At length it ceased. The old man was dead. I removed the bed and examined the corpse. Yes, he was stone, stone dead. I placed my hand upon the heart and held it there many minutes. There was no pulsation. He was stone dead. His eye would trouble me no more.

If still you think me mad, you will think so no longer when I describe the wise precautions I took for the concealment of the body. The night waned, and I worked hastily, but in silence. First of all I dismembered the corpse. I cut off the head and the arms and the legs.

I then took up three planks from the flooring of the chamber, and deposited all between the scantlings. I then replaced the boards so cleverly, so cunningly, that no human eye—not even his—could have detected any thing wrong. There was nothing to wash out—no stain of any kind—no blood-spot whatever. I had been too wary for that. A tub had caught all—ha! ha!

When I had made an end of these labors, it was four o’clock—still dark as midnight. As the bell sounded the hour, there came a knocking at the street door. I went down to open it with a light heart,—for what had I now to fear? There entered three men, who introduced themselves, with perfect suavity, as officers of the police. A shriek had been heard by a neighbour during the night; suspicion of foul play had been aroused; information had been lodged at the police office, and they (the officers) had been deputed to search the premises.

I smiled,—for what had I to fear? I bade the gentlemen welcome. The shriek, I said, was my own in a dream. The old man, I mentioned, was absent in the country. I took my visitors all over the house. I bade them search—search well. I led them, at length, to his chamber. I showed them his treasures, secure, undisturbed. In the enthusiasm of my confidence, I brought chairs into the room, and desired them here to rest from their fatigues, while I myself, in the wild audacity of my perfect triumph, placed my own seat upon the very spot beneath which reposed the corpse of the victim.

The officers were satisfied. My manner had convinced them. I was singularly at ease. They sat, and while I answered cheerily, they chatted of familiar things. But, ere long, I felt myself getting pale and wished them gone. My head ached, and I fancied a ringing in my ears: but still they sat and still chatted. The ringing became more distinct:—it continued and became more distinct: I talked more freely to get rid of the feeling: but it continued and gained definiteness—until, at length, I found that the noise was not within my ears.

No doubt I now grew very pale;—but I talked more fluently, and with a heightened voice. Yet the sound increased—and what could I do? It was a low, dull, quick sound—much such a sound as a watch makes when enveloped in cotton. I gasped for breath—and yet the officers heard it not. I talked more quickly—more vehemently; but the noise steadily increased. I arose and argued about trifles, in a high key and with violent gesticulations; but the noise steadily increased. Why would they not be gone? I paced the floor to and fro with heavy strides, as if excited to fury by the observations of the men—but the noise steadily increased. Oh God! what could I do? I foamed—I raved—I swore! I swung the chair upon which I had been sitting, and grated it upon the boards, but the noise arose over all and continually increased. It grew louder—louder—louder! And still the men chatted pleasantly, and smiled. Was it possible they heard not? Almighty God!—no, no! They heard!—they suspected!—they knew!—they were making a mockery of my horror!—this I thought, and this I think. But anything was better than this agony! Anything was more tolerable than this derision! I could bear those hypocritical smiles no longer! I felt that I must scream or die! and now—again!—hark! louder! louder! louder! louder!

“Villains!” I shrieked, “dissemble no more! I admit the deed!—tear up the planks!—here, here!—It is the beating of his hideous heart!”"""
    
# Remove all non alphabetic characters and capitalize
def encode(text: str):
    stripped = sub(r"[^a-zA-Z]", "", text)
    return stripped.upper()

# Apply inverse of given permutation sigma to the string
def apply_inv_permutation(text: str, sigma: list):
    permuted = []
    for x in range(0, len(text), len(sigma)):
        permuted += [text[x + sigma[i]] for i in range(len(sigma))]
    return "".join(permuted)

# Compute the G test statistic: 
# * Both arguments are dicts with values being counts
# * Keys are used to match corresponding counts
# * Sum of the expected and observed counts need not match
def calculate_G(observed, expected):
    observed_total = sum(observed.values())
    expected_total = sum(expected.values())

    lnsum = 0
    for x, o in observed.items():
        e = expected.get(x, 0) * observed_total / expected_total
        if e == 0:
            e = epsilon
        lnsum += o * ln(1.0 * o / e)
    return 2 * lnsum
    
# Evaluate G^{(i,j)} as defined in the text above
def evaluate_G(i, j, period, text, expected):
    if i == j:
        return Infinity
    
    column = ["".join([text[x], text[y]]) for x, y in zip(range(i, len(text), period), range(j, len(text), period))]
    observed = Counter(column)
    return calculate_G(observed, expected)
    
# Prints an output div aligning with the interact controls   
def output_div(label: str, content: str):
    s = '<div class="sagecell_interactControlCell" style="width: 100%;">'
    s += f'<label class="sagecell_interactControlLabel">{label}</label>'
    s += f'<div class="sagecell_interactControl">{content}</div>'
    s += '</div>'
    pretty_print(html(s))

@interact
def _(cipher=input_box(default=ciphertext, label="Cipher", height=5, width=70), 
      sample=input_box(default=sampletext, label="Sample", height=5, width=70),
      period=slider(1, 26, 1, 4, label="Period"),
      sigma=input_box(default="[1,2,3,4]", label="Sigma", height=1, width=62)):
    # Input validation
    if not cipher.isalpha() or not cipher.isupper():
        raise Exception("Ciphertext must consist only of uppercase characters")
    if len(cipher) % period != 0:
        raise Exception(f"Period guess {period} is not a divisor of the ciphertext length {len(cipher)}")
        
    sample = encode(sample)
    sample_bigrams = [sample[i:i+2] for i in range(len(sample)-1)]
    sample_counts = Counter(sample_bigrams)
    
    s = "<pre>"
    for i in range(period):
        for j in range(period):
            g = evaluate_G(i, j, period, cipher, sample_counts)
            if g == Infinity:
                s += f"{'+Inf':>10} "
            else:
                s += f"{g:>10.1f} "
        s += "\n"
    s += "</pre>"
    output_div("G-Box", s)
    
    # Zero-index the permutation sigma
    sigma = [x-1 for x in sigma]
    
    if len(set(sigma)) != period or len([x for x in sigma if x < 0 or x >= period]) > 0:
        s = f"Cannot decrypt: Sigma must be a permutation of [1,...,{period}]"
        output_div("Output", s)
    else:
        output = apply_inv_permutation(cipher, sigma)
        s = '<div style="inline-size: 45em; overflow-wrap: break-word;">'
        s += output
        s += "</div>"
        output_div("Output", s)
        
        output_bigrams = [output[i:i+2] for i in range(len(output)-1)]
        missed = set([x for x in output_bigrams if x not in sample_bigrams])
        s = "<div>If the above output is correct, it contains the following bigrams which "
        s += "are not present in the sample text: \n"
        s += ", ".join(missed)
        s += "</div>"
        output_div("Remark", s)
        
</script>
</div>
</div>
<div class="element">
<span class="label">Exercise</span> The following ciphertext was
encrypted using rectangular transposition. Find the corresponding
plaintext.
<textarea readonly rows=10 style="width: 100%;">IDRNUEGHWTEHLOOUFDLARLAKDSADONLUDENASDYSHITENUATMUTNFHOAEERYNWETHLHCOEHUSUDPNOPGSRSIEYVLLENOITWEHHAESVNIEBHDEAAEPSNGSNAIELNOORNOSHCEAKBOTRUHSGAIHLNUAGDRYRLYERTATRCOAUFONCATYNRLDTEAHNTFGDONMULYEFSHATESDSAEHTSFHOEEVNEDIGRNNEOWWIIHNTWVEOIEFHMTNEACLYHLHOEOSOUHFSEUNRKOITWOHNTOIWWUABTSHWTTIIHFRELSGITEMSOPEFHBTDULIISNAEGONEFSUISFNAFRBELLGOEEOPRMEVDDAPMSIYIRTSINAISYEUFRFEALFBHOTERLFEIEANWSGEURLNEIVDENBAYYHOTAFLTAFHAPESLBUALRCEEABPUEOSCEISTIETMNWETINHTWIHHCTEHDMNUILSALUCYEERSIEEVTVNHEEETRSTNSNERAUATALMGIFEOTSEHDSETOAELEOTRRLRBEIOIOKLPEUODENHSTECNBEREOEFPMUOEENHMTHEEORAUENSEDHSTLIPEMDLNSAECPFAUETRAFEOTSOHDMEUANPIHOTENABEKLLWLSANUOTPAHVCEEATYNKEIELDWNOIPWUOSENFWAKRNSAEEGSDUADPNFOAENIWHTWUERNTFKODSYEAECEDRETTSIHWTAUTNEEDPRSRSIEFOOSNWOLHUIIHCCOACMNEPRTAEOOANLRHYTSSNAENTOMIPOERRROELPAYHNTHTTEOEATRFADEMRHOTEFERVLEULRPEPOOINHUTEMTBTEIPRASLTENOIREEYVLDYIAHFTEEEHDOIRUDOSNPIGPOOFFFVTEEHHITELARWSECAIINSNSAEKSNIISNAIGNCEIKFNOTGEHHAENRAUTDNEERDEEDMRRAIESNSOEOFHUTWGTHHNIHOCDGAIOFNOTGMHIAEAGNTICINOOTUDOLRRUETOITANTUHOGEFHSTIULMBAEHTWIWSTAUIASPOETTDKHNWIWHTAATSTHIOASUTRNEVNEEMIDENHCTEOTMNTPAILFOOTNOHHUEFSOUERSEIHSTAAWTMSEYLRALYOISLNEULNBOOCURGLIRDLAPEPHWTTIHHSAEYDWFOIACENASHTTWCODRPEUODANESMNIODPDEEIRFWSOADRETCLOALFKBCUATPNHOSENAUFTSAIRCOYTCCNLOOUINSTTAWHEHLBINEODYBDUTORTEEHCAEORNMIABNTOSIEOVRFMYIPSALNTELUAORCBETJISHCWVHAEHPTEOHOWRFESTUAHCFETFUIGSNLSILTATENHSAYILTSFHOOIPWSIELEROSMNANGOSCRIEADNTOSIOBYNERDUDOHETIPSTAPWIOSBSRLIEECFETLHETADETMRAFEIFDNEETRAARNREGMNETTFHOREATPLIUACFROTSCHSEEFNOTEEHDTESALOIEFHPTUITRCUEOLWSDEUBCFIIFTETONIMDFOPYREOPRASHNTANOLIIAHTTISEACPCAFIYOTRRORSUOFLWRIPEMOSINSAADCNGTNUITPNHODIIESEARIIMNDYESHREOHTTEOCPEIROPTUIISRNBAKFBOKLCAAUNLRDAITRDANHTTILYNAUURFNDFELLRUTESHBTEYLDELWAIGNNZDAEGWDONDWBTIUSTAHHEUDRDNEEMVTOEHRLRLIIHNTAGFNEOBPRUOEENHRTDEOEMDLEALNNIVDEETDRGIAEMTSFHOAERYGGSDEETADHNAEHSGTTYRLTESEENMADSVTEAHTCNAAYNEEDELKWIOIDWNVSEENERHLTIESNSSTIMHIASONGNFLOIOMNOROPOWEPSDOYTMSOAEFSLUOORJSNFOOEMWEETKISSPPORROITREERDROUIKSCHHRAEEDENBOOEFNOMBOYMNOPCOAINNBSNOIOYODHMBTAUENYAYARHDSPEASLIESNDUCORETLSMAIETNEEGLTAHTROEEWVRELHDAAYTLREHECEAIDENMSAITDPATANFROTTOHCUEYNRATTLTEEORRMFWHMHIIIHNCWISITYLLIDRMOTPTUAENUNTRADEAAHTDITMFEONDHOTEOARHNTRAESPLOARNYELTPSHMGEEAEVVNIECDNEFEOUROSVTAIAGNTOTIRHWIESTRPEOOEFKTAUECIBDLOLYLNIOESFSNAETMIADSLEODRRCWIHHROPEPDSEHSNIADMNOAEFEANSRSTEIDORTSEEEMAESSIBHAETNSDDNEIIEHSDYOLPNOESNRRAFILWEDINVTAIHFEOAWMTEPTGTNBIEYHCTRHEFEEUNSLMSFYOISCEOOTSMYLELEATVAIIFOOHNAIMLSIAYTDTWSHANEANMNEIWRHHCAIHLTILDSNMAMUHOCARWSEDSIIASTATWPHAPENAETRRHATETTAWHWETINITHSHURQEEHSWITLCALHDOEMWREOONOOFRMIHSTEOAINTIADANRCODCLIGYNYOEEBRDOTFTHIHWTWAIHLSILTSCNIOEDRDERAEYVGSNUISLRUANMOSM</textarea>
</div>
<div class="element">
<span class="label">Exercise</span> The following ciphertext was
encrypted using rectangular transposition. Find the corresponding
plaintext.
<textarea readonly rows=10 style="width: 100%;">MDOEWAOOMUHEODSNASEHCMEDALRENIVCRWOAHHTCFIOMTOERLBHEAAMDDPNPAYSHPISSOOITNEIMEDTNEUOISTOEEBHMTFESOTELGIBSSNOEFSXCEETSNAINEHEIDLDVNAEDRNWATYEYLOTEIRNAESTYHNWIDELRWHOVTRLTEILTTYOEISEDRTSRSVOXESEREHAHSWHGUTOYNSETEFOTOEHWATUDHFSGREOMTOATTESFFCOANITLDANIUEENGFAETHTRDAHNDSOACNNQIUENEFEOEHSCIRTRMSSRAIEAREINGEEMTBRSSSHEFOIOSUHEVMSORARFYEARPEYLEORDIEETHOMHHRARDOTDDEOOINLAHOGFORRGTEHRMOEVOTAHENINAINDTAISCMMNERERTABCRHNFOEAERCSDAESENESRHLDHPECAEAEBSELNPPIBUYDNLEACXLNETEOGAWNASVMEONOWRSSHAEDHAINFELLTLLTSFTEROOMHOAHFNTIRAEECFITITSNXEONEEDHYSRAIASMTBOSLYREANENDOIWROOMUHELMSAFILSEYSVGSASORANESAAEHTNRSIFNFREEVYNDDOFAHOTODGBHUEPUTBSTRRTACYRIALLFUEOMETMEBWNATEESWHTIAOMRMTINEIETAHCMOESYISTSFERERFVEBOMNIESRLSYAOATDHEODCESTOALHTIODNEMAHLNFFEOCIOOFVGRHSESETMNIEDFSLSEOENRHEARTEPHHMADDOLRAYLELDWEPIHOTMSREONRSAERTIYNAASHTTDEANDHWHUOAFTROIOYNNTIEGWBLONESOAPSAGWDYAYAEHHBTEDNGIEVINOLGTTFAERESIHERDIFNDNRNADEEUUVMYTLRLAAECYATHATNDEIDDAMOGMJNSSAUHWTETLHKHIIHDGYEELTGISMENIESMTSOSLYRUADJMTBGTNUIERDCICEDEHFTLEBWRYEHOTYHNRIEELAVSEILDEONDEFMEAMSIASUTTNIWOROEEHTPEERWFGIOVANAHTREUOHOTMHRHCRYWENWANODADIOAPSSIIOTTKINHTNLOIATWOTTEOLLLEFLSOREETHHFSTREEWEEEDHSTAIVDNGAEAWHHSCITEHARELATDELYNTOHYAOMRNNEJEYTTONESEMDHNWHAREOVGEEWRTRASPSAEETENNUOPCSERVTHITDAHEETDBOYNDTAINYMASYNARKEANMTOSFSRNIEUWRHSHTEOIRSOAMRACEEWNGLORTOSRBEUWNLTTATAIONLHEATHSPFEAOYRANSIGEDAELCNBOCSOEUINSMSSSITEASLRAYMRREODITSMISAITWASLSLYSROWOHSCTRIIFSRHOBGERUGTIIHTFAETWNOHESDWIOADDGYTNHFSEOILEVFBRDETHITDAMNMEFATASRSIINTOLFMNRUHUOTGNFUOTACHOYTCANUNNTIHEWGIEDDNVEEOABHRTDEINDRPGLEPOENEEOEETHAFHARNRHFEDSRLEERWLDTETFONEEIORHTTEEIGTWNPOHRPSCOTEFDIOHTROACTENLHAROEEVGNRHEGNEAITFEOMHOCPERDSITLHESFSMLOERTEFAEIPNDEUUNSASLRAADDHNEHAHSETOSTNYLOTNAIDONNIHKWTHFTDHAEHAOSSLTNVTEEEHHATERYDREPMVIOEPASHFPNOEISRHSROERFIFNSWERMEODNTAOAWMANUSNFXOTEPEIACBNECRLAHAECRTATOEFYRNSEUUEBSATLGIEANSEALPANDTAAARMENSDNTNESAHWESMREOACFSSIAITOTIINNOCSENRDNWTIIWHAGTHEYESDFNNLGIESOGREURNIFNSIEHSPEDHHDSAAWLYIASWERDHNAPMDOOEAETHTMCDHTUSWBTIABTLACIRAOMNGKSNOHOWFKRRRTEEFTHNAOIWSMTWOSLYRUALOBELDEFTEERVHEOYRUFEORVDRHYSYECAAELPELHDRSETAISEKNDSHNETISEKNDSHNETFOTACEIOFFNIYESETNAXREHHHSSWEDOTAUDAATHNOGWHHLDSAHPYEEAWRHDHTERIOFFAYMEVESIORDESLWOHAHDHEAEDTODLVHLRSEEWOROPATTDATHCNMAUAEHISRENAHLEHWHTDNOUARNEHRSEHTODURHRVGEHAOTUIISESNLSSLOECODFLIHDHAOABDLEGEORFTRDTGITUWAAEOEGSNIHEWBRTTIUEHNRTCEUTOOESFERLHSNVAESEETAYSUEREHQLTFAONGONIAPTEDFRURTCNSEEEVHIRHWCAEDHOLOSFNLWOEOILEDBALSSMAROGAAIETRHNIGIEEBNERFLTOCTAEHHOETWAERYSTEAADEENRETDERRRECLRLOEICOTSBANHEDEHNEFANAEIDDRCNMNIONAOUPCSAOWHEFPSSESSENSIDTLEILELEGWTLNNFIREUODESUMLFENEGLTKWNIOGETNLLHAAYWOAESHTFIFLMISRYETEENDTNSIILLTOANCEDACSNNERCPLILURAYTIENENDRETIESRHEVNSIFERLYELEUPSARVEEEYEERHCMFSHOROEENOTHSOWSLOMCEUSHPDAYEEVERHKOTGTSUATIRHOAEOWSDNHAADHUFNSAHAECCFIHOTFNRROAECEDSLUNEORVILAFFDUONTT</textarea>
</div>
<div class="element">
<p><span class="label">Sage Exercise with Minimal Programming</span> One
of the first lines of code above in the SageCell above says
<code>epsilon = 0.1</code>. What is this line of code doing? What
happens if you make this number smaller? What happens if you make it
bigger? Explain why this makes sense.</p>
</div>
<h2 id="known-plaintext-attack">3.9. Known Plaintext Attack</h2>
<p>So far in this section, we’ve studied a few techniques for conducting
ciphertext-only attacks on various ciphers, ie, ciphers where the only
information Eve knows to begin with is which cipher was used to encrypt
a message and has no information about the message itself. In this
section, we’ll describe a method for conducting a known-plaintext attack
on simple substitution, ie, an attack where Eve has some partial
information about the plaintext itself. Specifically, we’ll consider the
situation where Eve already knows that that a certain word appears at
least once in the plaintext. As it turns out, we can use the <span
class="math inline">\(G\)</span> test statistic to help us make good
guesses here.</p>
<p>Suppose, for example, that Eve intercepts the following ciphertext,
known to be encrypted using a simple substitution.</p>
<textarea readonly rows=10 style="width: 100%;">CUXQAUDRERAUFJUCKRACUXQAUDRXFGAUFJUCKRACUXQAUDRQWRFJXCAOFKCUXQAUDRQWRFJJFFSCADZRAACUXQAUDRRNFYDFJERSCRJCUXQAUDRRNFYDFJCZYGROMSCUPCUXQAUDRARQAFZFJSCWDUCUXQAUDRARQAFZFJOQGTZRAACUXQAUDRANGCZWFJDFNRCUXQAUDRXCZURGFJORANQCGXRDQORLRGPUDCZWERJFGRMAXRDQOZFUDCZWERJFGRMAXRXRGRQSSWFCZWOCGRYUUFDRQLRZXRXRGRQSSWFCZWOCGRYUUDRFUDRGXQPCZADFGUUDRNRGCFOXQAAFJQGSCTRUDRNGRARZUNRGCFOUDQUAFKRFJCUAZFCACRAUQMUDFGCUCRACZACAUROFZCUAERCZWGRYRCLROJFGWFFOFGJFGRLCSCZUDRAMNRGSQUCLRORWGRRFJYFKNQGCAFZFZSPUDRGRXRGRQTCZWXCUDQSQGWRHQXQZOQIMRRZXCUDQNSQCZJQYRFZUDRUDGFZRFJRZWSQZOUDRGRXRGRQTCZWXCUDQSQGWRHQXQZOQIMRRZXCUDQJQCGJQYRFZUDRUDGFZRFJJGQZYRCZEFUDYFMZUGCRACUXQAYSRQGRGUDQZYGPAUQSUFUDRSFGOAFJUDRAUQURNGRARGLRAFJSFQLRAQZOJCADRAUDQUUDCZWACZWRZRGQSXRGRARUUSROJFGRLRGCUXQAUDRPRQGFJFMGSFGOFZRUDFMAQZOARLRZDMZOGROQZOARLRZUPJCLRANCGCUMQSGRLRSQUCFZAXRGRYFZYROROUFRZWSQZOQUUDQUJQLFMGRONRGCFOQAQUUDCAKGAAFMUDYFUUDQOGRYRZUSPQUUQCZRODRGJCLRQZOUXRZUCRUDESRAAROECGUDOQPFJXDFKQNGFNDRUCYNGCLQURCZUDRSCJRWMQGOADQODRGQSOROUDRAMESCKRQNNRQGQZYREPQZZFMZYCZWUDQUQGGQZWRKRZUAXRGRKQORJFGUDRAXQSSFXCZWMNFJSFZOFZQZOXRAUKCZAURGRLRZUDRYFYTSQZRWDFAUDQOERRZSQCOFZSPQGFMZOOFVRZFJPRQGAQJURGGQNNCZWFMUCUAKRAAQWRAQAUDRANCGCUAFJUDCALRGPPRQGSQAUNQAUAMNRGZQUMGQSSPORJCYCRZUCZFGCWCZQSCUPGQNNROFMUUDRCGAKRGRKRAAQWRACZUDRRQGUDSPFGORGFJRLRZUADQOSQURSPYFKRUFUDRRZWSCADYGFXZQZONRFNSRJGFKQYFZWGRAAFJEGCUCADAMEHRYUACZQKRGCYQXDCYDAUGQZWRUFGRSQURDQLRNGFLROKFGRCKNFGUQZUUFUDRDMKQZGQYRUDQZQZPYFKKMZCYQUCFZAPRUGRYRCLROUDGFMWDQZPFJUDRYDCYTRZAFJUDRYFYTSQZREGFFOJGQZYRSRAAJQLFMGROFZUDRXDFSRQAUFKQUURGAANCGCUMQSUDQZDRGACAURGFJUDRADCRSOQZOUGCORZUGFSSROXCUDRBYRROCZWAKFFUDZRAAOFXZDCSSKQTCZWNQNRGKFZRPQZOANRZOCZWCUMZORGUDRWMCOQZYRFJDRGYDGCAUCQZNQAUFGAADRRZURGUQCZRODRGARSJERACORAXCUDAMYDDMKQZRQYDCRLRKRZUAQAARZURZYCZWQPFMUDUFDQLRDCADQZOAYMUFJJDCAUFZWMRUFGZFMUXCUDNCZYRGAQZODCAEFOPEMGZROQSCLRERYQMARDRDQOZFUTZRRSROOFXZCZUDRGQCZUFOFDFZFMGUFQOCGUPNGFYRAACFZFJKFZTAXDCYDNQAAROXCUDCZDCALCRXQUQOCAUQZYRFJAFKRJCJUPFGACBUPPQGOACUCASCTRSPRZFMWDUDQUGFFUROCZUDRXFFOAFJJGQZYRQZOZFGXQPUDRGRXRGRWGFXCZWUGRRAXDRZUDQUAMJJRGRGXQANMUUFORQUDQSGRQOPKQGTROEPUDRXFFOKQZJQURUFYFKROFXZQZOERAQXZCZUFEFQGOAUFKQTRQYRGUQCZKFLQESRJGQKRXFGTXCUDQAQYTQZOQTZCJRCZCUURGGCESRCZDCAUFGPCUCASCTRSPRZFMWDUDQUCZUDRGFMWDFMUDFMARAFJAFKRUCSSRGAFJUDRDRQLPSQZOAQOHQYRZUUFNQGCAUDRGRXRGRADRSURGROJGFKUDRXRQUDRGUDQULRGPOQPGMORYQGUAERANQUURGROXCUDGMAUCYKCGRAZMJJROQEFMUEPNCWAQZOGFFAUROCZEPNFMSUGPXDCYDUDRJQGKRGORQUDDQOQSGRQOPARUQNQGUUFERDCAUMKEGCSAFJUDRGRLFSMUCFZEMUUDQUXFFOKQZQZOUDQUJQGKRGUDFMWDUDRPXFGTMZYRQACZWSPXFGTACSRZUSPQZOZFFZRDRQGOUDRKQAUDRPXRZUQEFMUXCUDKMJJSROUGRQOUDRGQUDRGJFGQAKMYDQAUFRZURGUQCZQZPAMANCYCFZUDQUUDRPXRGRQXQTRXQAUFERQUDRCAUCYQSQZOUGQCUFGFMACZRZWSQZOUDRGRXQAAYQGYRSPQZQKFMZUFJFGORGQZONGFURYUCFZUFHMAUCJPKMYDZQUCFZQSEFQAUCZWOQGCZWEMGWSQGCRAEPQGKROKRZQZODCWDXQPGFEERGCRAUFFTNSQYRCZUDRYQNCUQSCUARSJRLRGPZCWDUJQKCSCRAXRGRNMESCYSPYQMUCFZROZFUUFWFFMUFJUFXZXCUDFMUGRKFLCZWUDRCGJMGZCUMGRUFMNDFSAURGRGAXQGRDFMARAJFGARYMGCUPUDRDCWDXQPKQZCZUDROQGTXQAQYCUPUGQORAKQZCZUDRSCWDUQZOERCZWGRYFWZCAROQZOYDQSSRZWROEPDCAJRSSFXUGQORAKQZXDFKDRAUFNNROCZDCAYDQGQYURGFJUDRYQNUQCZWQSSQZUSPADFUDCKUDGFMWDUDRDRQOQZOGFORQXQPUDRKQCSXQAXQPSQCOEPARLRZGFEERGAQZOUDRWMQGOADFUUDGRRORQOQZOUDRZWFUADFUORQODCKARSJEPUDRFUDRGJFMGCZYFZARIMRZYRFJUDRJQCSMGRFJDCAQKKMZCUCFZQJURGXDCYDUDRKQCSXQAGFEEROCZNRQYRUDQUKQWZCJCYRZUNFURZUQURUDRSFGOKQPFGFJSFZOFZXQAKQORUFAUQZOQZOORSCLRGFZUMGZDQKWGRRZEPFZRDCWDXQPKQZXDFORANFCSROUDRCSSMAUGCFMAYGRQUMGRCZACWDUFJQSSDCAGRUCZMRNGCAFZRGACZSFZOFZWQFSAJFMWDUEQUUSRAXCUDUDRCGUMGZTRPAQZOUDRKQHRAUPFJUDRSQXJCGROESMZORGEMAARACZQKFZWUDRKSFQOROXCUDGFMZOAFJADFUQZOEQSSUDCRLRAAZCNNROFJJOCQKFZOYGFAARAJGFKUDRZRYTAFJZFESRSFGOAQUYFMGUOGQXCZWGFFKAKMATRURRGAXRZUCZUFAUWCSRAAUFARQGYDJFGYFZUGQEQZOWFFOAQZOUDRKFEJCGROFZUDRKMATRURRGAQZOUDRKMATRURRGAJCGROFZUDRKFEQZOZFEFOPUDFMWDUQZPFJUDRARFYYMGGRZYRAKMYDFMUFJUDRYFKKFZXQPCZUDRKCOAUFJUDRKUDRDQZWKQZRLRGEMAPQZORLRGXFGARUDQZMARSRAAXQACZYFZAUQZUGRIMCACUCFZZFXAUGCZWCZWMNSFZWGFXAFJKCAYRSSQZRFMAYGCKCZQSAZFXDQZWCZWQDFMAREGRQTRGFZAQUMGOQPXDFDQOERRZUQTRZFZUMRAOQPZFXEMGZCZWNRFNSRCZUDRDQZOQUZRXWQUREPUDROFVRZQZOZFXEMGZCZWNQKNDSRUAQUUDROFFGFJXRAUKCZAURGDQSSUFOQPUQTCZWUDRSCJRFJQZQUGFYCFMAKMGORGRGQZOUFKFGGFXFJQXGRUYDRONCSJRGRGXDFDQOGFEEROQJQGKRGAEFPFJACBNRZYRQSSUDRARUDCZWAQZOQUDFMAQZOSCTRUDRKYQKRUFNQAACZQZOYSFARMNFZUDRORQGFSOPRQGFZRUDFMAQZOARLRZDMZOGROQZOARLRZUPJCLRRZLCGFZROEPUDRKXDCSRUDRXFFOKQZQZOUDRJQGKRGXFGTROMZDRROROUDFARUXFFJUDRSQGWRHQXAQZOUDFARFUDRGUXFFJUDRNSQCZQZOUDRJQCGJQYRAUGFOXCUDAUCGRZFMWDQZOYQGGCROUDRCGOCLCZRGCWDUAXCUDQDCWDDQZOUDMAOCOUDRPRQGFZRUDFMAQZOARLRZDMZOGROQZOARLRZUPJCLRYFZOMYUUDRCGWGRQUZRAARAQZOKPGCQOAFJAKQSSYGRQUMGRAUDRYGRQUMGRAFJUDCAYDGFZCYSRQKFZWUDRGRAUQSFZWUDRGFQOAUDQUSQPERJFGRUDRK</textarea>
<p>It’s the same ciphertext we studied in the “Frequency Analysis”
section above, but this time, suppose further that Eve knows from the
outset that the word <code>LONDON</code> occurs at least once in the
plaintext. Let’s take a look at how just knowing this can significantly
speed up the codebreaking process.</p>
<p>Notice that, in the word <code>LONDON</code>, the first 4 letters are
all distinct, the 5th letter is the same as the 2nd, and the 6th letter
is the same as the 3rd. This pattern will be preserved by simple
substitution, so somewhere in the ciphertext, we should find such a
sequence. If we can find such a pattern, it will suggest how the letters
<code>L</code>, <code>O</code>, <code>N</code>, and <code>D</code>
should be matched! As it turns out, there are 18 sequences in this
ciphertext that fit this pattern:</p>
<pre><code>SCUPCU
RACZAC
OFGJFG
ZUDRUD
ZUDRUD
SFZOFZ
ARZURZ
UDCZDC
RAFJAF
GKROKR
MUFJUF
SXQAXQ
SFZOFZ
UQZOQZ
SFZOFZ
RZUCZU
GCZWCZ
QZWCZW</code></pre>
<p>There are some repeats in this list (<code>ZUDRUD</code> occurs twice
and <code>SFZOFZ</code> occurs thrice), but even after eliminating
repeats, there are still 15 distinct possibilities for sequences that
might correspond to <code>LONDON</code>.</p>
<p>That’s already pretty good: if we were just brute forcing through
possible substitutions, the number of possibilities for matching the
letters <code>L</code>, <code>O</code>, <code>N</code>, and
<code>D</code> would be <span class="math display">\[ 26 \cdot 25 \cdot
24 \cdot 23 = 358,800, \]</span> so we’ve already drastically decreased
our search space (by a factor of <span class="math inline">\(358,800/15
= 23,920\)</span>). But it turns out that we can do even better!</p>
<p>The key observation is that the relative frequencies of the letters
<code>L</code>, <code>O</code>, <code>N</code> and <code>D</code> in
some sample of plaintext English should match the relative frequencies
of the corresponding ciphertext letters. We can measure deviations
between frequencies using <span class="math inline">\(G\)</span>, so we
can compute <span class="math inline">\(G\)</span> for each of the 15
possible matchings and use that to help guide our choices.</p>
<p>Let’s describe how to do one of these calculations of <span
class="math inline">\(G\)</span> in detail. Start by looking at some
sample English text (eg, the Declaration of Independence) and throwing
out all of the letters <em>except</em> <code>L</code>, <code>O</code>,
<code>N</code>, and <code>D</code>. If we do so, we find the following
distribution:</p>
<table style="margin: auto; width: 100%; text-align: center;">
<tr>
<th width="25%">
</th>
<th width="15%">
L
</th>
<th width="15%">
O
</th>
<th width="15%">
N
</th>
<th width="15%">
D
</th>
<th width="15%">
Total
</th>
</tr>
<tr>
<th>
Count in Sample
</th>
<td>
228
</td>
<td>
513
</td>
<td>
483
</td>
<td>
252
</td>
<td>
1476
</td>
</tr>
<tr>
<th>
Percent in Sample
</th>
<td>
15.4%
</td>
<td>
34.8%
</td>
<td>
32.7%
</td>
<td>
17.1%
</td>
<td>
100%
</td>
</tr>
</table>
<p>Suppose we think that the first possibility we listed above,
<code>SCUPCU</code>, corresponds to <code>LONDON</code>. This would mean
that <code>S</code> is matched to <code>L</code>, and <code>C</code> to
<code>O</code>, and <code>U</code> to <code>N</code>, and <code>P</code>
to <code>D</code>. We can then go through our ciphertext and count
instances of <code>S</code>, <code>C</code>, <code>U</code> and
<code>P</code> (throwing out all other letters), which lets us fill in
the first row in the table below.</p>
<table style="margin: auto; width: 100%; text-align: center;">
<tr>
<th width="25%">
</th>
<th width="15%">
S
</th>
<th width="15%">
C
</th>
<th width="15%">
U
</th>
<th width="15%">
P
</th>
<th width="15%">
Total
</th>
</tr>
<tr>
<th>
Observed in Ciphertext
</th>
<td>
146
</td>
<td>
293
</td>
<td>
429
</td>
<td>
83
</td>
<td>
951
</td>
</tr>
<tr>
<th>
Expected in Ciphertext
</th>
<td>
146.9
</td>
<td>
330.5
</td>
<td>
311.2
</td>
<td>
162.4
</td>
<td>
951
</td>
</tr>
</table>
<p>To fill in the second row, we use the percentages we calculated in
our table above. For example, we saw that 15.4% of the letters
<code>L</code>, <code>O</code>, <code>N</code>, and <code>D</code>
should be <code>L</code>, so if <code>L</code> corresponds to
<code>S</code> in the ciphertext, we would expect <span
class="math inline">\(0.154 \cdot 951 \approx 146.9\)</span> letters of
the ciphertext to be <code>S</code>. Now we can compute <span
class="math inline">\(G\)</span>. <span class="math display">\[
\begin{aligned} G &amp;= 2 \sum O \ln \left(\frac{O}{E}\right) \\
&amp;\approx 2 \left( 146 \cdot \ln \left( \frac{146}{146.9} \right) +
293 \cdot \ln \left( \frac{293}{330.5} \right) +
429 \cdot \ln \left( \frac{429}{311.2} \right) +
83 \cdot \ln \left( \frac{83}{162.4} \right) \right) \\
&amp;\approx 91.6. \end{aligned} \]</span></p>
<div class="element">
<p><span class="label">Exercise</span> The values of <span
class="math inline">\(G\)</span> are approximated by a chi-square
distribution with <span class="math inline">\(k\)</span> degrees of
freedom. What is <span class="math inline">\(k\)</span>? What is the
value of the integral <span class="math display">\[ \int_{91.6}^\infty
f_k(x)\, dx, \]</span> ie, the p-value? Based on this, does it seem
likely that <code>SCUPCU</code> is a correct match for London?</p>
</div>
<p>We can then do analogous calculations of <span
class="math inline">\(G\)</span> for the other 14 possibilities. Here
are the results:</p>
<table width="50%" style="text-align: center; margin: auto;">
<tr>
<th width="66%">
Ciphertext Match
</th>
<th width="33%">
<span class="math inline">\(G\)</span>
</th>
</tr>
<tr>
<td>
<code>SCUPCU</code>
</td>
<td>
91.6
</td>
</tr>
<tr>
<td>
<code>RACZAC</code>
</td>
<td>
602.9
</td>
</tr>
<tr>
<td>
<code>OFGJFG</code>
</td>
<td>
34.5
</td>
</tr>
<tr>
<td>
<code>ZUDRUD</code>
</td>
<td>
442.5
</td>
</tr>
<tr>
<td>
<code>SFZOFZ</code>
</td>
<td>
7.8
</td>
</tr>
<tr>
<td>
<code>ARZURZ</code>
</td>
<td>
160.5
</td>
</tr>
<tr>
<td>
<code>UDCZDC</code>
</td>
<td>
354.4
</td>
</tr>
<tr>
<td>
<code>RAFJAF</code>
</td>
<td>
597.0
</td>
</tr>
<tr>
<td>
<code>GKROKR</code>
</td>
<td>
490.8
</td>
</tr>
<tr>
<td>
<code>MUFJUF</code>
</td>
<td>
39.3
</td>
</tr>
<tr>
<td>
<code>SXQAXQ</code>
</td>
<td>
284.8
</td>
</tr>
<tr>
<td>
<code>UQZOQZ</code>
</td>
<td>
223.0
</td>
</tr>
<tr>
<td>
<code>RZUCZU</code>
</td>
<td>
444.8
</td>
</tr>
<tr>
<td>
<code>GCZWCZ</code>
</td>
<td>
162.4
</td>
</tr>
<tr>
<td>
<code>QZWCZW</code>
</td>
<td>
533.3
</td>
</tr>
</table>
<p>Recall now that smaller vaues of <span
class="math inline">\(G\)</span> mean that the distributions are closer
together, so the most likely match for <code>LONDON</code> appears to be
<code>SFZOFZ</code>. Of course, it’s possible that <code>SFZOFZ</code>
is not the correct match, but if we make that guess and then it seems
like the decryption is turning out to be nonsense, we can just go back
and try the one option with the next lowest value of <span
class="math inline">\(G\)</span>.</p>
<p>As we’ve seen, it’s usually easy to guess which letters correspond go
<code>E</code> and <code>T</code>. We now have a systematic way of
identifying the letters <code>L</code>, <code>O</code>, <code>N</code>,
and <code>D</code> as well. We’ve made significant process!</p>
<div id="sagecell-known-plaintext-attack" class="element">
<p><span class="label">SageCell</span> Here’s a SageCell to play with.
It’s very similar to the <a
href="#sagecell-frequency-analysis">Frequency Analysis SageCell</a> we
had earlier, but now there is one additional input: a textbox labeled
“Known” which should contain plaintext words you know to be present in
the encrypted message. Correspondingly, there is one additional output:
a table labeled “Match” which shows all the patterns which match the
known word, together with their corresponding <span
class="math inline">\(G\)</span> values and the pairs that would need to
be added to the guessed keys in order to make that pattern fit.</p>
<p>Note that, as you make guesses for the key, the pattern matches could
decrease. For example, if you guess that ciphertext letter
<code>S</code> corresponds to plaintext letter <code>S</code>, only 3 of
the 15 matches described above will remain — namely, the 3 in which the
first letter is <code>S</code>! Similarly, if you guess that the
ciphertext letter <code>R</code> corresponds to plaintext letter
<code>E</code>, then all pattern match containing the letter
<code>R</code> will be eliminated since <code>E</code> does not occur in
the word <code>LONDON</code>.</p>
<p>Try decrypting. It’s the same message as last time, but you should
find that the knowledge of what corresponds to <code>LONDON</code> will
speed up the process significantly.</p>
<div class="sage">
<script type="text/x-sage">
from re import sub
from copy import deepcopy
from collections import Counter

epsilon = 0.1
sampletext = """When in the Course of human events, it becomes necessary for one people to dissolve the political bands which have connected them with another, and to assume among the powers of the earth, the separate and equal station to which the Laws of Nature and of Nature's God entitle them, a decent respect to the opinions of mankind requires that they should declare the causes which impel them to the separation.

We hold these truths to be self-evident, that all men are created equal, that they are endowed by their Creator with certain unalienable Rights, that among these are Life, Liberty and the pursuit of Happiness.--That to secure these rights, Governments are instituted among Men, deriving their just powers from the consent of the governed, --That whenever any Form of Government becomes destructive of these ends, it is the Right of the People to alter or to abolish it, and to institute new Government, laying its foundation on such principles and organizing its powers in such form, as to them shall seem most likely to effect their Safety and Happiness. Prudence, indeed, will dictate that Governments long established should not be changed for light and transient causes; and accordingly all experience hath shewn, that mankind are more disposed to suffer, while evils are sufferable, than to right themselves by abolishing the forms to which they are accustomed. But when a long train of abuses and usurpations, pursuing invariably the same Object evinces a design to reduce them under absolute Despotism, it is their right, it is their duty, to throw off such Government, and to provide new Guards for their future security.--Such has been the patient sufferance of these Colonies; and such is now the necessity which constrains them to alter their former Systems of Government. The history of the present King of Great Britain is a history of repeated injuries and usurpations, all having in direct object the establishment of an absolute Tyranny over these States. To prove this, let Facts be submitted to a candid world.

He has refused his Assent to Laws, the most wholesome and necessary for the public good.

He has forbidden his Governors to pass Laws of immediate and pressing importance, unless suspended in their operation till his Assent should be obtained; and when so suspended, he has utterly neglected to attend to them.

He has refused to pass other Laws for the accommodation of large districts of people, unless those people would relinquish the right of Representation in the Legislature, a right inestimable to them and formidable to tyrants only.

He has called together legislative bodies at places unusual, uncomfortable, and distant from the depository of their public Records, for the sole purpose of fatiguing them into compliance with his measures.

He has dissolved Representative Houses repeatedly, for opposing with manly firmness his invasions on the rights of the people.

He has refused for a long time, after such dissolutions, to cause others to be elected; whereby the Legislative powers, incapable of Annihilation, have returned to the People at large for their exercise; the State remaining in the mean time exposed to all the dangers of invasion from without, and convulsions within.

He has endeavoured to prevent the population of these States; for that purpose obstructing the Laws for Naturalization of Foreigners; refusing to pass others to encourage their migrations hither, and raising the conditions of new Appropriations of Lands.

He has obstructed the Administration of Justice, by refusing his Assent to Laws for establishing Judiciary powers.

He has made Judges dependent on his Will alone, for the tenure of their offices, and the amount and payment of their salaries.

He has erected a multitude of New Offices, and sent hither swarms of Officers to harrass our people, and eat out their substance.

He has kept among us, in times of peace, Standing Armies without the Consent of our legislatures.

He has affected to render the Military independent of and superior to the Civil power.

He has combined with others to subject us to a jurisdiction foreign to our constitution, and unacknowledged by our laws; giving his Assent to their Acts of pretended Legislation:

For Quartering large bodies of armed troops among us:

For protecting them, by a mock Trial, from punishment for any Murders which they should commit on the Inhabitants of these States:

For cutting off our Trade with all parts of the world:

For imposing Taxes on us without our Consent:

For depriving us in many cases, of the benefits of Trial by Jury:

For transporting us beyond Seas to be tried for pretended offences

For abolishing the free System of English Laws in a neighbouring Province, establishing therein an Arbitrary government, and enlarging its Boundaries so as to render it at once an example and fit instrument for introducing the same absolute rule into these Colonies:

For taking away our Charters, abolishing our most valuable Laws, and altering fundamentally the Forms of our Governments:

For suspending our own Legislatures, and declaring themselves invested with power to legislate for us in all cases whatsoever.

He has abdicated Government here, by declaring us out of his Protection and waging War against us.

He has plundered our seas, ravaged our Coasts, burnt our towns, and destroyed the lives of our people.

He is at this time transporting large Armies of foreign Mercenaries to compleat the works of death, desolation and tyranny, already begun with circumstances of Cruelty & perfidy scarcely paralleled in the most barbarous ages, and totally unworthy the Head of a civilized nation.

He has constrained our fellow Citizens taken Captive on the high Seas to bear Arms against their Country, to become the executioners of their friends and Brethren, or to fall themselves by their Hands.

He has excited domestic insurrections amongst us, and has endeavoured to bring on the inhabitants of our frontiers, the merciless Indian Savages, whose known rule of warfare, is an undistinguished destruction of all ages, sexes and conditions.

In every stage of these Oppressions We have Petitioned for Redress in the most humble terms: Our repeated Petitions have been answered only by repeated injury. A Prince whose character is thus marked by every act which may define a Tyrant, is unfit to be the ruler of a free people.

Nor have We been wanting in attentions to our Brittish brethren. We have warned them from time to time of attempts by their legislature to extend an unwarrantable jurisdiction over us. We have reminded them of the circumstances of our emigration and settlement here. We have appealed to their native justice and magnanimity, and we have conjured them by the ties of our common kindred to disavow these usurpations, which, would inevitably interrupt our connections and correspondence. They too have been deaf to the voice of justice and of consanguinity. We must, therefore, acquiesce in the necessity, which denounces our Separation, and hold them, as we hold the rest of mankind, Enemies in War, in Peace Friends.

We, therefore, the Representatives of the united States of America, in General Congress, Assembled, appealing to the Supreme Judge of the world for the rectitude of our intentions, do, in the Name, and by Authority of the good People of these Colonies, solemnly publish and declare, That these United Colonies are, and of Right ought to be Free and Independent States; that they are Absolved from all Allegiance to the British Crown, and that all political connection between them and the State of Great Britain, is and ought to be totally dissolved; and that as Free and Independent States, they have full Power to levy War, conclude Peace, contract Alliances, establish Commerce, and to do all other Acts and Things which Independent States may of right do. And for the support of this Declaration, with a firm reliance on the protection of divine Providence, we mutually pledge to each other our Lives, our Fortunes and our sacred Honor."""
ciphertext = """CUXQAUDRERAUFJUCKRACUXQAUDRXFGAUFJUCKRACUXQAUDRQWRFJXCAOFKCUXQAUDRQWRFJJFFSCADZRAACUXQAUDRRNFYDFJERSCRJCUXQAUDRRNFYDFJCZYGROMSCUPCUXQAUDRARQAFZFJSCWDUCUXQAUDRARQAFZFJOQGTZRAACUXQAUDRANGCZWFJDFNRCUXQAUDRXCZURGFJORANQCGXRDQORLRGPUDCZWERJFGRMAXRDQOZFUDCZWERJFGRMAXRXRGRQSSWFCZWOCGRYUUFDRQLRZXRXRGRQSSWFCZWOCGRYUUDRFUDRGXQPCZADFGUUDRNRGCFOXQAAFJQGSCTRUDRNGRARZUNRGCFOUDQUAFKRFJCUAZFCACRAUQMUDFGCUCRACZACAUROFZCUAERCZWGRYRCLROJFGWFFOFGJFGRLCSCZUDRAMNRGSQUCLRORWGRRFJYFKNQGCAFZFZSPUDRGRXRGRQTCZWXCUDQSQGWRHQXQZOQIMRRZXCUDQNSQCZJQYRFZUDRUDGFZRFJRZWSQZOUDRGRXRGRQTCZWXCUDQSQGWRHQXQZOQIMRRZXCUDQJQCGJQYRFZUDRUDGFZRFJJGQZYRCZEFUDYFMZUGCRACUXQAYSRQGRGUDQZYGPAUQSUFUDRSFGOAFJUDRAUQURNGRARGLRAFJSFQLRAQZOJCADRAUDQUUDCZWACZWRZRGQSXRGRARUUSROJFGRLRGCUXQAUDRPRQGFJFMGSFGOFZRUDFMAQZOARLRZDMZOGROQZOARLRZUPJCLRANCGCUMQSGRLRSQUCFZAXRGRYFZYROROUFRZWSQZOQUUDQUJQLFMGRONRGCFOQAQUUDCAKGAAFMUDYFUUDQOGRYRZUSPQUUQCZRODRGJCLRQZOUXRZUCRUDESRAAROECGUDOQPFJXDFKQNGFNDRUCYNGCLQURCZUDRSCJRWMQGOADQODRGQSOROUDRAMESCKRQNNRQGQZYREPQZZFMZYCZWUDQUQGGQZWRKRZUAXRGRKQORJFGUDRAXQSSFXCZWMNFJSFZOFZQZOXRAUKCZAURGRLRZUDRYFYTSQZRWDFAUDQOERRZSQCOFZSPQGFMZOOFVRZFJPRQGAQJURGGQNNCZWFMUCUAKRAAQWRAQAUDRANCGCUAFJUDCALRGPPRQGSQAUNQAUAMNRGZQUMGQSSPORJCYCRZUCZFGCWCZQSCUPGQNNROFMUUDRCGAKRGRKRAAQWRACZUDRRQGUDSPFGORGFJRLRZUADQOSQURSPYFKRUFUDRRZWSCADYGFXZQZONRFNSRJGFKQYFZWGRAAFJEGCUCADAMEHRYUACZQKRGCYQXDCYDAUGQZWRUFGRSQURDQLRNGFLROKFGRCKNFGUQZUUFUDRDMKQZGQYRUDQZQZPYFKKMZCYQUCFZAPRUGRYRCLROUDGFMWDQZPFJUDRYDCYTRZAFJUDRYFYTSQZREGFFOJGQZYRSRAAJQLFMGROFZUDRXDFSRQAUFKQUURGAANCGCUMQSUDQZDRGACAURGFJUDRADCRSOQZOUGCORZUGFSSROXCUDRBYRROCZWAKFFUDZRAAOFXZDCSSKQTCZWNQNRGKFZRPQZOANRZOCZWCUMZORGUDRWMCOQZYRFJDRGYDGCAUCQZNQAUFGAADRRZURGUQCZRODRGARSJERACORAXCUDAMYDDMKQZRQYDCRLRKRZUAQAARZURZYCZWQPFMUDUFDQLRDCADQZOAYMUFJJDCAUFZWMRUFGZFMUXCUDNCZYRGAQZODCAEFOPEMGZROQSCLRERYQMARDRDQOZFUTZRRSROOFXZCZUDRGQCZUFOFDFZFMGUFQOCGUPNGFYRAACFZFJKFZTAXDCYDNQAAROXCUDCZDCALCRXQUQOCAUQZYRFJAFKRJCJUPFGACBUPPQGOACUCASCTRSPRZFMWDUDQUGFFUROCZUDRXFFOAFJJGQZYRQZOZFGXQPUDRGRXRGRWGFXCZWUGRRAXDRZUDQUAMJJRGRGXQANMUUFORQUDQSGRQOPKQGTROEPUDRXFFOKQZJQURUFYFKROFXZQZOERAQXZCZUFEFQGOAUFKQTRQYRGUQCZKFLQESRJGQKRXFGTXCUDQAQYTQZOQTZCJRCZCUURGGCESRCZDCAUFGPCUCASCTRSPRZFMWDUDQUCZUDRGFMWDFMUDFMARAFJAFKRUCSSRGAFJUDRDRQLPSQZOAQOHQYRZUUFNQGCAUDRGRXRGRADRSURGROJGFKUDRXRQUDRGUDQULRGPOQPGMORYQGUAERANQUURGROXCUDGMAUCYKCGRAZMJJROQEFMUEPNCWAQZOGFFAUROCZEPNFMSUGPXDCYDUDRJQGKRGORQUDDQOQSGRQOPARUQNQGUUFERDCAUMKEGCSAFJUDRGRLFSMUCFZEMUUDQUXFFOKQZQZOUDQUJQGKRGUDFMWDUDRPXFGTMZYRQACZWSPXFGTACSRZUSPQZOZFFZRDRQGOUDRKQAUDRPXRZUQEFMUXCUDKMJJSROUGRQOUDRGQUDRGJFGQAKMYDQAUFRZURGUQCZQZPAMANCYCFZUDQUUDRPXRGRQXQTRXQAUFERQUDRCAUCYQSQZOUGQCUFGFMACZRZWSQZOUDRGRXQAAYQGYRSPQZQKFMZUFJFGORGQZONGFURYUCFZUFHMAUCJPKMYDZQUCFZQSEFQAUCZWOQGCZWEMGWSQGCRAEPQGKROKRZQZODCWDXQPGFEERGCRAUFFTNSQYRCZUDRYQNCUQSCUARSJRLRGPZCWDUJQKCSCRAXRGRNMESCYSPYQMUCFZROZFUUFWFFMUFJUFXZXCUDFMUGRKFLCZWUDRCGJMGZCUMGRUFMNDFSAURGRGAXQGRDFMARAJFGARYMGCUPUDRDCWDXQPKQZCZUDROQGTXQAQYCUPUGQORAKQZCZUDRSCWDUQZOERCZWGRYFWZCAROQZOYDQSSRZWROEPDCAJRSSFXUGQORAKQZXDFKDRAUFNNROCZDCAYDQGQYURGFJUDRYQNUQCZWQSSQZUSPADFUDCKUDGFMWDUDRDRQOQZOGFORQXQPUDRKQCSXQAXQPSQCOEPARLRZGFEERGAQZOUDRWMQGOADFUUDGRRORQOQZOUDRZWFUADFUORQODCKARSJEPUDRFUDRGJFMGCZYFZARIMRZYRFJUDRJQCSMGRFJDCAQKKMZCUCFZQJURGXDCYDUDRKQCSXQAGFEEROCZNRQYRUDQUKQWZCJCYRZUNFURZUQURUDRSFGOKQPFGFJSFZOFZXQAKQORUFAUQZOQZOORSCLRGFZUMGZDQKWGRRZEPFZRDCWDXQPKQZXDFORANFCSROUDRCSSMAUGCFMAYGRQUMGRCZACWDUFJQSSDCAGRUCZMRNGCAFZRGACZSFZOFZWQFSAJFMWDUEQUUSRAXCUDUDRCGUMGZTRPAQZOUDRKQHRAUPFJUDRSQXJCGROESMZORGEMAARACZQKFZWUDRKSFQOROXCUDGFMZOAFJADFUQZOEQSSUDCRLRAAZCNNROFJJOCQKFZOYGFAARAJGFKUDRZRYTAFJZFESRSFGOAQUYFMGUOGQXCZWGFFKAKMATRURRGAXRZUCZUFAUWCSRAAUFARQGYDJFGYFZUGQEQZOWFFOAQZOUDRKFEJCGROFZUDRKMATRURRGAQZOUDRKMATRURRGAJCGROFZUDRKFEQZOZFEFOPUDFMWDUQZPFJUDRARFYYMGGRZYRAKMYDFMUFJUDRYFKKFZXQPCZUDRKCOAUFJUDRKUDRDQZWKQZRLRGEMAPQZORLRGXFGARUDQZMARSRAAXQACZYFZAUQZUGRIMCACUCFZZFXAUGCZWCZWMNSFZWGFXAFJKCAYRSSQZRFMAYGCKCZQSAZFXDQZWCZWQDFMAREGRQTRGFZAQUMGOQPXDFDQOERRZUQTRZFZUMRAOQPZFXEMGZCZWNRFNSRCZUDRDQZOQUZRXWQUREPUDROFVRZQZOZFXEMGZCZWNQKNDSRUAQUUDROFFGFJXRAUKCZAURGDQSSUFOQPUQTCZWUDRSCJRFJQZQUGFYCFMAKMGORGRGQZOUFKFGGFXFJQXGRUYDRONCSJRGRGXDFDQOGFEEROQJQGKRGAEFPFJACBNRZYRQSSUDRARUDCZWAQZOQUDFMAQZOSCTRUDRKYQKRUFNQAACZQZOYSFARMNFZUDRORQGFSOPRQGFZRUDFMAQZOARLRZDMZOGROQZOARLRZUPJCLRRZLCGFZROEPUDRKXDCSRUDRXFFOKQZQZOUDRJQGKRGXFGTROMZDRROROUDFARUXFFJUDRSQGWRHQXAQZOUDFARFUDRGUXFFJUDRNSQCZQZOUDRJQCGJQYRAUGFOXCUDAUCGRZFMWDQZOYQGGCROUDRCGOCLCZRGCWDUAXCUDQDCWDDQZOUDMAOCOUDRPRQGFZRUDFMAQZOARLRZDMZOGROQZOARLRZUPJCLRYFZOMYUUDRCGWGRQUZRAARAQZOKPGCQOAFJAKQSSYGRQUMGRAUDRYGRQUMGRAFJUDCAYDGFZCYSRQKFZWUDRGRAUQSFZWUDRGFQOAUDQUSQPERJFGRUDRK"""

alphabet = list(build_alphabet(name="upper"))
unassigned = "*"
key_start = "\n".join(["".join(alphabet), "".join([unassigned] * 26)])

# Remove all non alphabetic characters and capitalize
def encode(text: str):
    stripped = sub(r"[^a-zA-Z]", "", text)
    return stripped.upper()

# Decrypt a string using the given key    
def decrypt(text: str, key: dict):
    text = encode(text)
    o = ""
    for x in text:
        if key[x] == "*":
            o += f'<span style="color: #dddddd;">{x}</span>'
        else:
            o += key[x]
    return o
    
# Compute the G test statistic: 
# * Both arguments are dicts with values being counts
# * Keys are used to match corresponding counts
# * Sum of the expected and observed counts need not match
def calculate_G(observed, expected):
    observed_total = sum(observed.values())
    expected_total = sum(expected.values())

    lnsum = 0
    for x, o in observed.items():
        e = expected.get(x, 0) * observed_total / expected_total
        if e == 0:
            e = epsilon
        lnsum += o * ln(1.0 * o / e)
    return 2 * lnsum
    
# Returns a frequency dictionary corresponding to a count dictionary
def counts_to_freqs(counts):
    total = sum(counts.values())
    return {k: (1.0*n/total) for k, n in counts.items()}
    
# Separates a string into groups of n letters for convenience
def separate(text: str, n=5):
    return " ".join(text[i:i+n] for i in range(0, len(text), n))

# Prints an output div aligning with the interact controls   
def output_div(label: str, content: str):
    s = '<div class="sagecell_interactControlCell" style="width: 100%;">'
    s += f'<label class="sagecell_interactControlLabel">{label}</label>'
    s += f'<div class="sagecell_interactControl">{content}</div>'
    s += '</div>'
    pretty_print(html(s))
    
# Find all patterns in the text that match the given words pattern    
def find_candidates(text: str, word: str, init_key: dict):
    matches = []
    keys = []
    for i in range(len(text)-len(word)+1):
        segment = text[i:i+len(word)]        
        if segment not in matches:
            keep = True
            key = deepcopy(init_key)
            for x, y in zip(segment, word): 
                a = key[x] == unassigned
                b = y not in key.values()
                c = key[x] == y
                
                if a and b:
                    key[x] = y
                elif (a and (not b)) or ((not a) and (not c)):
                    keep = False
                    break
            if keep:
                matches.append(segment)
                keys.append(key)
    return matches, keys
    
# Validate the input key
def validate(input_key):
    if len(input_key) != len(key_start):
        raise Exception("Do not add or remove characters to the key")
    if input_key[:27] != key_start[:27]:
        raise Exception("Do not change the first row of the key")
    valid = alphabet + [unassigned]
    if len([x for x in input_key[27:] if x not in valid]):
        raise Exception(f"Every character in second row of key must be a capital letter or {unassigned}")
    counts = Counter([x for x in input_key[27:] if x != unassigned])
    for n in counts.values():
        if n > 1:
            raise Exception("Do not repeat letters in the second row")
    return {x: y for x, y in zip(alphabet, input_key[27:])}

@interact
def _(cipher=input_box(default=ciphertext, label="Input", height=5, width=70),
      known=input_box(default="LONDON", label="Known", height=2, width=70),
      sample=input_box(default=sampletext, label="Sample", height=5, width=70),
      input_key=input_box(default=key_start, label="Key", height=2, width=70)):
    if not cipher.isalpha() or not cipher.isupper():
        raise Exception("Ciphertext must consist only of uppercase characters")
    
    # Validate key
    key = validate(input_key)
    
    # Calculate frequencies
    alphabet = list(build_alphabet(name="upper"))
    sample = encode(sample)
    sample_freq = counts_to_freqs(Counter(sample))
    cipher_freq = counts_to_freqs(Counter(cipher))
    
    o = '<table width="90%" style="font-size: 0.6em; text-align: center;"><tr><td></td>'
    for x in alphabet:
        o += f"<td>{x}</td>"
    o += "</tr>"
    for i, f in enumerate([cipher_freq, sample_freq]):
        y = "Cipher" if i == 0 else "Sample"
        o += f"<tr><td>{y}</td>"
        for x in alphabet:
            o += f"<td>{100*f.get(x, 0):.1f}</td>"
        o += "</tr>"
    
    o += "</table>"
    output_div("Percent", o)
    
    # Calculate and filter ranked lists
    sample_sorted = sorted(alphabet, key=lambda x: sample_freq.get(x, 0), reverse=True)
    cipher_sorted = sorted(alphabet, key=lambda x: cipher_freq.get(x, 0), reverse=True)
    sample_ranked = "".join(x for x in sample_sorted if x not in key.values())
    cipher_ranked = "".join(x for x in cipher_sorted if key[x] == unassigned)
    
    s = "(Cipher) "
    s += separate(cipher_ranked)
    s +="<br/>"
    s += "(Sample) "
    s += separate(sample_ranked)
    output_div("Ranked", s)
    
    # Calculate Gs for known word patterns
    matches, keys = find_candidates(cipher, known, key)
    
    if len(matches) == 0:
        s = "<div>There are no pattern matches for the known word that are compatible with proposed key!</div>"
    else:
        s = "<table width='93%' style='text-align: center;'><tr><td width='30%'>Match</td><td width='30%'>G</td><td width='40%'>Key Additions<br/>(Ciphertext = Plaintext)</td></tr>"
        for m, k in zip(matches, keys):
            observed = Counter([x for x in cipher if k[x] != unassigned])
            observed = {k[x]: n for x, n in observed.items()}
            expected = Counter([x for x in sample if x in k.values()])
            g = calculate_G(observed, expected)
            s += "<tr>"
            s += f"<td>{m}</td>"
            if g == Infinity:
                s += "<td>+Inf</td>"
            else:
                s += f"<td>{g:.1f}</td>"
            s += "<td>"
            s += ", ".join([f"{x} = {y}" for x, y in k.items() if y != unassigned])
            s += "</td>"
            s += "</tr>"
    output_div("Match", s)
    
    # Display decrypted text
    output = decrypt(cipher, key)
    output_div("Output", f'<div style="inline-size: 45em; overflow-wrap: break-word;">{ output }</div>')  
</script>
</div>
</div>
<div class="element">
<span class="label">Exercise</span> The following ciphertext was
encrypted using a simple substitution. The plaintext is known to contain
the word <code>CARPENTER</code>. Find the corresponding plaintext.
<textarea readonly rows=10 style="width: 100%;">GCWJKBCLHJMACXCDUSJXQXCWYOCBBMCBBUAJZCGCCMROJQUMTJOFJQBJOLBUMTTJICBUMWCIQWAUODALLDDKXUMTIQTXJIIJXBWALLODJQBUFJBLMWCOJUDKRHLXJGLKSJFCCYGQEKIRUMTHXLISACBCWLMDBSLXQLHSACBWALLOGKUODUMTBLICIJQJBYFAQUWLIIUSSCDBKWAJXJBAJWSSACXCFJBMLRJXSUWKOJXXCJBLMHLXDLUMTBKWAJSAUMTCNWCRSUAJRRCMCDSLGCOLLYUMTLKSUMSLSACQJXDHXLISACBCWLMDHOLLXLHSACMCFOQGKUOSBWALLOALKBCFACMLMCLHIQWOJBBIJSCBELYUMTBALKSCDJSICBJQQLKGUTGOKHHUOOGCSQLKWJMSEKIRDLFMHXLISACXCLQLKWAUWYCMACJXSAJAJBLUEKIRCDDLFMSACEJMUSLXLHSACBWALLOAJDSLWJXXQICALICLMAUBGJWYJMDFACMIQHJSACXBJFICACQCOOCDDCXUBUZCOQFAJSJHCOOLFQLKJXCSLTLJMDTCSQLKXGLMCBDUBOLWJSCDGQEKIRUMTLMOQHXLIJBCWLMDBSLXQUOOBCCUDLMSTCSDUBOLWJSCDMCNSSUICUJMBFCXCDLMCLHIQXCOJSUZCBLMWCRXCBCMSCDICFUSAJRCMYMUHCUFJBBALFUMTUSSLIQHXUCMDBXCHOCWSUMTUSBRXCSSQGOJDCBJTJUMBSSACXJQBLHSACBKMFACMLMCLHSACIWAUICDUMSAJSSACGOJDCBTOCJICDJOOXUTASGKSBCCICDXJSACXDKOOHLXWKSSUMTFUSAXJSACXDKOOBCCUHSACQDLMSWKSUXCSLXSCDWKSQLKXHUMTCXSACMACWAJOOCMTCDJMDFUSAHUMTCXMLSAUMTACXCTLCBUWKSIQSAKIGBOJMSFUBCHLXSKMJSCOQSACYMUHCFJBBIJOOJMDSACGLMCLHSACSAKIGAJXDCMLKTABLSACSAKIGUBBSUOOSACXCGKSSACBWJXFUOOGCSACXCKMSUOIQDCJSAJGLKSSFCMSQBSCRBSLSACCJBSCDTCLHLKXTJXDCMSACXCFJBJILDCXJSCBUVCDZCTCSJGOCQJXDXUBUMTSLFJXDSACBLKSAJMDUMSACWCMSXCLHFAUWABSLLDJWACBSMKSSXCCFAUWAFJBDCJXCXSLICSAJMOUHCUMSACBCJBLMFACMSACWACBSMKSBFCXCXURCUKBCDSLBOURLKSLHSACALKBCHXLISACGJWYDLLXCJXOQUMSACILXMUMTSLRUWYKRSACWACBSMKSBFAUWAAJDHJOOCMDKXUMTSACMUTASJMDCJSSACIJSSACBWALLOLMSACFCBSBUDCLHSACZCTCSJGOCQJXDFJBSACJDELUMUMTTJXDCMLHJRJFMBALRWJOOCDQJIJBAUXLQJSAUBBALRYCCRCXBBLMFJBJGLQJGLKSLXQCJXBLODMJICDYJMSJXLYJMSJXLFJBUSAJRRCMBJILOOQWLDDOCMCZCXSACOCBBACAJDSACSCICXUSQSLWLICLZCXSACHCMWCSLLKXQJXDJMDBSCJOIQWACBSMKSBLMCWCXSJUMCZCMUMTUAUDIQBCOHGCAUMDJHLODUMTTJSCLHSACHCMWCJMDWJKTASAUIUMSACJWSAJZUMTAUBXCSXCJSWKSLHHACTXJRROCDFUSAICUMDCBRCXJSULMACFJBJGLKSSFLQCJXBLODCXSAJMUJMDSALKTAFCJYYMCCDFJBRAQBUWJOOQSACBSXLMTCXFAUOCUFJOOLRRCDAUIACRKBACDAUBACJDJTJUMBSIQGXCJBSJMDGQWAJMWCUSBOURRCDUMBUDCIQBOCCZCJBSAUBAUMDCXCDSACHXCCJWSULMLHIQJXIUSXUCDSLBAJYCAUIOLLBCSALKTAAUBACJDDJMTOCDSACHKXSACXUMBUDCJMDGCUMTMLOLMTCXJGOCSLBSJMDSACBSUHOUMTWLIGJSACGUSIQGJXCJXIUSFJBRJUMHKOUACODAUIHJBSJTJUMBSSACHCMWCJMDGQJDCNSCXLKBHLLSSFUBSBCMSAUIDLFMHOJSLMAUBGJWYYJMSJXLGXLYCSACHCMWCJMDJBSACTXLKMDGCOLMTUMTSLQJIJBAUXLQJFJBJGLKSBUNHCCSOLFCXSAJMSACZCTCSJGOCQJXDACHCOOACJDOLMTSLAUBLFMSCXXUSLXQFUSAJSAKDJBACXLOOCDLHHACSLXCJFJQSACBOCCZCUMFAUWAAUBACJDAJDGCCMCMFXJRRCDJMDIQJXIXCWLZCXCDJBKDDCMHXCCDLILHILZCICMSSAJSMUTASFACMIQILSACXFCMSSLQJIJBAUXLQJSLJRLOLTUVCBACGXLKTASGJWYSAJSBOCCZCGCBUDCBSACJGLZCUDUDIJMQLSACXIUBWAUCHBFUSAYJMCYLLHJWJXRCMSCXBALRJMDYJYKLHJHUBAIJXYCSULMWCXKUMCDJWJXXLSRJSWALHLMCILBJYKSACBRXLKSBFCXCEKBSBALLSUMTLKSJMDSACRJSWAFJBWLZCXCDFUSABSXJFBSLCMBKXCSACUXCZCMACJOSAQTXLFSAKRLMSAUBBSXJFWLZCXCDRJSWAFCSAXCCFXCBSOCDHLXHKOOQAJOHJDJQJMDWLMBCPKCMSOQSALXLKTAOQBIJBACDJOOSACBRXLKSBJOBLULMWCHUOOCDKRJFCOOFAUWAFJSCXCDBLICXUWCHUCODBLFMCDGQLMCHKXKYJFJJMDACHLOOLFCDICFUSAYUWYBSACFCOOFJBBLDCZUBCDSAJSHXLIJOJXTCGJIGLLRLOCBKMYDCCRUMSLSACTXLKMDSACFJSCXUBBKCDJMDUXXUTJSCDSACXUWCHUCODBUTMLXJMSLHSACICWAJMUWJOBUDCLHSAUBUXXUTJSUMTICSALDJSSAJSSUICUBSKHHCDSACGJIGLLRLOCFUSABSLMCBJMDBSUWYBJMDBJSUBHUCDSAJSMLILXCFJSCXWJICKRUXCSKXMCDALICJMDFJBCJSUMTBKRRCXFACMHKXKYJFJHUCXQXCDFUSAJMTCXGKXBSUMSLLKXALKBCFUSAALFOUMTRXLSCBSBUGCOUCZCSACJHHJUXFJBBCSSOCDLMLKXRJQUMTHLXSACDJIJTCHJSACXDUDMLSOUYCICUMSACOCJBSJMDILSACXJOFJQBBUDCDFUSAIQGUTGXLSACXSAUBGXLSACXBHJWCFJBRJOUBAFAUSCJMDACAJDJHLMDMCBBHLXSJYUMTSACRJXSLHJMJWSXCBBJSSACSACJSXCSAUBHCOOLFFUOOMCZCXJILKMSSLIKWAHJSACXKBCDSLXCIJXYFACMACBJFICACBBLXCWYOCBBSAJSUFLXXQJGLKSAUBHKSKXCULHSCMACJXDILSACXBJQLHICCNJWSOQUAJZCMCZCXJILKMSCDSLIKWAUJIEKBSJBQLKBCCICMLFLMDCXIQHKSKXCKBCDSLWJKBCJMNUCSQSLIQILSACXUJIOUZUMTFUSALKSGCWLIUMTGKSJEJUOGUXD</textarea>
</div>
<div class="element">
<span class="label">Exercise</span> The following ciphertext was
encrypted using a simple substitution. The plaintext is known to contain
the word <code>MOSCOW</code>. Find the corresponding plaintext.
<textarea readonly rows=10 style="width: 100%;">JIFBPRDPKAYJAOPHARDQTPZPCPZTDSKFBTPOPRBIFYWXDPRWTIQTDQIFYWXSARHFMTAKBTAYWSDRTAKXDTPNAISPKPCPZTDSQPKDVPBZYJQTPZOAHTZXDDVMDBZDWTDBIOMYDZDYJPXPRWIRDWZTDBTAYWICTAKOPSSAPHDQAZTPWDYPWPANPRINRPRIZCSIOOPYABDRISXDBPFKDICTAKOPZSAOIRAPYHSADNPRBDKXFZKAOMYJXDBPFKDTDCISHIZTAOQTAYDTDQPKQDPSJARHDNDSJIRDQAZTTAKZDPSKPRWBIOMYPARZKPRWZFSRARHTAKTIFKDARZIPKAREICWDXPFBTDSJPCPAZTCFYKDSNPRZICZTDCPOAYJHSAHISJZIIEZTDZTSDDJDPSIYWOAZJPARZITAKBPSDACTDTPWRZYIIEDWPCZDSTAOZTDSDQIFYWTPNDXDDRRIIRDDNDRZIBTPRHDZTDXPXJKYAZZYDKTASZAZTPMMDRDWOISDINDSZTPZZTDBTAYWKSDYPZAIRKIRTAKOIZTDSKKAWDCISHIZTAOZIIPZCASKZTAKHSPRWCPZTDSQPKRIYIRHDSYANARHTAKQAWIQOAZJPKHSPRWOIZTDSTPWOINDWZIOIKBIQPRWQPKKDSAIFKYJAYYQTAYDTAKWPFHTZDSKQDSDOPSSADWKIZTPZOAZJPSDOPARDWCISPYOIKZPQTIYDJDPSARIYWHSAHISJKBTPSHDPRWYANDWQAZTTAOARZTDKDSNPRZKBIZZPHDXFZACTAKCPZTDSTPWSDODOXDSDWTAOTDBIFYWRIZARWDDWTPNDXDDRPYZIHDZTDSFRPQPSDICTAKDVAKZDRBDTDQIFYWTPNDKDRZTAOXPBEZIZTDBIZZPHDPKZTDBTAYWQIFYWIRYJTPNDXDDRARZTDQPJICTAKWDXPFBTDSADKXFZPBIFKARICOAZJPKOIZTDSMJIZSPYDVPRWSINAZBTOAKINTPMMDRDWZISDZFSRCSIOMPSAKTDYANDWCISOPRJJDPSKPCZDSQPSWKPXSIPWXFZQPKPZZTPZZAODLFAZDPJIFRHOPRPRWWAKZARHFAKTDWPOIRHZTDOAKINKPKPOPRICDRYAHTZDRDWAWDPKPRWICDFSIMDPRBFYZFSDQTITPWXDDRARZTDBPMAZPYKPRWPXSIPWZIQPSWKZTDDRWICTAKYACDTDXDBPODPYAXDSPYICZTDZJMDBIOOIRARZTDCISZADKPRWCACZADKARZTDBIFSKDICTAKBPSDDSTDTPWBIODARZIBIRZPBZQAZTOPRJICZTDOIKZYAXDSPYODRICTAKDMIBTXIZTARSFKKAPPRWPXSIPWTDTPWERIQRMSIFWTIRPRWXPEFRARMDSKIRPYYJPRWARTAKWDBYARARHJDPSKQPKNDSJCIRWICWDKBSAXARHZTDZTSDDWPJKICZTDMPSAKSDNIYFZAIRICCDXSFPSJTARZARHZTPZTDTAOKDYCTPWPYOIKZZPEDRMPSZARZTDCAHTZARHIRZTDXPSSABPWDKZTAKQPKIRDICZTDOIKZHSPZDCFYSDBIYYDBZAIRKICTAKJIFZTTDTPWPRARWDMDRWDRZMSIMDSZJICPXIFZPZTIFKPRWKIFYKZISDBEIRARZTDIYWKZJYDTAKKMYDRWAWDKZPZDYPJIRZTDIFZKEASZKICIFSYAZZYDZIQRPRWXISWDSDWIRZTDYPRWKICIFSCPOIFKOIRPKZDSJQAZTQTABTMJIZSPYDVPRWSINAZBTXDHPRPRDRWYDKKYPQKFAZPYOIKZPKKIIRPKTDBPODARZIZTDDKZPZDBIRBDSRARHZTDSAHTZKICCAKTARHARZTDSANDSISQIIWBFZZARHARZTDCISDKZAWIRZERIQDVPBZYJQTABTTDSDHPSWDWAZPKTAKWFZJPKPBAZAGDRPRWPOPRICBFYZFSDZIIMDRPRPZZPBEFMIRZTDBYDSABPYKTDPSARHPYYPXIFZPWDYPWPANPRINRPQTIOTDICBIFSKDSDODOXDSDWPRWARQTIOTDTPWPZIRDZAODXDDRARZDSDKZDWPRWYDPSRARHICZTDDVAKZDRBDICOAZJPTDARZDSNDRDWARKMAZDICPYYTAKJIFZTCFYARWAHRPZAIRPRWBIRZDOMZCISCJIWISMPNYINAZBTTDOPWDZTDYPZZDSKPBLFPARZPRBDCISZTDCASKZZAODPRWZIYWTAOWASDBZYJZTPZTDQAKTDWZIFRWDSZPEDZTDBTAYWKDWFBPZAIRTDFKDWYIRHPCZDSQPSWKZIZDYYPKPBTPSPBZDSAKZABZIFBTZTPZQTDRTDXDHPRZIKMDPEICOAZJPCJIWISMPNYINAZBTYIIEDWCISKIODZAODPKZTIFHTTDWAWRIZFRWDSKZPRWQTPZBTAYWTDQPKZPYEARHPXIFZPRWDNDRPKZTIFHTTDQPKKFSMSAKDWZITDPSZTPZTDTPWPYAZZYDKIRARZTDTIFKDZTDKZISJOPJTPNDXDDRDVPHHDSPZDWJDZAZOFKZTPNDXDDRKIODZTARHYAEDZTDZSFZTCJIWISMPNYINAZBTQPKPYYTAKYACDCIRWICPBZARHICKFWWDRYJMYPJARHPRFRDVMDBZDWMPSZKIODZAODKQAZTIFZPRJOIZANDCISWIARHKIPRWDNDRZITAKIQRWASDBZWAKPWNPRZPHDPKCISARKZPRBDARZTDMSDKDRZBPKDZTAKTPXAZTIQDNDSAKBTPSPBZDSAKZABICPNDSJHSDPZRFOXDSICMDIMYDKIODICZTDONDSJBYDNDSIRDKRIZYAEDCJIWISMPNYINAZBTMJIZSPYDVPRWSINAZBTBPSSADWZTDXFKARDKKZTSIFHTNAHISIFKYJPRWQPKPMMIARZDWQAZTCJIWISMPNYINAZBTUIARZHFPSWAPRICZTDBTAYWQTITPWPKOPYYMSIMDSZJPTIFKDPRWYPRWYDCZTAOXJTAKOIZTDSOAZJPWAWARCPBZMPKKARZIZTAKBIFKARKEDDMARHXFZPKZTDYPZZDSTPWRICPOAYJICTAKIQRPRWPCZDSKDBFSARHZTDSDNDRFDKICTAKDKZPZDKQPKARTPKZDZISDZFSRPZIRBDZIMPSAKTDYDCZZTDXIJARBTPSHDICIRDICTAKBIFKARKPYPWJYANARHAROIKBIQAZBPODZIMPKKZTPZKDZZYARHMDSOPRDRZYJARMPSAKTDZIICISHIZZTDBTAYWDKMDBAPYYJQTDRZTDSDNIYFZAIRICCDXSFPSJXSIEDIFZOPEARHPRAOMSDKKAIRIRTAKOARWZTPZTDSDODOXDSDWPYYZTDSDKZICTAKYACDZTDOIKBIQYPWJWADWPRWOAZJPMPKKDWARZIZTDBPSDICIRDICTDSOPSSADWWPFHTZDSKAXDYADNDTDBTPRHDWTAKTIODPCIFSZTZAODYPZDSIRAQIRZDRYPSHDFMIRZTPZRIQPKAKTPYYTPNDOFBTZIZDYYYPZDSICCJIWISMPNYINAZBTKCASKZXISRPRWOFKZBIRCARDOJKDYCRIQZIZTDOIKZDKKDRZAPYCPBZKPXIFZTAOQAZTIFZQTABTABIFYWRIZXDHAROJKZISJARZTDCASKZMYPBDZTAKOAZJPISSPZTDSWOAZSACJIWISINAZBTQPKZTDIRYJIRDICCJIWISMPNYINAZBTKZTSDDKIRKQTIHSDQFMARZTDXDYADCZTPZTDTPWMSIMDSZJPRWZTPZTDQIFYWXDARWDMDRWDRZIRBIOARHICPHDTDKMDRZPRASSDHFYPSXIJTIIWPRWJIFZTTDWAWRIZCARAKTTAKKZFWADKPZZTDHJORPKAFOTDHIZARZIPOAYAZPSJKBTIIYZTDRQDRZZIZTDBPFBPKFKQPKMSIOIZDWCIFHTZPWFDYPRWQPKWDHSPWDWZIZTDSPREKDPSRDWMSIOIZAIRPHPARYDWPQAYWYACDPRWKMDRZPHIIWWDPYICOIRDJTDWAWRIZXDHARZISDBDANDPRJARBIODCSIOCJIWISMPNYINAZBTFRZAYTDBPODICPHDPRWFRZAYZTDRHIZARZIWDXZTDKPQPRWERDQTAKCPZTDSCJIWISMPNYINAZBTCISZTDCASKZZAODIRBIOARHICPHDQTDRTDNAKAZDWIFSRDAHTXISTIIWIRMFSMIKDZIKDZZYDQAZTTAOPXIFZTAKMSIMDSZJTDKDDOKRIZZITPNDYAEDWTAKCPZTDSTDWAWRIZKZPJYIRHQAZTTAOPRWOPWDTPKZDZIHDZPQPJTPNARHIRYJKFBBDDWDWARIXZPARARHPKFOICOIRDJPRWDRZDSARHARZIPRPHSDDODRZCISCFZFSDMPJODRZKCSIOZTDDKZPZDICZTDSDNDRFDKPRWNPYFDICQTABTTDQPKFRPXYDPCPBZQISZTJICRIZDFMIRZTAKIBBPKAIRZIHDZPKZPZDODRZCSIOTAKCPZTDSCJIWISMPNYINAZBTSDOPSEDWCISZTDCASKZZAODZTDRZTAKZIIKTIFYWXDRIZDWZTPZOAZJPTPWPNPHFDPRWDVPHHDSPZDWAWDPICTAKMSIMDSZJCJIWISMPNYINAZBTQPKNDSJQDYYKPZAKCADWQAZTZTAKPKAZCDYYARQAZTTAKIQRWDKAHRKTDHPZTDSDWIRYJZTPZZTDJIFRHOPRQPKCSANIYIFKFRSFYJICNAIYDRZMPKKAIRKAOMPZADRZPRWWAKKAMPZDWPRWZTPZACTDBIFYWIRYJIXZPARSDPWJOIRDJTDQIFYWXDKPZAKCADWPYZTIFHTIRYJICBIFSKDCISPKTISZZAODKICJIWISMPNYINAZBTXDHPRZIZPEDPWNPRZPHDICZTAKCPBZKDRWARHTAOCSIOZAODZIZAODKOPYYWIYDKARKZPYYODRZKARZTDDRWQTDRCIFSJDPSKYPZDSOAZJPYIKARHMPZADRBDBPODPKDBIRWZAODZIIFSYAZZYDZIQRZIKDZZYDFMIRBDCISPYYQAZTTAKCPZTDSAZZFSRDWIFZZITAKPOPGDODRZZTPZTDTPWRIZTARHZTPZAZQPKWACCABFYZZIHDZPRPBBIFRZDNDRZTPZTDTPWSDBDANDWZTDQTIYDNPYFDICTAKMSIMDSZJARKFOKICOIRDJCSIOCJIWISMPNYINAZBTPRWQPKMDSTPMKDNDRARWDXZZITAOZTPZXJNPSAIFKPHSDDODRZKARZIQTABTTDTPWICTAKIQRWDKASDDRZDSDWPZNPSAIFKMSDNAIFKWPZDKTDTPWRISAHTZZIDVMDBZPRJZTARHOISDPRWKIIRPRWKIIRZTDJIFRHOPRQPKINDSQTDYODWKFKMDBZDWWDBDAZPRWBTDPZARHPRWQPKPYOIKZXDKAWDTAOKDYCPRWARWDDWZTAKBASBFOKZPRBDYDWZIZTDBPZPKZSIMTDZTDPBBIFRZICQTABTCISOKZTDKFXUDBZICOJCASKZARZSIWFBZISJKZISJISSPZTDSZTDDVZDSRPYKAWDICAZXFZXDCISDAMPKKZIZTPZKZISJAOFKZKPJPYAZZYDICCJIWISMPNYINAZBTKIZTDSZQIKIRKPRWICZTDASISAHAR</textarea>
</div>
<div class="element">
<p><span class="label">Harder Sage Exercise with No Programming
Involved</span> When you did the above codebreaking exercises, you may
have noticed a changing <span class="math inline">\(G\)</span> value
associated to a given pattern match as you made guesses for the
decryption key. Look through the code and explain why this is happening.
Does this behavior make sense to you?</p>
</div>
<h2 id="perfect-secrecy">3.10. Perfect Secrecy</h2>
<p>At this point, we’re ready to think about cryptosystems in some
generality. We’ll introduce some abstractions that encompass all of the
types of ciphers we’ve seen so far, but the point is not the generality;
the goal in this section is to see what it means to say that “the
one-time pad achieves perfect secrecy,” and to prove this.</p>
<p>This section may be a little challenging, especially if you haven’t
done much with proofs before; focus on understanding the definitions and
theorem statements at first, and you can return the proofs later if you
like.</p>
<p>Let’s first introduce the general framework. From Eve’s perspective,
it makes sense to consider Alice’s choice of a plaintext message as a
random variable <span class="math inline">\(M\)</span> whose set of
values <span class="math inline">\(\mathscr{M}\)</span> represents all
possible plaintext messages. Note that, by saying that <span
class="math inline">\(M\)</span> is a random variable, we’re introducing
probabilities associated to every possible plaintext message, and we
assume that Eve knows this probability distribution. For example, <span
class="math inline">\(\mathscr{M}\)</span> might be the set of all
strings in the letters <code>A</code>–<code>Z</code>, and we might deem
the plaintext <code>QUIZ</code> to be less probable than the plaintext
<code>THEN</code> on the basis that the former uses much more infrequent
letters than the latter. Alternatively, we could assign probabilities
based on bigram frequencies instead of single-letter frequencies. It
doesn’t matter how we assign probabilities; the point is just that any
plaintext message has a probability assigned to it.</p>
<p>We can model known-plaintext attacks in at least two ways. Suppose,
for example, that Eve knows that the plaintext must contain the word
<code>LONDON</code>. The first way to model a known-plaintext attack is
to assign a probability of 0 to every plaintext message that
<em>doesn’t</em> contain the <code>LONDON</code> as a substring. The
second way is to simply eliminate all strings that don’t contain
<code>LONDON</code> from our set of values <span
class="math inline">\(\mathscr{M}\)</span>. It is convenient to use the
latter method of modeling known-plaintext attacks, since it allows us to
assume that <span class="math display">\[ P[M = m] \neq 0 \]</span> for
all <span class="math inline">\(m \in \mathscr{M}\)</span>, and so we
will assume this from here on out.</p>
<p>This brings us to a the following definition of a cryptosystem.</p>
<div class="element">
<p><span class="label">Definition</span> A <em>cryptosystem</em> (on
<span class="math inline">\(M\)</span>) consists of the following
data:</p>
<ul>
<li>A random variable <span class="math inline">\(K\)</span> whose set
of values <span class="math inline">\(\mathscr{K}\)</span> represents
the set of all possible keys.<a href="#fn5" class="footnote-ref"
id="fnref5" role="doc-noteref"><sup>5</sup></a></li>
<li>A set <span class="math inline">\(\mathscr{C}\)</span> of all
possible ciphertexts.</li>
<li>An encryption function <span class="math inline">\(E : \mathscr{K}
\times \mathscr{M} \to \mathscr{C}\)</span>, which means that <span
class="math inline">\(E\)</span> takes as input a key <span
class="math inline">\(k \in \mathscr{K}\)</span> and a plaintext message
<span class="math inline">\(m \in \mathscr{M}\)</span> and outputs a
corresponding ciphertext <span class="math inline">\(E(k,
m)\)</span>.</li>
<li>A decryption function <span class="math inline">\(D : \mathscr{K}
\times \mathscr{C} \to \mathscr{M}\)</span>, which means that <span
class="math inline">\(D\)</span> takes as input a key <span
class="math inline">\(k \in \mathscr{K}\)</span> and a ciphertext <span
class="math inline">\(c \in \mathscr{C}\)</span> and outputs a
corresponding plaintext message <span class="math inline">\(D(k,
c)\)</span>.</li>
</ul>
<p>We require that <span class="math display">\[ D(k, E(k, m)) = m
\]</span> for any key <span class="math inline">\(k \in
\mathscr{K}\)</span> and any plaintext message <span
class="math inline">\(m \in \mathscr{M}\)</span>, ie, that a plaintext
can be recovered from its encryption. Once we’ve specified the above
data, we also define the random variable <span class="math inline">\(C =
E(K, M)\)</span> to model an observation of the ciphertext.</p>
</div>
<p>For example, consider the Caesar cipher. The sets <span
class="math inline">\(\mathscr{M}\)</span> and <span
class="math inline">\(\mathscr{C}\)</span> are both equal to the set of
all possible strings in the capital letters <code>A</code> through
<code>Z</code>, and the key space <span
class="math inline">\(\mathscr{K}\)</span> is the set of all possible
shifts, ie, <span class="math inline">\(\mathscr{K} = \{0, 1, \dotsc,
25\}\)</span>. Given <span class="math inline">\(k \in
\mathscr{K}\)</span> and <span class="math inline">\(m \in
\mathscr{M}\)</span>, the string <span class="math inline">\(E(k,
m)\)</span> is the result of applying the Caesar cipher with shift <span
class="math inline">\(k\)</span> to <span
class="math inline">\(m\)</span>, ie, by adding <span
class="math inline">\(k\)</span> mod 26 to the numbers 0–25
corresponding to each letter <code>A</code>–<code>Z</code> in <span
class="math inline">\(m\)</span>. To fully specify the cryptosystem, we
should also assign probabilities to each of the keys; for example, we
might assume that <span class="math inline">\(K\)</span> is uniform.</p>
<p>This is not necessarily the only way to fit the Caesar cipher into
the above framework. For example, if you like, you can fix an upper
bound on the length of the strings involved so that <span
class="math inline">\(\mathscr{M}\)</span> and <span
class="math inline">\(\mathscr{C}\)</span> are finite. You could also
decide that the key space is just <span class="math inline">\(\{1,
\dotsc, 25\}\)</span>, if you don’t want to consider a shift of 0 to be
a valid key. You could also choose a non-uniform distribution for the
random variable <span class="math inline">\(K\)</span>.</p>
<div class="element">
<p><span class="label">Exercise</span> Use this definition to model a
Polybius square cipher where the key box has our usual row and column
labels <code>ADFGVX</code>. What is <span
class="math inline">\(\mathscr{M}\)</span> in this setting? What is
<span class="math inline">\(\mathscr{C}\)</span>? What is <span
class="math inline">\(\mathscr{K}\)</span>, and how many elements does
it have?</p>
</div>
<div class="element">
<p><span class="label">Exercise</span> How would you use this definition
to model rectangular transposition? More specifically, what would you
take <span class="math inline">\(\mathscr{K}\)</span> to be?</p>
<p><em>Note</em>. There isn’t a unique “right” answer here! The answer
you might write down if you’ve seen group theory before may be different
than the answer you might write down if you haven’t seen any group
theory.</p>
</div>
<div class="element">
<p><span class="label">Proof Exercise</span> For any cryptosystem, show
that the number of ciphertexts must be at least as large as that of the
number of plaintext messages.</p>
<p><em>Hint</em>. The question is about comparing the cardinalities of
the sets <span class="math inline">\(\mathscr{M}\)</span> and <span
class="math inline">\(\mathscr{C}\)</span>. To do this, fix some <span
class="math inline">\(k_0 \in \mathscr{K}\)</span> and consider the
function <span class="math inline">\(E(k_0, -) : \mathscr{M} \to
\mathscr{C}\)</span>.</p>
</div>
<div class="element">
<p><span class="label">Exercise</span> Construct an example to show that
it is possible to have strictly more ciphertexts than plaintext
messages, even when every ciphertext is in fact in the range of the
encryption function.</p>
</div>
<p>Here is the central definition of this section:</p>
<div class="element">
<p><span class="label">Definition</span> A cryptosystem <em>achieves
perfect secrecy</em> if <span class="math inline">\(M\)</span> and <span
class="math inline">\(C\)</span> are independent random variables.</p>
</div>
<p>In other words, for any plaintext message <span
class="math inline">\(m\)</span> and any encrypted message <span
class="math inline">\(c\)</span>, we should have <span
class="math display">\[ P[M = m \mid C = c] = P[M = m]. \]</span>
Heuristically, this means that observing <span class="math inline">\(C =
c\)</span> provides Eve with no additional information whatsoever about
<span class="math inline">\(M\)</span> — the best guesses that she might
have made about the plaintext message before she intercepted the
ciphertext do not change even after she intercepts the ciphertext!</p>
<p>The attacks on cryptosystems we’ve seen so far exploit the fact that
those cryptosystems <em>fail</em> to achieve perfect secrecy. When we
conduct frequency analysis on simple substitution, for example, we are
using the fact that certain plaintexts become more likely after
observing a given ciphertext: eg, the plaintexts in which the letter
<code>E</code> appears in the same positions in which the most frequent
letter of the ciphertext appears.</p>
<p>How do we achieve perfect secrecy? Well, the first observation to
make is that achieving perfect secrecy requires having <em>a lot</em> of
keys. More precisely, the statement is the following:</p>
<div class="element">
<p><span class="label">Lemma</span> Suppose a cryptosystem achieves
perfect secrecy. Then the number of keys must be at least as large as
the number of “possible” ciphertexts (ie, ciphertexts <span
class="math inline">\(c \in \mathscr{C}\)</span> such that <span
class="math inline">\(P[C = c] \neq 0\)</span>).</p>
</div>
<p><em>Proof</em>. Fix <span class="math inline">\(m_0 \in
\mathscr{M}\)</span> and recall our assumption that <span
class="math inline">\(P[M = m_0] \neq 0\)</span>. Suppose <span
class="math inline">\(c \in \mathscr{C}\)</span> is a “possible”
ciphertext. We then have <span class="math display">\[ P[M = m_0 \mid C
= c] = P[M = m_0] \neq 0, \]</span> so there must exist a key <span
class="math inline">\(k(c) \in \mathscr{K}\)</span> such that <span
class="math inline">\(E(k(c), m_0) = c\)</span>. If <span
class="math inline">\(c&#39; \in \mathscr{C}\)</span> is another
“possible” ciphertext and <span class="math inline">\(k(c) =
k(c&#39;)\)</span>, then<br />
<span class="math display">\[ c = E(k(c), m_0) = E(k(c&#39;), m_0) =
c&#39; \]</span> so <span class="math inline">\(c \mapsto k(c)\)</span>
defines an injective function from possible ciphertexts into <span
class="math inline">\(\mathscr{K}\)</span>. Thus the number of keys must
be at least as large as the number of possible ciphertexts. <span
style="float: right;"><span
class="math inline">\(\Box\)</span></span></p>
<p>Having observed this, here is a result that gives us a way to achieve
perfect secrecy:</p>
<div class="element">
<p><span class="label">Perfect Secrecy Theorem</span> A cryptosystem
achieves perfect secrecy if it satisfies all of the following
conditions:</p>
<ul>
<li><span class="math inline">\(K\)</span> is uniform.</li>
<li><span class="math inline">\(K\)</span> and <span
class="math inline">\(M\)</span> are independent.</li>
<li>For every plaintext message <span class="math inline">\(m \in
\mathscr{M}\)</span> and every ciphertext <span class="math inline">\(c
\in \mathscr{C}\)</span>, there exists a unqiue <span
class="math inline">\(k \in \mathscr{K}\)</span> such that <span
class="math inline">\(E(k, m) = c\)</span>.</li>
</ul>
</div>
<p><em>Proof</em>. Fix a ciphertext <span class="math inline">\(c_0 \in
\mathscr{C}\)</span> and observe that <span class="math display">\[
\begin{aligned}
P[C = c_0] &amp;= P[E(K, M) = c_0] \\
&amp;= \sum_{\substack{k \in \mathscr{K}, m \in \mathscr{M}, \\ E(k, m)
= c_0}} P[K = k \text{ and } M = m] \\
&amp;= \sum_{\substack{k \in \mathscr{K}, m \in \mathscr{M}, \\ E(k, m)
= c_0}} P[K = k] P[M = m],
\end{aligned}\]</span> where we use independence of <span
class="math inline">\(K\)</span> and <span
class="math inline">\(M\)</span> for the last equality. For any
plaintext message <span class="math inline">\(m \in
\mathscr{M}\)</span>, we know by assumption that there exists a unique
key <span class="math inline">\(k_0(m)\)</span> such that <span
class="math inline">\(E(k_0(m), m) = c_0\)</span>. Thus the above sum
can be re-written <span class="math display">\[ P[C = c_0] = \sum_{m \in
\mathscr{M}} P[M = m] P[K = k_0(m)]. \]</span> Since <span
class="math inline">\(K\)</span> is uniform, it has finitely many
values, and if <span class="math inline">\(N\)</span> is the number of
values, we have <span class="math inline">\(P[K = k_0(m)] = 1/N\)</span>
for all <span class="math inline">\(m \in \mathscr{M}\)</span>, so <span
class="math display">\[ P[C = c_0] = \frac{1}{N} \sum_{m \in
\mathscr{M}} P[M = m] = \frac{1}{N} \]</span> since the events <span
class="math inline">\(M = m\)</span> as <span class="math inline">\(m
\in \mathscr{M}\)</span> varies form a partition of the probability
space.</p>
<p>Now fix a plaintext <span class="math inline">\(m_0 \in
\mathscr{M}\)</span>. Observe that <span class="math display">\[
\begin{aligned}
P[M = m_0 \text{ and } C = c_0] &amp;= \sum_{k \in \mathscr{K}} P[K = k
\text{ and } M = m_0 \text{ and } C = c_0] \\
&amp;= \sum_{k \in \mathscr{K}} P[K = k \text{ and } M = m_0 \text{ and
} E(k, m_0) = c_0].
\end{aligned} \]</span> There exists a unique key <span
class="math inline">\(k_0 \in \mathscr{K}\)</span> such that <span
class="math inline">\(E(k_0, m_0) = c_0\)</span>, so we have <span
class="math display">\[ P[K = k \text{ and } M = m_0 \text{ and } E(k,
m_0) = c_0] = 0 \]</span> unless <span class="math inline">\(k =
k_0\)</span>. In other words, the above summation collapses to just a
single term and we have <span class="math display">\[ \begin{aligned}
P[M = m_0 \text{ and } C = c_0]
&amp;= P[K = k_0 \text{ and } M = m_0 \text{ and } E(k, m_0) = c_0] \\
&amp;= P[K = k_0 \text{ and } M = m_0] \\
&amp;= P[K = k_0] P[M = m_0] \\
&amp;= \frac{1}{N} \cdot P[M = m_0] \\
&amp;= P[M = m_0]P[C = c_0]
\end{aligned} \]</span> where we have used independence of <span
class="math inline">\(K\)</span> and <span
class="math inline">\(M\)</span> for the third step, and the fact that
<span class="math inline">\(P[C = c_0] = 1/N\)</span> for the final
step. <span style="float: right;"><span
class="math inline">\(\Box\)</span></span></p>
<p>Our next order of business is to show that “the one-time pad achieves
perfect secrecy.” Remember that the one-time pad is a special case of
the Vignère cipher, so let’s first think about how we can formally model
the Vignère cipher using the framework we’ve introduced here. Fix a
period <span class="math inline">\(p\)</span> and let <span
class="math inline">\(\mathscr{K}\)</span> be the set of all sequences
<span class="math inline">\((a_1, \dotsc, a_p)\)</span> where <span
class="math inline">\(a_1, \dotsc, a_p\)</span> are all numbers 0–25.
Also, let’s fix a message length <span class="math inline">\(r\)</span>
and let <span class="math inline">\(\mathscr{M}\)</span> and <span
class="math inline">\(\mathscr{C}\)</span> be the set of all strings in
the letters <code>A</code>–<code>Z</code> of length <span
class="math inline">\(r\)</span>. Note that, if Eve intercepts a
ciphertext of length <span class="math inline">\(r\)</span> that she
knows to be encrypted using a Vignère cipher, she also knows the
plaintext must have had length <span class="math inline">\(r\)</span>,
so she can assign probability 0 to all messages of other lengths; in
other words, it is reasonable to eliminate all messages of other lengths
from our message spaces.</p>
<p>We then have the Vignère encryption and decryption functions <span
class="math inline">\(E : \mathscr{K} \times \mathscr{M} \to
\mathscr{C}\)</span> and <span class="math inline">\(D : \mathscr{K}
\times \mathscr{C} \to \mathscr{M}\)</span>. Applying Vignère encryption
to a message of length <span class="math inline">\(r\)</span> will
always just use the first <span class="math inline">\(\min\{r,
p\}\)</span> of the <span class="math inline">\(p\)</span> numbers in
our key sequence, so might as well replace <span
class="math inline">\(p\)</span> with <span
class="math inline">\(\min\{r, p\}\)</span> in order to assume that
<span class="math inline">\(p \leq r\)</span>.</p>
<div class="element">
<p><span class="label">Lemma</span> Using the notation we’ve just
introduced, we have <span class="math inline">\(p = r\)</span> if and
only if, for every plaintext message <span class="math inline">\(m \in
\mathscr{M}\)</span> and every ciphertext <span class="math inline">\(c
\in \mathscr{C}\)</span>, there exists a unqiue <span
class="math inline">\(k \in \mathscr{K}\)</span> such that <span
class="math inline">\(E(k, m) = c\)</span>.</p>
</div>
<p><em>Proof</em>. Let’s formally prove one direction: assume that for
any <span class="math inline">\(m \in \mathscr{M}\)</span> and <span
class="math inline">\(c \in \mathscr{C}\)</span>, there is a unique
<span class="math inline">\(k \in \mathscr{K}\)</span> such that <span
class="math inline">\(E(k, m) = c\)</span>. If we fix some message <span
class="math inline">\(m_0 \in \mathscr{M}\)</span>, our assertion is
that the function <span class="math inline">\(E(-, m_0) : \mathscr{K}
\to \mathscr{C}\)</span> is bijective, so <span
class="math inline">\(\mathscr{K}\)</span> and <span
class="math inline">\(\mathscr{C}\)</span> must have the same number of
elements. But <span class="math inline">\(\mathscr{K}\)</span> has <span
class="math inline">\(26^p\)</span> elements and <span
class="math inline">\(\mathscr{C}\)</span> has <span
class="math inline">\(26^r\)</span> elements, and <span
class="math inline">\(26^p = 26^r\)</span> implies <span
class="math inline">\(p = r\)</span>.</p>
<p>For the converse, let’s sketch the idea of the proof on the context
of an example. I will leave it to you to generalize this sketch if you
are interested. Let’s suppose that <span class="math inline">\(p = r =
3\)</span>. We then want to show that, for any <span
class="math inline">\(m \in \mathscr{M}\)</span> and <span
class="math inline">\(c \in \mathscr{C}\)</span>, there is a unique
<span class="math inline">\(k \in \mathscr{K}\)</span> such that <span
class="math inline">\(E(k, m) = c\)</span>. Suppose for example that
<span class="math inline">\(m\)</span> is <code>ZEE</code> and that
<span class="math inline">\(c\)</span> is <code>TOE</code>. If we
convert these messages to their corresponding number sequences, we have
<code>ZEE</code> corresponding to <span class="math inline">\((25, 4,
4)\)</span> and <code>TOE</code> corresponding to <span
class="math inline">\((19, 14, 4)\)</span>. Then consider <span
class="math display">\[ k = (25, 4, 4) - (19, 14, 4) \bmod{26} = (6,
-10, 0) \bmod{26} = (6, 16, 0). \]</span> This is the only key sequence
with the property that encrypting <code>ZEE</code> with this key results
in <code>TOE</code>! <span style="float: right;"><span
class="math inline">\(\Box\)</span></span></p>
<div class="element">
<p><span class="label">Proof Exercise</span> Formalize the sketchy part
of the argument for the above lemma.</p>
</div>
<p>Let’s recall some of the assumptions we made when we were discussing
the one-time pad when we first introduced it:</p>
<ul>
<li>We asked that the key sequence be “totally random.” We can now
formalize this by saying that we want our random variable <span
class="math inline">\(K\)</span> be uniform.</li>
<li>We also asked that the key sequence be “unrelated to the plaintext.”
We can now formalize this by saying that <span
class="math inline">\(K\)</span> and <span
class="math inline">\(M\)</span> be independent random variables.</li>
<li>We asked that our key sequence be at least as long as the plaintext.
In the notation we just introduced, this is the requirement that <span
class="math inline">\(p \geq r\)</span>. But we already have assumed
<span class="math inline">\(p \leq r\)</span>, so in fact this is
equivalent to saying <span class="math inline">\(p = r\)</span>, and in
the lemma above, we saw that this is equivalent to saying that, for any
<span class="math inline">\(m \in \mathscr{M}\)</span> and <span
class="math inline">\(c \in \mathscr{C}\)</span>, there exists a unique
<span class="math inline">\(k \in \mathscr{K}\)</span> such that <span
class="math inline">\(E(k, m) = c\)</span>.</li>
</ul>
<p>In other words, these three assumptions we made coincide exactly with
the conditions that appear in the Perfect Secrecy Theorem! We have now
proved what we want to prove:</p>
<div class="element">
<p><span class="label">Corollary</span> The one-time pad achieves
perfect secrecy.</p>
</div>
<div class="element">
<p><span class="label">Harder Exercise</span> If you look back to when
we described the one-time pad, you’ll notice that, besides the three
assumptions we mentioned above, we also had a fourth assumption: that
the key never be reused. Suppose that Eve intercepts two ciphertexts
<span class="math inline">\(c_0\)</span> and <span
class="math inline">\(c_1\)</span> of length <span
class="math inline">\(r\)</span> and that she knows that both were
encrypted using a Vignère cipher with the <em>same key</em> of length
<span class="math inline">\(r\)</span>. Describe a strategy that Eve
might use to extract information about the corresponding plaintexts.</p>
</div>
<div class="element">
<p><span class="label">Exercise</span> Our definition of “cryptosystem”
does not include the assumption that <span
class="math inline">\(K\)</span> and <span
class="math inline">\(M\)</span> are independent. This is slightly
nonstandard, but it was also intentional. Read about the <a
href="https://en.wikipedia.org/wiki/Autokey_cipher">autokey cipher</a>,
and then explain how to formally model the autokey cipher as a
“cryptosystem” in two different ways: one in which <span
class="math inline">\(K\)</span> and <span
class="math inline">\(M\)</span> <em>aren’t</em> independent, and one in
which <span class="math inline">\(K\)</span> and <span
class="math inline">\(M\)</span> <em>are</em> independent.</p>
</div>
<div class="element">
<p><span class="label">Harder Exercise</span> Suppose a cryptosystem
achieves perfect secrecy.</p>
<ol type="a">
<li>Is it true that <span class="math inline">\(K\)</span> and <span
class="math inline">\(M\)</span> must be independent?</li>
<li>Is it true that <span class="math inline">\(K\)</span> and <span
class="math inline">\(C\)</span> must be independent?</li>
</ol>
</div>
<aside id="footnotes" class="footnotes footnotes-end-of-document"
role="doc-endnotes">
<hr />
<ol>
<li id="fn1"><p>Written text in other languages also exhibits similar
non-uniformities, but we’ll focus here on English. Of course, Al-Kindi,
the Arab polymath who’s the progenitor of frequency analysis, was
discussing Arabic texts, not English ones!<a href="#fnref1"
class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>A common alternative is one denoted <span
class="math inline">\(\chi^2\)</span>. If this one is used instead, the
resulting test would be “Pearson’s chi-squared test.”<a href="#fnref2"
class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>For the experts reading these notes, I’m sloppily
identifying the word “distribution” with “probably density function”
rather than with “probability measure,” in order to avoid having to
expand the definition of “probability space” I introduced earlier! I
hope this will be forgiven.<a href="#fnref3" class="footnote-back"
role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>If you understand what it means to say that the key for
rectangular transposition is really a <em>permutation</em>, not
necessarily a word, then you might feel uncomfortable restricting to
numbers less than 26. If so, good! In that case, you just have more
possible periods you might have to try! ☺<a href="#fnref4"
class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>If you’re thinking of a random variable as a function,
the probability space on which <span class="math inline">\(K\)</span> is
defined should be the same as the one on which <span
class="math inline">\(M\)</span> is defined. In other words, it is not
enough to describe the distribution that <span
class="math inline">\(K\)</span> induces on the key space <span
class="math inline">\(\mathscr{K}\)</span> — this is merely a marginal
distribution, and one needs to specify the joint distribution of <span
class="math inline">\(K\)</span> and <span
class="math inline">\(M\)</span> (or equivalently, if the distribution
of <span class="math inline">\(M\)</span> is treated as a given, it is
sufficient to specify the conditional distribution of <span
class="math inline">\(K\)</span>). We do not assume at the outset that
<span class="math inline">\(K\)</span> and <span
class="math inline">\(M\)</span> are independent, but under this
additional assumption, it would be sufficient to specify the marginal
distribution of <span class="math inline">\(K\)</span>.<a href="#fnref5"
class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</aside>

</main>


</body>

</html>
